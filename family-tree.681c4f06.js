function e(e,t,n,i){Object.defineProperty(e,t,{get:n,set:i,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var n,i=globalThis,r={},o={},s=i.parcelRequirea7a4;null==s&&((s=function(e){if(e in r)return r[e].exports;if(e in o){var t=o[e];delete o[e];var n={id:e,exports:{}};return r[e]=n,t.call(n.exports,n,n.exports),n.exports}var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){o[e]=t},i.parcelRequirea7a4=s);var a=s.register;a("bYoiY",function(t,n){e(t.exports,"Color",()=>r),e(t.exports,"darker",()=>o),e(t.exports,"brighter",()=>a),e(t.exports,"default",()=>b),e(t.exports,"hslConvert",()=>I),e(t.exports,"Rgb",()=>$),e(t.exports,"rgbConvert",()=>S),e(t.exports,"rgb",()=>E),e(t.exports,"hsl",()=>N);var i=s("bfWFq");function r(){}var o=.7,a=1.4285714285714286,l="\\s*([+-]?\\d+)\\s*",u="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",h="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",c=/^#([0-9a-f]{3,8})$/,d=RegExp(`^rgb\\(${l},${l},${l}\\)$`),f=RegExp(`^rgb\\(${h},${h},${h}\\)$`),p=RegExp(`^rgba\\(${l},${l},${l},${u}\\)$`),g=RegExp(`^rgba\\(${h},${h},${h},${u}\\)$`),m=RegExp(`^hsl\\(${u},${h},${h}\\)$`),y=RegExp(`^hsla\\(${u},${h},${h},${u}\\)$`),v={aliceblue:0xf0f8ff,antiquewhite:0xfaebd7,aqua:65535,aquamarine:8388564,azure:0xf0ffff,beige:0xf5f5dc,bisque:0xffe4c4,black:0,blanchedalmond:0xffebcd,blue:255,blueviolet:9055202,brown:0xa52a2a,burlywood:0xdeb887,cadetblue:6266528,chartreuse:8388352,chocolate:0xd2691e,coral:0xff7f50,cornflowerblue:6591981,cornsilk:0xfff8dc,crimson:0xdc143c,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:0xb8860b,darkgray:0xa9a9a9,darkgreen:25600,darkgrey:0xa9a9a9,darkkhaki:0xbdb76b,darkmagenta:9109643,darkolivegreen:5597999,darkorange:0xff8c00,darkorchid:0x9932cc,darkred:9109504,darksalmon:0xe9967a,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:0xff1493,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:0xb22222,floralwhite:0xfffaf0,forestgreen:2263842,fuchsia:0xff00ff,gainsboro:0xdcdcdc,ghostwhite:0xf8f8ff,gold:0xffd700,goldenrod:0xdaa520,gray:8421504,green:32768,greenyellow:0xadff2f,grey:8421504,honeydew:0xf0fff0,hotpink:0xff69b4,indianred:0xcd5c5c,indigo:4915330,ivory:0xfffff0,khaki:0xf0e68c,lavender:0xe6e6fa,lavenderblush:0xfff0f5,lawngreen:8190976,lemonchiffon:0xfffacd,lightblue:0xadd8e6,lightcoral:0xf08080,lightcyan:0xe0ffff,lightgoldenrodyellow:0xfafad2,lightgray:0xd3d3d3,lightgreen:9498256,lightgrey:0xd3d3d3,lightpink:0xffb6c1,lightsalmon:0xffa07a,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:0xb0c4de,lightyellow:0xffffe0,lime:65280,limegreen:3329330,linen:0xfaf0e6,magenta:0xff00ff,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:0xba55d3,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:0xc71585,midnightblue:1644912,mintcream:0xf5fffa,mistyrose:0xffe4e1,moccasin:0xffe4b5,navajowhite:0xffdead,navy:128,oldlace:0xfdf5e6,olive:8421376,olivedrab:7048739,orange:0xffa500,orangered:0xff4500,orchid:0xda70d6,palegoldenrod:0xeee8aa,palegreen:0x98fb98,paleturquoise:0xafeeee,palevioletred:0xdb7093,papayawhip:0xffefd5,peachpuff:0xffdab9,peru:0xcd853f,pink:0xffc0cb,plum:0xdda0dd,powderblue:0xb0e0e6,purple:8388736,rebeccapurple:6697881,red:0xff0000,rosybrown:0xbc8f8f,royalblue:4286945,saddlebrown:9127187,salmon:0xfa8072,sandybrown:0xf4a460,seagreen:3050327,seashell:0xfff5ee,sienna:0xa0522d,silver:0xc0c0c0,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:0xfffafa,springgreen:65407,steelblue:4620980,tan:0xd2b48c,teal:32896,thistle:0xd8bfd8,tomato:0xff6347,turquoise:4251856,violet:0xee82ee,wheat:0xf5deb3,white:0xffffff,whitesmoke:0xf5f5f5,yellow:0xffff00,yellowgreen:0x9acd32};function _(){return this.rgb().formatHex()}function x(){return this.rgb().formatRgb()}function b(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=c.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?w(t):3===n?new $(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?k(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?k(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=d.exec(e))?new $(t[1],t[2],t[3],1):(t=f.exec(e))?new $(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=p.exec(e))?k(t[1],t[2],t[3],t[4]):(t=g.exec(e))?k(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=m.exec(e))?M(t[1],t[2]/100,t[3]/100,1):(t=y.exec(e))?M(t[1],t[2]/100,t[3]/100,t[4]):v.hasOwnProperty(e)?w(v[e]):"transparent"===e?new $(NaN,NaN,NaN,0):null}function w(e){return new $(e>>16&255,e>>8&255,255&e,1)}function k(e,t,n,i){return i<=0&&(e=t=n=NaN),new $(e,t,n,i)}function S(e){return(e instanceof r||(e=b(e)),e)?new $((e=e.rgb()).r,e.g,e.b,e.opacity):new $}function E(e,t,n,i){return 1==arguments.length?S(e):new $(e,t,n,null==i?1:i)}function $(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}function C(){return`#${A(this.r)}${A(this.g)}${A(this.b)}`}function O(){let e=L(this.opacity);return`${1===e?"rgb(":"rgba("}${R(this.r)}, ${R(this.g)}, ${R(this.b)}${1===e?")":`, ${e})`}`}function L(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function R(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function A(e){return((e=R(e))<16?"0":"")+e.toString(16)}function M(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new T(e,t,n,i)}function I(e){if(e instanceof T)return new T(e.h,e.s,e.l,e.opacity);if(e instanceof r||(e=b(e)),!e)return new T;if(e instanceof T)return e;var t=(e=e.rgb()).r/255,n=e.g/255,i=e.b/255,o=Math.min(t,n,i),s=Math.max(t,n,i),a=NaN,l=s-o,u=(s+o)/2;return l?(a=t===s?(n-i)/l+(n<i)*6:n===s?(i-t)/l+2:(t-n)/l+4,l/=u<.5?s+o:2-s-o,a*=60):l=u>0&&u<1?0:a,new T(a,l,u,e.opacity)}function N(e,t,n,i){return 1==arguments.length?I(e):new T(e,t,n,null==i?1:i)}function T(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}function z(e){return(e=(e||0)%360)<0?e+360:e}function P(e){return Math.max(0,Math.min(1,e||0))}function F(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}(0,i.default)(r,b,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:_,formatHex:_,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return I(this).formatHsl()},formatRgb:x,toString:x}),(0,i.default)($,E,(0,i.extend)(r,{brighter(e){return e=null==e?a:Math.pow(a,e),new $(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?o:Math.pow(o,e),new $(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new $(R(this.r),R(this.g),R(this.b),L(this.opacity))},displayable(){return -.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:C,formatHex:C,formatHex8:function(){return`#${A(this.r)}${A(this.g)}${A(this.b)}${A((isNaN(this.opacity)?1:this.opacity)*255)}`},formatRgb:O,toString:O})),(0,i.default)(T,N,(0,i.extend)(r,{brighter(e){return e=null==e?a:Math.pow(a,e),new T(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?o:Math.pow(o,e),new T(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new $(F(e>=240?e-240:e+120,r,i),F(e,r,i),F(e<120?e+240:e-120,r,i),this.opacity)},clamp(){return new T(z(this.h),P(this.s),P(this.l),L(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let e=L(this.opacity);return`${1===e?"hsl(":"hsla("}${z(this.h)}, ${100*P(this.s)}%, ${100*P(this.l)}%${1===e?")":`, ${e})`}`}}))}),a("bfWFq",function(t,n){function i(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function r(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}e(t.exports,"default",()=>i),e(t.exports,"extend",()=>r)});var l={};function u(e,t=null){console.log(`[CSVParser] ${e}`),t&&console.log(t)}function h(e){u("Validating CSV fields",e);let t=["id","name","gender"].filter(t=>!e.includes(t));if(t.length>0)throw Error(`Missing required fields: ${t.join(", ")}`);u("All required fields present")}function c(e){u(`Processing ${e.length} rows of CSV data`);let t=e.map(e=>{try{return{id:e.id,name:e.name.trim(),gender:e.gender.trim(),spouse_name:e.spouse_name?e.spouse_name.trim():null,father_name:e.father_name?e.father_name.trim():null,mother_name:e.mother_name?e.mother_name.trim():null,birth_date:e.birth_date?e.birth_date.trim():null,death_date:e.death_date?e.death_date.trim():null,native_place:e.native_place?e.native_place.trim():null,father_id:e.father_id?e.father_id.trim():null,mother_id:e.mother_id?e.mother_id.trim():null,spouse_id:e.spouse_id?e.spouse_id.trim():null}}catch(t){throw u("Error processing row",{row:e,error:t}),Error(`Error processing row with ID ${e.id||"unknown"}: ${t.message}`)}});return u(`Successfully processed ${t.length} rows`),t}function d(e,t=null){console.log(`[FamilyTreeBuilder] ${e}`),t&&console.log(t)}function f(e,t=null){if(d("Starting family tree construction",{rootPersonId:t}),!e||0===e.length)throw Error("No data provided for building family tree");d("Creating individuals map");let n=new Map;if(e.forEach(e=>{let t=JSON.parse(JSON.stringify(e));t.parents=[],t.children=[],t.spouses=[],t.gender=function(e){if(!e)return"unknown";let t=e.toString().trim().toLowerCase();return"m"===t||"male"===t||"ம"===t||"ஆண்"===t?"male":"f"===t||"female"===t||"பெ"===t||"பெண்"===t?"female":"unknown"}(t.gender),n.set(t.id,t)}),d(`Created individuals map with ${n.size} individuals`),d("Building relationships"),e.forEach(e=>{if(!n.has(e.id))return;let t=n.get(e.id);if(e.father_id&&n.has(e.father_id)){t.parents.push(e.father_id);let i=n.get(e.father_id);i.children.includes(e.id)||i.children.push(e.id)}if(e.mother_id&&n.has(e.mother_id)){t.parents.push(e.mother_id);let i=n.get(e.mother_id);i.children.includes(e.id)||i.children.push(e.id)}if(e.spouse_id&&n.has(e.spouse_id)){t.spouses.includes(e.spouse_id)||t.spouses.push(e.spouse_id);let i=n.get(e.spouse_id);i.spouses.includes(e.id)||i.spouses.push(e.id)}}),!t||!n.has(t)){d("No valid root person ID provided, using default selection");let i=Array.from(n.values()).filter(e=>0===e.parents.length);i.length>0?(t=i[0].id,d(`Selected person without parents as root: ${t}`)):(t=e[0].id,d(`Selected first person as root: ${t}`))}if(t){if(d(`Filtering family tree for root person: ${t}`),!n.get(t))throw Error(`Root person with ID ${t} not found in data`);let e=new Map,i=new Set;!function t(r){if(i.has(r))return;i.add(r);let o=n.get(r);o&&(e.set(r,o),o.spouses.forEach(t=>{n.has(t)&&!i.has(t)&&(e.set(t,n.get(t)),i.add(t))}),o.children.forEach(e=>{t(e)}))}(t),n=e,d(`Filtered family tree to ${n.size} individuals`)}d("Calculating generations using new rules"),n.forEach(e=>{e.generation=null}),d("First pass: assigning gen 0 to people with no parents and no spouses"),n.forEach(e=>{0===e.parents.length&&0===e.spouses.length&&(e.generation=0,d(`Assigned gen 0 to person ${e.id} (no parents, no spouse)`))});let i=!0,r=0;for(;i&&r<10;)i=!1,r++,d(`Generation calculation pass #${r}`),n.forEach(e=>{if(null===e.generation&&e.parents.length>0){let t=null;for(let r of e.parents){let o=n.get(r);if(o&&"male"===o.gender&&null!==o.generation){e.generation=o.generation+1,i=!0,d(`Assigned gen ${e.generation} to person ${e.id} (father's gen + 1)`);break}o&&"female"===o.gender&&null!==o.generation&&!t&&(t=o)}null===e.generation&&t&&(e.generation=t.generation+1,i=!0,d(`Assigned gen ${e.generation} to person ${e.id} (mother's gen + 1)`))}}),n.forEach(e=>{if(null===e.generation&&0===e.parents.length&&e.spouses.length>0)for(let t of e.spouses){let r=n.get(t);if(r&&null!==r.generation){e.generation=r.generation,i=!0,d(`Assigned gen ${e.generation} to person ${e.id} (same as spouse)`);break}}}),9===r&&(d("Maximum iteration count reached, assigning default generation 0 to remaining individuals"),n.forEach(e=>{null===e.generation&&(e.generation=0,d(`Assigned default gen 0 to person ${e.id} (couldn't determine otherwise)`))}));d(`Generation calculation completed in ${r} iterations`),d("Calculating child orders");let o=new Map,s=new Map;e.forEach((e,t)=>{s.set(e.id,t)}),n.forEach(e=>{if(0===e.parents.length)return;let t=[...e.parents].sort().join(":");o.has(t)||o.set(t,[]),o.get(t).push(e)}),o.forEach(e=>{e.sort((e,t)=>{if(!e.birth_date&&!t.birth_date)return s.get(e.id)-s.get(t.id);if(!e.birth_date)return -1;if(!t.birth_date)return 1;let n=new Date(e.birth_date),i=new Date(t.birth_date);return n.getTime()===i.getTime()?s.get(e.id)-s.get(t.id):n-i}),e.forEach((t,n)=>{t.birthOrder=n+1,t.totalSiblings=e.length})});let a=0,l=0,u=0;n.forEach(e=>{e.parents.length>0&&a++,e.children.length>0&&l++,e.spouses.length>0&&u++}),d("Family tree statistics",{individuals:n.size,withParents:a,withChildren:l,withSpouses:u});let h=1/0,c=-1/0;n.forEach(e=>{void 0!==e.generation&&(h=Math.min(h,e.generation),c=Math.max(c,e.generation))});let p=c-h+1;return d(`Found ${p} generations (min: ${h}, max: ${c})`),{individuals:Array.from(n.values()),rootPersonId:t,generations:p,minGeneration:h,maxGeneration:c}}ev=function e(){var t,n="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n?n:{},i=!n.document&&!!n.postMessage,r=n.IS_PAPA_WORKER||!1,o={},s=0,a={};function l(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(e){var t=_(e);t.chunkSize=parseInt(t.chunkSize),e.step||e.chunk||(t.chunkSize=null),this._handle=new f(t),(this._handle.streamer=this)._config=t}).call(this,e),this.parseChunk=function(e,t){var i=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<i){let t=this._config.newline;t||(o=this._config.quoteChar||'"',t=this._handle.guessLineEndings(e,o)),e=[...e.split(t).slice(i)].join(t)}this.isFirstChunk&&b(this._config.beforeFirstChunk)&&void 0!==(o=this._config.beforeFirstChunk(e))&&(e=o),this.isFirstChunk=!1,this._halted=!1;var i=this._partialLine+e,o=(this._partialLine="",this._handle.parse(i,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(e=o.meta.cursor,this._finished||(this._partialLine=i.substring(e-this._baseIndex),this._baseIndex=e),o&&o.data&&(this._rowCount+=o.data.length),i=this._finished||this._config.preview&&this._rowCount>=this._config.preview,r)n.postMessage({results:o,workerId:a.WORKER_ID,finished:i});else if(b(this._config.chunk)&&!t){if(this._config.chunk(o,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=o=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(o.data),this._completeResults.errors=this._completeResults.errors.concat(o.errors),this._completeResults.meta=o.meta),this._completed||!i||!b(this._config.complete)||o&&o.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),i||o&&o.meta.paused||this._nextChunk(),o}this._halted=!0},this._sendError=function(e){b(this._config.error)?this._config.error(e):r&&this._config.error&&n.postMessage({workerId:a.WORKER_ID,error:e,finished:!1})}}function u(e){var t;(e=e||{}).chunkSize||(e.chunkSize=a.RemoteChunkSize),l.call(this,e),this._nextChunk=i?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(e){this._input=e,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),i||(t.onload=x(this._chunkLoaded,this),t.onerror=x(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!i),this._config.downloadRequestHeaders){var e,n,r=this._config.downloadRequestHeaders;for(n in r)t.setRequestHeader(n,r[n])}this._config.chunkSize&&(e=this._start+this._config.chunkSize-1,t.setRequestHeader("Range","bytes="+this._start+"-"+e));try{t.send(this._config.downloadRequestBody)}catch(e){this._chunkError(e.message)}i&&0===t.status&&this._chunkError()}},this._chunkLoaded=function(){let e;4===t.readyState&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize||t.responseText.length,this._finished=!this._config.chunkSize||this._start>=(null!==(e=(e=t).getResponseHeader("Content-Range"))?parseInt(e.substring(e.lastIndexOf("/")+1)):-1),this.parseChunk(t.responseText)))},this._chunkError=function(e){e=t.statusText||e,this._sendError(Error(e))}}function h(e){(e=e||{}).chunkSize||(e.chunkSize=a.LocalChunkSize),l.call(this,e);var t,n,i="undefined"!=typeof FileReader;this.stream=function(e){this._input=e,n=e.slice||e.webkitSlice||e.mozSlice,i?((t=new FileReader).onload=x(this._chunkLoaded,this),t.onerror=x(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var e=this._input,r=(this._config.chunkSize&&(r=Math.min(this._start+this._config.chunkSize,this._input.size),e=n.call(e,this._start,r)),t.readAsText(e,this._config.encoding));i||this._chunkLoaded({target:{result:r}})},this._chunkLoaded=function(e){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(e.target.result)},this._chunkError=function(){this._sendError(t.error)}}function c(e){var t;l.call(this,e=e||{}),this.stream=function(e){return t=e,this._nextChunk()},this._nextChunk=function(){var e,n;if(!this._finished)return t=(e=this._config.chunkSize)?(n=t.substring(0,e),t.substring(e)):(n=t,""),this._finished=!t,this.parseChunk(n)}}function d(e){l.call(this,e=e||{});var t=[],n=!0,i=!1;this.pause=function(){l.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){l.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(e){this._input=e,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){i&&1===t.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):n=!0},this._streamData=x(function(e){try{t.push("string"==typeof e?e:e.toString(this._config.encoding)),n&&(n=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(e){this._streamError(e)}},this),this._streamError=x(function(e){this._streamCleanUp(),this._sendError(e)},this),this._streamEnd=x(function(){this._streamCleanUp(),i=!0,this._streamData("")},this),this._streamCleanUp=x(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function f(e){var t,n,i,r,o=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,s=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,l=this,u=0,h=0,c=!1,d=!1,f=[],m={data:[],errors:[],meta:{}};function y(t){return"greedy"===e.skipEmptyLines?""===t.join("").trim():1===t.length&&0===t[0].length}function v(){if(m&&i&&(w("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+a.DefaultDelimiter+"'"),i=!1),e.skipEmptyLines&&(m.data=m.data.filter(function(e){return!y(e)})),x()){if(m)if(Array.isArray(m.data[0])){for(var t,n=0;x()&&n<m.data.length;n++)m.data[n].forEach(r);m.data.splice(0,1)}else m.data.forEach(r);function r(t,n){b(e.transformHeader)&&(t=e.transformHeader(t,n)),f.push(t)}}function l(t,n){for(var i=e.header?{}:[],r=0;r<t.length;r++){var a=r,l=t[r],l=((t,n)=>(e.dynamicTypingFunction&&void 0===e.dynamicTyping[t]&&(e.dynamicTyping[t]=e.dynamicTypingFunction(t)),!0===(e.dynamicTyping[t]||e.dynamicTyping))?"true"===n||"TRUE"===n||"false"!==n&&"FALSE"!==n&&((e=>{if(o.test(e)&&-0x20000000000000<(e=parseFloat(e))&&e<0x20000000000000)return 1})(n)?parseFloat(n):s.test(n)?new Date(n):""===n?null:n):n)(a=e.header?r>=f.length?"__parsed_extra":f[r]:a,l=e.transform?e.transform(l,a):l);"__parsed_extra"===a?(i[a]=i[a]||[],i[a].push(l)):i[a]=l}return e.header&&(r>f.length?w("FieldMismatch","TooManyFields","Too many fields: expected "+f.length+" fields but parsed "+r,h+n):r<f.length&&w("FieldMismatch","TooFewFields","Too few fields: expected "+f.length+" fields but parsed "+r,h+n)),i}m&&(e.header||e.dynamicTyping||e.transform)&&(t=1,!m.data.length||Array.isArray(m.data[0])?(m.data=m.data.map(l),t=m.data.length):m.data=l(m.data,0),e.header&&m.meta&&(m.meta.fields=f),h+=t)}function x(){return e.header&&0===f.length}function w(e,t,n,i){e={type:e,code:t,message:n},void 0!==i&&(e.row=i),m.errors.push(e)}b(e.step)&&(r=e.step,e.step=function(t){m=t,x()?v():(v(),0!==m.data.length&&(u+=t.data.length,e.preview&&u>e.preview?n.abort():(m.data=m.data[0],r(m,l))))}),this.parse=function(r,o,s){var l=e.quoteChar||'"',l=(e.newline||(e.newline=this.guessLineEndings(r,l)),i=!1,e.delimiter?b(e.delimiter)&&(e.delimiter=e.delimiter(r),m.meta.delimiter=e.delimiter):((l=((t,n,i,r,o)=>{var s,l,u,h;o=o||[",","	","|",";",a.RECORD_SEP,a.UNIT_SEP];for(var c=0;c<o.length;c++){for(var d,f=o[c],p=0,m=0,v=0,_=(u=void 0,new g({comments:r,delimiter:f,newline:n,preview:10}).parse(t)),x=0;x<_.data.length;x++)i&&y(_.data[x])?v++:(m+=d=_.data[x].length,void 0===u?u=d:0<d&&(p+=Math.abs(d-u),u=d));0<_.data.length&&(m/=_.data.length-v),(void 0===l||p<=l)&&(void 0===h||h<m)&&1.99<m&&(l=p,s=f,h=m)}return{successful:!!(e.delimiter=s),bestDelimiter:s}})(r,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess)).successful?e.delimiter=l.bestDelimiter:(i=!0,e.delimiter=a.DefaultDelimiter),m.meta.delimiter=e.delimiter),_(e));return e.preview&&e.header&&l.preview++,t=r,m=(n=new g(l)).parse(t,o,s),v(),c?{meta:{paused:!0}}:m||{meta:{paused:!1}}},this.paused=function(){return c},this.pause=function(){c=!0,n.abort(),t=b(e.chunk)?"":t.substring(n.getCharIndex())},this.resume=function(){l.streamer._halted?(c=!1,l.streamer.parseChunk(t,!0)):setTimeout(l.resume,3)},this.aborted=function(){return d},this.abort=function(){d=!0,n.abort(),m.meta.aborted=!0,b(e.complete)&&e.complete(m),t=""},this.guessLineEndings=function(e,t){e=e.substring(0,1048576);var t=RegExp(p(t)+"([^]*?)"+p(t),"gm"),n=(e=e.replace(t,"")).split("\r"),t=e.split("\n"),e=1<t.length&&t[0].length<n[0].length;if(1===n.length||e)return"\n";for(var i=0,r=0;r<n.length;r++)"\n"===n[r][0]&&i++;return i>=n.length/2?"\r\n":"\r"}}function p(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function g(e){var t=(e=e||{}).delimiter,n=e.newline,i=e.comments,r=e.step,o=e.preview,s=e.fastMode,l=null,u=!1,h=null==e.quoteChar?'"':e.quoteChar,c=h;if(void 0!==e.escapeChar&&(c=e.escapeChar),("string"!=typeof t||-1<a.BAD_DELIMITERS.indexOf(t))&&(t=","),i===t)throw Error("Comment character same as delimiter");!0===i?i="#":("string"!=typeof i||-1<a.BAD_DELIMITERS.indexOf(i))&&(i=!1),"\n"!==n&&"\r"!==n&&"\r\n"!==n&&(n="\n");var d=0,f=!1;this.parse=function(a,g,m){if("string"!=typeof a)throw Error("Input must be a string");var y=a.length,v=t.length,_=n.length,x=i.length,w=b(r),k=[],S=[],E=[],$=d=0;if(!a)return F();if(s||!1!==s&&-1===a.indexOf(h)){for(var C=a.split(n),O=0;O<C.length;O++){if(E=C[O],d+=E.length,O!==C.length-1)d+=n.length;else if(m)break;if(!i||E.substring(0,x)!==i){if(w){if(k=[],N(E.split(t)),D(),f)return F()}else N(E.split(t));if(o&&o<=O)return k=k.slice(0,o),F(!0)}}return F()}for(var L=a.indexOf(t,d),R=a.indexOf(n,d),A=RegExp(p(c)+p(h),"g"),M=a.indexOf(h,d);;)if(a[d]===h)for(M=d,d++;;){if(-1===(M=a.indexOf(h,M+1)))return m||S.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:k.length,index:d}),z();if(M===y-1)return z(a.substring(d,M).replace(A,h));if(h===c&&a[M+1]===c)M++;else if(h===c||0===M||a[M-1]!==c){-1!==L&&L<M+1&&(L=a.indexOf(t,M+1));var I=T(-1===(R=-1!==R&&R<M+1?a.indexOf(n,M+1):R)?L:Math.min(L,R));if(a.substr(M+1+I,v)===t){E.push(a.substring(d,M).replace(A,h)),a[d=M+1+I+v]!==h&&(M=a.indexOf(h,d)),L=a.indexOf(t,d),R=a.indexOf(n,d);break}if(I=T(R),a.substring(M+1+I,M+1+I+_)===n){if(E.push(a.substring(d,M).replace(A,h)),P(M+1+I+_),L=a.indexOf(t,d),M=a.indexOf(h,d),w&&(D(),f))return F();if(o&&k.length>=o)return F(!0);break}S.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:k.length,index:d}),M++}}else if(i&&0===E.length&&a.substring(d,d+x)===i){if(-1===R)return F();d=R+_,R=a.indexOf(n,d),L=a.indexOf(t,d)}else if(-1!==L&&(L<R||-1===R))E.push(a.substring(d,L)),d=L+v,L=a.indexOf(t,d);else{if(-1===R)break;if(E.push(a.substring(d,R)),P(R+_),w&&(D(),f))return F();if(o&&k.length>=o)return F(!0)}return z();function N(e){k.push(e),$=d}function T(e){return -1!==e&&(e=a.substring(M+1,e))&&""===e.trim()?e.length:0}function z(e){return m||(void 0===e&&(e=a.substring(d)),E.push(e),d=y,N(E),w&&D()),F()}function P(e){d=e,N(E),E=[],R=a.indexOf(n,d)}function F(i){if(e.header&&!g&&k.length&&!u){var r=k[0],o={},s=new Set(r);let t=!1;for(let n=0;n<r.length;n++){let i=r[n];if(o[i=b(e.transformHeader)?e.transformHeader(i,n):i]){let e,a=o[i];for(;e=i+"_"+a,a++,s.has(e););s.add(e),r[n]=e,o[i]++,t=!0,(l=null===l?{}:l)[e]=i}else o[i]=1,r[n]=i;s.add(i)}t&&console.warn("Duplicate headers found and renamed."),u=!0}return{data:k,errors:S,meta:{delimiter:t,linebreak:n,aborted:f,truncated:!!i,cursor:$+(g||0),renamedHeaders:l}}}function D(){r(F()),k=[],S=[]}},this.abort=function(){f=!0},this.getCharIndex=function(){return d}}function m(e){var t=e.data,n=o[t.workerId],i=!1;if(t.error)n.userError(t.error,t.file);else if(t.results&&t.results.data){var r={abort:function(){i=!0,y(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:v,resume:v};if(b(n.userStep)){for(var s=0;s<t.results.data.length&&(n.userStep({data:t.results.data[s],errors:t.results.errors,meta:t.results.meta},r),!i);s++);delete t.results}else b(n.userChunk)&&(n.userChunk(t.results,r,t.file),delete t.results)}t.finished&&!i&&y(t.workerId,t.results)}function y(e,t){var n=o[e];b(n.userComplete)&&n.userComplete(t),n.terminate(),delete o[e]}function v(){throw Error("Not implemented.")}function _(e){if("object"!=typeof e||null===e)return e;var t,n=Array.isArray(e)?[]:{};for(t in e)n[t]=_(e[t]);return n}function x(e,t){return function(){e.apply(t,arguments)}}function b(e){return"function"==typeof e}return a.parse=function(t,i){var r,l,f,p=(i=i||{}).dynamicTyping||!1;if(b(p)&&(i.dynamicTypingFunction=p,p={}),i.dynamicTyping=p,i.transform=!!b(i.transform)&&i.transform,!i.worker||!a.WORKERS_SUPPORTED){let e;return p=null,a.NODE_STREAM_INPUT,"string"==typeof t?(t=65279!==(e=t).charCodeAt(0)?e:e.slice(1),p=new(i.download?u:c)(i)):!0===t.readable&&b(t.read)&&b(t.on)?p=new d(i):(n.File&&t instanceof File||t instanceof Object)&&(p=new h(i)),p.stream(t)}(p=!!a.WORKERS_SUPPORTED&&(l=n.URL||n.webkitURL||null,f=e.toString(),r=a.BLOB_URL||(a.BLOB_URL=l.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",f,")();"],{type:"text/javascript"}))),(r=new n.Worker(r)).onmessage=m,r.id=s++,o[r.id]=r)).userStep=i.step,p.userChunk=i.chunk,p.userComplete=i.complete,p.userError=i.error,i.step=b(i.step),i.chunk=b(i.chunk),i.complete=b(i.complete),i.error=b(i.error),delete i.worker,p.postMessage({input:t,config:i,workerId:p.id})},a.unparse=function(e,t){var n=!1,i=!0,r=",",o="\r\n",s='"',l=s+s,u=!1,h=null,c=!1,d=((()=>{if("object"==typeof t){if("string"!=typeof t.delimiter||a.BAD_DELIMITERS.filter(function(e){return -1!==t.delimiter.indexOf(e)}).length||(r=t.delimiter),("boolean"==typeof t.quotes||"function"==typeof t.quotes||Array.isArray(t.quotes))&&(n=t.quotes),"boolean"!=typeof t.skipEmptyLines&&"string"!=typeof t.skipEmptyLines||(u=t.skipEmptyLines),"string"==typeof t.newline&&(o=t.newline),"string"==typeof t.quoteChar&&(s=t.quoteChar),"boolean"==typeof t.header&&(i=t.header),Array.isArray(t.columns)){if(0===t.columns.length)throw Error("Option columns is empty");h=t.columns}void 0!==t.escapeChar&&(l=t.escapeChar+s),t.escapeFormulae instanceof RegExp?c=t.escapeFormulae:"boolean"==typeof t.escapeFormulae&&t.escapeFormulae&&(c=/^[=+\-@\t\r].*$/)}})(),RegExp(p(s),"g"));if("string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return f(null,e,u);if("object"==typeof e[0])return f(h||Object.keys(e[0]),e,u)}else if("object"==typeof e)return"string"==typeof e.data&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields||h),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:"object"==typeof e.data[0]?Object.keys(e.data[0]):[]),Array.isArray(e.data[0])||"object"==typeof e.data[0]||(e.data=[e.data])),f(e.fields||[],e.data||[],u);throw Error("Unable to serialize unrecognized input");function f(e,t,n){var s="",a=("string"==typeof e&&(e=JSON.parse(e)),"string"==typeof t&&(t=JSON.parse(t)),Array.isArray(e)&&0<e.length),l=!Array.isArray(t[0]);if(a&&i){for(var u=0;u<e.length;u++)0<u&&(s+=r),s+=g(e[u],u);0<t.length&&(s+=o)}for(var h=0;h<t.length;h++){var c=(a?e:t[h]).length,d=!1,f=a?0===Object.keys(t[h]).length:0===t[h].length;if(n&&!a&&(d="greedy"===n?""===t[h].join("").trim():1===t[h].length&&0===t[h][0].length),"greedy"===n&&a){for(var p=[],m=0;m<c;m++){var y=l?e[m]:m;p.push(t[h][y])}d=""===p.join("").trim()}if(!d){for(var v=0;v<c;v++){0<v&&!f&&(s+=r);var _=a&&l?e[v]:v;s+=g(t[h][_],v)}h<t.length-1&&(!n||0<c&&!f)&&(s+=o)}}return s}function g(e,t){var i,o;return null==e?"":e.constructor===Date?JSON.stringify(e).slice(1,25):(o=!1,c&&"string"==typeof e&&c.test(e)&&(e="'"+e,o=!0),i=e.toString().replace(d,l),(o=o||!0===n||"function"==typeof n&&n(e,t)||Array.isArray(n)&&n[t]||((e,t)=>{for(var n=0;n<t.length;n++)if(-1<e.indexOf(t[n]))return!0;return!1})(i,a.BAD_DELIMITERS)||-1<i.indexOf(r)||" "===i.charAt(0)||" "===i.charAt(i.length-1))?s+i+s:i)}},a.RECORD_SEP="\x1e",a.UNIT_SEP="\x1f",a.BYTE_ORDER_MARK="\uFEFF",a.BAD_DELIMITERS=["\r","\n",'"',a.BYTE_ORDER_MARK],a.WORKERS_SUPPORTED=!i&&!!n.Worker,a.NODE_STREAM_INPUT=1,a.LocalChunkSize=0xa00000,a.RemoteChunkSize=5242880,a.DefaultDelimiter=",",a.Parser=g,a.ParserHandle=f,a.NetworkStreamer=u,a.FileStreamer=h,a.StringStreamer=c,a.ReadableStreamStreamer=d,n.jQuery&&((t=n.jQuery).fn.parse=function(e){var i=e.config||{},r=[];return this.each(function(e){if(!("INPUT"===t(this).prop("tagName").toUpperCase()&&"file"===t(this).attr("type").toLowerCase()&&n.FileReader)||!this.files||0===this.files.length)return!0;for(var o=0;o<this.files.length;o++)r.push({file:this.files[o],inputElem:this,instanceConfig:t.extend({},i)})}),o(),this;function o(){if(0===r.length)b(e.complete)&&e.complete();else{var n,i,o,l=r[0];if(b(e.before)){var u=e.before(l.file,l.inputElem);if("object"==typeof u){if("abort"===u.action)return n=l.file,i=l.inputElem,o=u.reason,void(b(e.error)&&e.error({name:"AbortError"},n,i,o));if("skip"===u.action)return void s();"object"==typeof u.config&&(l.instanceConfig=t.extend(l.instanceConfig,u.config))}else if("skip"===u)return void s()}var h=l.instanceConfig.complete;l.instanceConfig.complete=function(e){b(h)&&h(e,l.file,l.inputElem),s()},a.parse(l.file,l.instanceConfig)}}function s(){r.splice(0,1),o()}}),r&&(n.onmessage=function(e){e=e.data,void 0===a.WORKER_ID&&e&&(a.WORKER_ID=e.workerId),"string"==typeof e.input?n.postMessage({workerId:a.WORKER_ID,results:a.parse(e.input,e.config),finished:!0}):(n.File&&e.input instanceof File||e.input instanceof Object)&&(e=a.parse(e.input,e.config))&&n.postMessage({workerId:a.WORKER_ID,results:e,finished:!0})}),(u.prototype=Object.create(l.prototype)).constructor=u,(h.prototype=Object.create(l.prototype)).constructor=h,(c.prototype=Object.create(c.prototype)).constructor=c,(d.prototype=Object.create(l.prototype)).constructor=d,a},"function"==typeof define&&define.amd?define([],ev):l=ev();var p={value:()=>{}};function g(){for(var e,t=0,n=arguments.length,i={};t<n;++t){if(!(e=arguments[t]+"")||e in i||/[\s.]/.test(e))throw Error("illegal type: "+e);i[e]=[]}return new m(i)}function m(e){this._=e}function y(e,t,n){for(var i=0,r=e.length;i<r;++i)if(e[i].name===t){e[i]=p,e=e.slice(0,i).concat(e.slice(i+1));break}return null!=n&&e.push({name:t,value:n}),e}function v(){}function _(e){return null==e?v:function(){return this.querySelector(e)}}function x(){return[]}function b(e){return null==e?x:function(){return this.querySelectorAll(e)}}function w(e){return function(){return this.matches(e)}}function k(e){return function(t){return t.matches(e)}}m.prototype=g.prototype={constructor:m,on:function(e,t){var n,i=this._,r=(e+"").trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");if(n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),e&&!i.hasOwnProperty(e))throw Error("unknown type: "+e);return{type:e,name:t}}),o=-1,s=r.length;if(arguments.length<2){for(;++o<s;)if((n=(e=r[o]).type)&&(n=function(e,t){for(var n,i=0,r=e.length;i<r;++i)if((n=e[i]).name===t)return n.value}(i[n],e.name)))return n;return}if(null!=t&&"function"!=typeof t)throw Error("invalid callback: "+t);for(;++o<s;)if(n=(e=r[o]).type)i[n]=y(i[n],e.name,t);else if(null==t)for(n in i)i[n]=y(i[n],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new m(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,i,r=Array(n),o=0;o<n;++o)r[o]=arguments[o+2];if(!this._.hasOwnProperty(e))throw Error("unknown type: "+e);for(i=this._[e],o=0,n=i.length;o<n;++o)i[o].value.apply(t,r)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw Error("unknown type: "+e);for(var i=this._[e],r=0,o=i.length;r<o;++r)i[r].value.apply(t,n)}};var S=Array.prototype.find;function E(){return this.firstElementChild}var $=Array.prototype.filter;function C(){return Array.from(this.children)}function O(e){return Array(e.length)}function L(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function R(e,t,n,i,r,o){for(var s,a=0,l=t.length,u=o.length;a<u;++a)(s=t[a])?(s.__data__=o[a],i[a]=s):n[a]=new L(e,o[a]);for(;a<l;++a)(s=t[a])&&(r[a]=s)}function A(e,t,n,i,r,o,s){var a,l,u,h=new Map,c=t.length,d=o.length,f=Array(c);for(a=0;a<c;++a)(l=t[a])&&(f[a]=u=s.call(l,l.__data__,a,t)+"",h.has(u)?r[a]=l:h.set(u,l));for(a=0;a<d;++a)u=s.call(e,o[a],a,o)+"",(l=h.get(u))?(i[a]=l,l.__data__=o[a],h.delete(u)):n[a]=new L(e,o[a]);for(a=0;a<c;++a)(l=t[a])&&h.get(f[a])===l&&(r[a]=l)}function M(e){return e.__data__}function I(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}L.prototype={constructor:L,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var N="http://www.w3.org/1999/xhtml",T={svg:"http://www.w3.org/2000/svg",xhtml:N,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function z(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),T.hasOwnProperty(t)?{space:T[t],local:e}:e}function P(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function F(e,t){return e.style.getPropertyValue(t)||P(e).getComputedStyle(e,null).getPropertyValue(t)}function D(e){return e.trim().split(/^|\s+/)}function j(e){return e.classList||new B(e)}function B(e){this._node=e,this._names=D(e.getAttribute("class")||"")}function V(e,t){for(var n=j(e),i=-1,r=t.length;++i<r;)n.add(t[i])}function H(e,t){for(var n=j(e),i=-1,r=t.length;++i<r;)n.remove(t[i])}function U(){this.textContent=""}function K(){this.innerHTML=""}function q(){this.nextSibling&&this.parentNode.appendChild(this)}function G(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function W(e){var t=z(e);return(t.local?function(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}:function(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===N&&t.documentElement.namespaceURI===N?t.createElement(e):t.createElementNS(n,e)}})(t)}function Y(){return null}function X(){var e=this.parentNode;e&&e.removeChild(this)}function J(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Q(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Z(e){return function(){var t=this.__on;if(t){for(var n,i=0,r=-1,o=t.length;i<o;++i)(n=t[i],e.type&&n.type!==e.type||n.name!==e.name)?t[++r]=n:this.removeEventListener(n.type,n.listener,n.options);++r?t.length=r:delete this.__on}}}function ee(e,t,n){return function(){var i,r=this.__on,o=function(e){t.call(this,e,this.__data__)};if(r){for(var s=0,a=r.length;s<a;++s)if((i=r[s]).type===e.type&&i.name===e.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=n),i.value=t;return}}this.addEventListener(e.type,o,n),i={type:e.type,name:e.name,value:t,listener:o,options:n},r?r.push(i):this.__on=[i]}}function et(e,t,n){var i=P(e),r=i.CustomEvent;"function"==typeof r?r=new r(t,n):(r=i.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}B.prototype={add:function(e){0>this._names.indexOf(e)&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var en=[null];function ei(e,t){this._groups=e,this._parents=t}function er(){return new ei([[document.documentElement]],en)}function eo(e){return"string"==typeof e?new ei([[document.querySelector(e)]],[document.documentElement]):new ei([[e]],en)}ei.prototype=er.prototype={constructor:ei,select:function(e){"function"!=typeof e&&(e=_(e));for(var t=this._groups,n=t.length,i=Array(n),r=0;r<n;++r)for(var o,s,a=t[r],l=a.length,u=i[r]=Array(l),h=0;h<l;++h)(o=a[h])&&(s=e.call(o,o.__data__,h,a))&&("__data__"in o&&(s.__data__=o.__data__),u[h]=s);return new ei(i,this._parents)},selectAll:function(e){if("function"==typeof e){var t;t=e,e=function(){var e;return e=t.apply(this,arguments),null==e?[]:Array.isArray(e)?e:Array.from(e)}}else e=b(e);for(var n=this._groups,i=n.length,r=[],o=[],s=0;s<i;++s)for(var a,l=n[s],u=l.length,h=0;h<u;++h)(a=l[h])&&(r.push(e.call(a,a.__data__,h,l)),o.push(a));return new ei(r,o)},selectChild:function(e){var t;return this.select(null==e?E:(t="function"==typeof e?e:k(e),function(){return S.call(this.children,t)}))},selectChildren:function(e){var t;return this.selectAll(null==e?C:(t="function"==typeof e?e:k(e),function(){return $.call(this.children,t)}))},filter:function(e){"function"!=typeof e&&(e=w(e));for(var t=this._groups,n=t.length,i=Array(n),r=0;r<n;++r)for(var o,s=t[r],a=s.length,l=i[r]=[],u=0;u<a;++u)(o=s[u])&&e.call(o,o.__data__,u,s)&&l.push(o);return new ei(i,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,M);var n=t?A:R,i=this._parents,r=this._groups;"function"!=typeof e&&(v=e,e=function(){return v});for(var o=r.length,s=Array(o),a=Array(o),l=Array(o),u=0;u<o;++u){var h=i[u],c=r[u],d=c.length,f="object"==typeof(y=e.call(h,h&&h.__data__,u,i))&&"length"in y?y:Array.from(y),p=f.length,g=a[u]=Array(p),m=s[u]=Array(p);n(h,c,g,m,l[u]=Array(d),f,t);for(var y,v,_,x,b=0,w=0;b<p;++b)if(_=g[b]){for(b>=w&&(w=b+1);!(x=m[w])&&++w<p;);_._next=x||null}}return(s=new ei(s,i))._enter=a,s._exit=l,s},enter:function(){return new ei(this._enter||this._groups.map(O),this._parents)},exit:function(){return new ei(this._exit||this._groups.map(O),this._parents)},join:function(e,t,n){var i=this.enter(),r=this,o=this.exit();return"function"==typeof e?(i=e(i))&&(i=i.selection()):i=i.append(e+""),null!=t&&(r=t(r))&&(r=r.selection()),null==n?o.remove():n(o),i&&r?i.merge(r).order():r},merge:function(e){for(var t=e.selection?e.selection():e,n=this._groups,i=t._groups,r=n.length,o=i.length,s=Math.min(r,o),a=Array(r),l=0;l<s;++l)for(var u,h=n[l],c=i[l],d=h.length,f=a[l]=Array(d),p=0;p<d;++p)(u=h[p]||c[p])&&(f[p]=u);for(;l<r;++l)a[l]=n[l];return new ei(a,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var i,r=e[t],o=r.length-1,s=r[o];--o>=0;)(i=r[o])&&(s&&4^i.compareDocumentPosition(s)&&s.parentNode.insertBefore(i,s),s=i);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=I);for(var n=this._groups,i=n.length,r=Array(i),o=0;o<i;++o){for(var s,a=n[o],l=a.length,u=r[o]=Array(l),h=0;h<l;++h)(s=a[h])&&(u[h]=s);u.sort(t)}return new ei(r,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,o=i.length;r<o;++r){var s=i[r];if(s)return s}return null},size:function(){let e=0;for(let t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,i=t.length;n<i;++n)for(var r,o=t[n],s=0,a=o.length;s<a;++s)(r=o[s])&&e.call(r,r.__data__,s,o);return this},attr:function(e,t){var n=z(e);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==t?n.local?function(e){return function(){this.removeAttributeNS(e.space,e.local)}}:function(e){return function(){this.removeAttribute(e)}}:"function"==typeof t?n.local?function(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}:function(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}:n.local?function(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}:function(e,t){return function(){this.setAttribute(e,t)}})(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?function(e){return function(){this.style.removeProperty(e)}}:"function"==typeof t?function(e,t,n){return function(){var i=t.apply(this,arguments);null==i?this.style.removeProperty(e):this.style.setProperty(e,i,n)}}:function(e,t,n){return function(){this.style.setProperty(e,t,n)}})(e,t,null==n?"":n)):F(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?function(e){return function(){delete this[e]}}:"function"==typeof t?function(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}:function(e,t){return function(){this[e]=t}})(e,t)):this.node()[e]},classed:function(e,t){var n=D(e+"");if(arguments.length<2){for(var i=j(this.node()),r=-1,o=n.length;++r<o;)if(!i.contains(n[r]))return!1;return!0}return this.each(("function"==typeof t?function(e,t){return function(){(t.apply(this,arguments)?V:H)(this,e)}}:t?function(e){return function(){V(this,e)}}:function(e){return function(){H(this,e)}})(n,t))},text:function(e){return arguments.length?this.each(null==e?U:("function"==typeof e?function(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}:function(e){return function(){this.textContent=e}})(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?K:("function"==typeof e?function(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}:function(e){return function(){this.innerHTML=e}})(e)):this.node().innerHTML},raise:function(){return this.each(q)},lower:function(){return this.each(G)},append:function(e){var t="function"==typeof e?e:W(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function(e,t){var n="function"==typeof e?e:W(e),i=null==t?Y:"function"==typeof t?t:_(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})},remove:function(){return this.each(X)},clone:function(e){return this.select(e?Q:J)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var i,r,o=(e+"").trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}}),s=o.length;if(arguments.length<2){var a=this.node().__on;if(a){for(var l,u=0,h=a.length;u<h;++u)for(i=0,l=a[u];i<s;++i)if((r=o[i]).type===l.type&&r.name===l.name)return l.value}return}for(i=0,a=t?ee:Z;i<s;++i)this.each(a(o[i],t,n));return this},dispatch:function(e,t){return this.each(("function"==typeof t?function(e,t){return function(){return et(this,e,t.apply(this,arguments))}}:function(e,t){return function(){return et(this,e,t)}})(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i,r=e[t],o=0,s=r.length;o<s;++o)(i=r[o])&&(yield i)}};const es={capture:!0,passive:!1};function ea(e){e.preventDefault(),e.stopImmediatePropagation()}var el=(s("bYoiY"),s("bYoiY"));function eu(e,t,n,i,r){var o=e*e,s=o*e;return((1-3*e+3*o-s)*t+(4-6*o+3*s)*n+(1+3*e+3*o-3*s)*i+s*r)/6}var eh=e=>()=>e;function ec(e,t){var n=t-e;return n?function(t){return e+t*n}:eh(isNaN(e)?t:e)}var ed=function e(t){var n,i=1==(n=+t)?ec:function(e,t){var i,r,o;return t-e?(i=e,r=t,i=Math.pow(i,o=n),r=Math.pow(r,o)-i,o=1/o,function(e){return Math.pow(i+e*r,o)}):eh(isNaN(e)?t:e)};function r(e,t){var n=i((e=(0,el.rgb)(e)).r,(t=(0,el.rgb)(t)).r),r=i(e.g,t.g),o=i(e.b,t.b),s=ec(e.opacity,t.opacity);return function(t){return e.r=n(t),e.g=r(t),e.b=o(t),e.opacity=s(t),e+""}}return r.gamma=e,r}(1);function ef(e){return function(t){var n,i,r=t.length,o=Array(r),s=Array(r),a=Array(r);for(n=0;n<r;++n)i=(0,el.rgb)(t[n]),o[n]=i.r||0,s[n]=i.g||0,a[n]=i.b||0;return o=e(o),s=e(s),a=e(a),i.opacity=1,function(e){return i.r=o(e),i.g=s(e),i.b=a(e),i+""}}}function ep(e,t){return e*=1,t*=1,function(n){return e*(1-n)+t*n}}ef(function(e){var t=e.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),r=e[i],o=e[i+1],s=i>0?e[i-1]:2*r-o,a=i<t-1?e[i+2]:2*o-r;return eu((n-i/t)*t,s,r,o,a)}}),ef(function(e){var t=e.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*t),r=e[(i+t-1)%t],o=e[i%t],s=e[(i+1)%t],a=e[(i+2)%t];return eu((n-i/t)*t,r,o,s,a)}});var eg=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,em=RegExp(eg.source,"g");function ey(e,t){if(e=function(e){let t;for(;t=e.sourceEvent;)e=t;return e}(e),void 0===t&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=e.clientX,i.y=e.clientY,[(i=i.matrixTransform(t.getScreenCTM().inverse())).x,i.y]}if(t.getBoundingClientRect){var r=t.getBoundingClientRect();return[e.clientX-r.left-t.clientLeft,e.clientY-r.top-t.clientTop]}}return[e.pageX,e.pageY]}var ev,e_,ex,eb=0,ew=0,ek=0,eS=0,eE=0,e$=0,eC="object"==typeof performance&&performance.now?performance:Date,eO="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function eL(){return eE||(eO(eR),eE=eC.now()+e$)}function eR(){eE=0}function eA(){this._call=this._time=this._next=null}function eM(e,t,n){var i=new eA;return i.restart(e,t,n),i}function eI(){eE=(eS=eC.now())+e$,eb=ew=0;try{eL(),++eb;for(var e,t=e_;t;)(e=eE-t._time)>=0&&t._call.call(void 0,e),t=t._next;--eb}finally{eb=0,function(){for(var e,t,n=e_,i=1/0;n;)n._call?(i>n._time&&(i=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:e_=t);ex=e,eT(i)}(),eE=0}}function eN(){var e=eC.now(),t=e-eS;t>1e3&&(e$-=t,eS=e)}function eT(e){!eb&&(ew&&(ew=clearTimeout(ew)),e-eE>24?(e<1/0&&(ew=setTimeout(eI,e-eC.now()-e$)),ek&&(ek=clearInterval(ek))):(ek||(eS=eC.now(),ek=setInterval(eN,1e3)),eb=1,eO(eI)))}function ez(e,t,n){var i=new eA;return t=null==t?0:+t,i.restart(n=>{i.stop(),e(n+t)},t,n),i}eA.prototype=eM.prototype={constructor:eA,restart:function(e,t,n){if("function"!=typeof e)throw TypeError("callback is not a function");n=(null==n?eL():+n)+(null==t?0:+t),this._next||ex===this||(ex?ex._next=this:e_=this,ex=this),this._call=e,this._time=n,eT()},stop:function(){this._call&&(this._call=null,this._time=1/0,eT())}};var eP=g("start","end","cancel","interrupt"),eF=[];function eD(e,t,n,i,r,o){var s=e.__transition;if(s){if(n in s)return}else e.__transition={};!function(e,t,n){var i,r=e.__transition;function o(l){var u,h,c,d;if(1!==n.state)return a();for(u in r)if((d=r[u]).name===n.name){if(3===d.state)return ez(o);4===d.state?(d.state=6,d.timer.stop(),d.on.call("interrupt",e,e.__data__,d.index,d.group),delete r[u]):+u<t&&(d.state=6,d.timer.stop(),d.on.call("cancel",e,e.__data__,d.index,d.group),delete r[u])}if(ez(function(){3===n.state&&(n.state=4,n.timer.restart(s,n.delay,n.time),s(l))}),n.state=2,n.on.call("start",e,e.__data__,n.index,n.group),2===n.state){for(u=0,n.state=3,i=Array(c=n.tween.length),h=-1;u<c;++u)(d=n.tween[u].value.call(e,e.__data__,n.index,n.group))&&(i[++h]=d);i.length=h+1}}function s(t){for(var r=t<n.duration?n.ease.call(null,t/n.duration):(n.timer.restart(a),n.state=5,1),o=-1,s=i.length;++o<s;)i[o].call(e,r);5===n.state&&(n.on.call("end",e,e.__data__,n.index,n.group),a())}function a(){for(var i in n.state=6,n.timer.stop(),delete r[t],r)return;delete e.__transition}r[t]=n,n.timer=eM(function(e){n.state=1,n.timer.restart(o,n.delay,n.time),n.delay<=e&&o(e-n.delay)},0,n.time)}(e,n,{name:t,index:i,group:r,on:eP,tween:eF,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:0})}function ej(e,t){var n=eV(e,t);if(n.state>0)throw Error("too late; already scheduled");return n}function eB(e,t){var n=eV(e,t);if(n.state>3)throw Error("too late; already running");return n}function eV(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw Error("transition not found");return n}function eH(e,t){var n,i,r,o=e.__transition,s=!0;if(o){for(r in t=null==t?null:t+"",o){if((n=o[r]).name!==t){s=!1;continue}i=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(i?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete o[r]}s&&delete e.__transition}}var eU=180/Math.PI,eK={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function eq(e,t,n,i,r,o){var s,a,l;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(l=e*n+t*i)&&(n-=e*l,i-=t*l),(a=Math.sqrt(n*n+i*i))&&(n/=a,i/=a,l/=a),e*i<t*n&&(e=-e,t=-t,l=-l,s=-s),{translateX:r,translateY:o,rotate:Math.atan2(t,e)*eU,skewX:Math.atan(l)*eU,scaleX:s,scaleY:a}}function eG(e,t,n,i){function r(e){return e.length?e.pop()+" ":""}return function(o,s){var a,l,u,h,c=[],d=[];return o=e(o),s=e(s),!function(e,i,r,o,s,a){if(e!==r||i!==o){var l=s.push("translate(",null,t,null,n);a.push({i:l-4,x:ep(e,r)},{i:l-2,x:ep(i,o)})}else(r||o)&&s.push("translate("+r+t+o+n)}(o.translateX,o.translateY,s.translateX,s.translateY,c,d),a=o.rotate,a!==(l=s.rotate)?(a-l>180?l+=360:l-a>180&&(a+=360),d.push({i:c.push(r(c)+"rotate(",null,i)-2,x:ep(a,l)})):l&&c.push(r(c)+"rotate("+l+i),u=o.skewX,u!==(h=s.skewX)?d.push({i:c.push(r(c)+"skewX(",null,i)-2,x:ep(u,h)}):h&&c.push(r(c)+"skewX("+h+i),!function(e,t,n,i,o,s){if(e!==n||t!==i){var a=o.push(r(o)+"scale(",null,",",null,")");s.push({i:a-4,x:ep(e,n)},{i:a-2,x:ep(t,i)})}else(1!==n||1!==i)&&o.push(r(o)+"scale("+n+","+i+")")}(o.scaleX,o.scaleY,s.scaleX,s.scaleY,c,d),o=s=null,function(e){for(var t,n=-1,i=d.length;++n<i;)c[(t=d[n]).i]=t.x(e);return c.join("")}}}var eW=eG(function(e){let t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?eK:eq(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),eY=eG(function(e){return null==e?eK:(n||(n=document.createElementNS("http://www.w3.org/2000/svg","g")),n.setAttribute("transform",e),e=n.transform.baseVal.consolidate())?eq((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):eK},", ",")",")");function eX(e,t,n){var i=e._id;return e.each(function(){var e=eB(this,i);(e.value||(e.value={}))[t]=n.apply(this,arguments)}),function(e){return eV(e,i).value[t]}}var el=s("bYoiY");function eJ(e,t){var n;return("number"==typeof t?ep:t instanceof(0,el.default)?ed:(n=(0,el.default)(t))?(t=n,ed):function(e,t){var n,i,r,o,s,a=eg.lastIndex=em.lastIndex=0,l=-1,u=[],h=[];for(e+="",t+="";(r=eg.exec(e))&&(o=em.exec(t));)(s=o.index)>a&&(s=t.slice(a,s),u[l]?u[l]+=s:u[++l]=s),(r=r[0])===(o=o[0])?u[l]?u[l]+=o:u[++l]=o:(u[++l]=null,h.push({i:l,x:ep(r,o)})),a=em.lastIndex;return a<t.length&&(s=t.slice(a),u[l]?u[l]+=s:u[++l]=s),u.length<2?h[0]?(n=h[0].x,function(e){return n(e)+""}):(i=t,function(){return i}):(t=h.length,function(e){for(var n,i=0;i<t;++i)u[(n=h[i]).i]=n.x(e);return u.join("")})})(e,t)}var eQ=er.prototype.constructor;function eZ(e){return function(){this.style.removeProperty(e)}}var e0=0;function e1(e,t,n,i){this._groups=e,this._parents=t,this._name=n,this._id=i}var e2=er.prototype;e1.prototype=(function(e){return er().transition(e)}).prototype={constructor:e1,select:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=_(e));for(var i=this._groups,r=i.length,o=Array(r),s=0;s<r;++s)for(var a,l,u=i[s],h=u.length,c=o[s]=Array(h),d=0;d<h;++d)(a=u[d])&&(l=e.call(a,a.__data__,d,u))&&("__data__"in a&&(l.__data__=a.__data__),c[d]=l,eD(c[d],t,n,d,c,eV(a,n)));return new e1(o,this._parents,t,n)},selectAll:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=b(e));for(var i=this._groups,r=i.length,o=[],s=[],a=0;a<r;++a)for(var l,u=i[a],h=u.length,c=0;c<h;++c)if(l=u[c]){for(var d,f=e.call(l,l.__data__,c,u),p=eV(l,n),g=0,m=f.length;g<m;++g)(d=f[g])&&eD(d,t,n,g,f,p);o.push(f),s.push(l)}return new e1(o,s,t,n)},selectChild:e2.selectChild,selectChildren:e2.selectChildren,filter:function(e){"function"!=typeof e&&(e=w(e));for(var t=this._groups,n=t.length,i=Array(n),r=0;r<n;++r)for(var o,s=t[r],a=s.length,l=i[r]=[],u=0;u<a;++u)(o=s[u])&&e.call(o,o.__data__,u,s)&&l.push(o);return new e1(i,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw Error();for(var t=this._groups,n=e._groups,i=t.length,r=n.length,o=Math.min(i,r),s=Array(i),a=0;a<o;++a)for(var l,u=t[a],h=n[a],c=u.length,d=s[a]=Array(c),f=0;f<c;++f)(l=u[f]||h[f])&&(d[f]=l);for(;a<i;++a)s[a]=t[a];return new e1(s,this._parents,this._name,this._id)},selection:function(){return new eQ(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,n=++e0,i=this._groups,r=i.length,o=0;o<r;++o)for(var s,a=i[o],l=a.length,u=0;u<l;++u)if(s=a[u]){var h=eV(s,t);eD(s,e,n,u,a,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new e1(i,this._parents,e,n)},call:e2.call,nodes:e2.nodes,node:e2.node,size:e2.size,empty:e2.empty,each:e2.each,on:function(e,t){var n,i,r,o,s,a,l=this._id;return arguments.length<2?eV(this.node(),l).on.on(e):this.each((n=l,i=e,r=t,a=(i+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||"start"===e})?ej:eB,function(){var e=a(this,n),t=e.on;t!==o&&(s=(o=t).copy()).on(i,r),e.on=s}))},attr:function(e,t){var n=z(e),i="transform"===n?eY:eJ;return this.attrTween(e,"function"==typeof t?(n.local?function(e,t,n){var i,r,o;return function(){var s,a,l=n(this);return null==l?void this.removeAttributeNS(e.space,e.local):(s=this.getAttributeNS(e.space,e.local))===(a=l+"")?null:s===i&&a===r?o:(r=a,o=t(i=s,l))}}:function(e,t,n){var i,r,o;return function(){var s,a,l=n(this);return null==l?void this.removeAttribute(e):(s=this.getAttribute(e))===(a=l+"")?null:s===i&&a===r?o:(r=a,o=t(i=s,l))}})(n,i,eX(this,"attr."+e,t)):null==t?(n.local?function(e){return function(){this.removeAttributeNS(e.space,e.local)}}:function(e){return function(){this.removeAttribute(e)}})(n):(n.local?function(e,t,n){var i,r,o=n+"";return function(){var s=this.getAttributeNS(e.space,e.local);return s===o?null:s===i?r:r=t(i=s,n)}}:function(e,t,n){var i,r,o=n+"";return function(){var s=this.getAttribute(e);return s===o?null:s===i?r:r=t(i=s,n)}})(n,i,t))},attrTween:function(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!=typeof t)throw Error();var i=z(e);return this.tween(n,(i.local?function(e,t){var n,i;function r(){var r=t.apply(this,arguments);return r!==i&&(n=(i=r)&&function(t){this.setAttributeNS(e.space,e.local,r.call(this,t))}),n}return r._value=t,r}:function(e,t){var n,i;function r(){var r=t.apply(this,arguments);return r!==i&&(n=(i=r)&&function(t){this.setAttribute(e,r.call(this,t))}),n}return r._value=t,r})(i,t))},style:function(e,t,n){var i,r,o,s,a,l,u,h,c,d,f,p,g,m,y,v,_,x,b,w,k,S="transform"==(e+="")?eW:eJ;return null==t?this.styleTween(e,(i=e,function(){var e=F(this,i),t=(this.style.removeProperty(i),F(this,i));return e===t?null:e===r&&t===o?s:s=S(r=e,o=t)})).on("end.style."+e,eZ(e)):"function"==typeof t?this.styleTween(e,(a=e,l=eX(this,"style."+e,t),function(){var e=F(this,a),t=l(this),n=t+"";return null==t&&(this.style.removeProperty(a),n=t=F(this,a)),e===n?null:e===u&&n===h?c:(h=n,c=S(u=e,t))})).each((d=this._id,_="end."+(v="style."+(f=e)),function(){var e=eB(this,d),t=e.on,n=null==e.value[v]?y||(y=eZ(f)):void 0;(t!==p||m!==n)&&(g=(p=t).copy()).on(_,m=n),e.on=g})):this.styleTween(e,(x=e,k=t+"",function(){var e=F(this,x);return e===k?null:e===b?w:w=S(b=e,t)}),n).on("end.style."+e,null)},styleTween:function(e,t,n){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==t)return this.tween(i,null);if("function"!=typeof t)throw Error();return this.tween(i,function(e,t,n){var i,r;function o(){var o=t.apply(this,arguments);return o!==r&&(i=(r=o)&&function(t){this.style.setProperty(e,o.call(this,t),n)}),i}return o._value=t,o}(e,t,null==n?"":n))},text:function(e){var t,n;return this.tween("text","function"==typeof e?(t=eX(this,"text",e),function(){var e=t(this);this.textContent=null==e?"":e}):(n=null==e?"":e+"",function(){this.textContent=n}))},textTween:function(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!=typeof e)throw Error();return this.tween(t,function(e){var t,n;function i(){var i=e.apply(this,arguments);return i!==n&&(t=(n=i)&&function(e){this.textContent=i.call(this,e)}),t}return i._value=e,i}(e))},remove:function(){var e;return this.on("end.remove",(e=this._id,function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}))},tween:function(e,t){var n=this._id;if(e+="",arguments.length<2){for(var i,r=eV(this.node(),n).tween,o=0,s=r.length;o<s;++o)if((i=r[o]).name===e)return i.value;return null}return this.each((null==t?function(e,t){var n,i;return function(){var r=eB(this,e),o=r.tween;if(o!==n){i=n=o;for(var s=0,a=i.length;s<a;++s)if(i[s].name===t){(i=i.slice()).splice(s,1);break}}r.tween=i}}:function(e,t,n){var i,r;if("function"!=typeof n)throw Error();return function(){var o=eB(this,e),s=o.tween;if(s!==i){r=(i=s).slice();for(var a={name:t,value:n},l=0,u=r.length;l<u;++l)if(r[l].name===t){r[l]=a;break}l===u&&r.push(a)}o.tween=r}})(n,e,t))},delay:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?function(e,t){return function(){ej(this,e).delay=+t.apply(this,arguments)}}:function(e,t){return t*=1,function(){ej(this,e).delay=t}})(t,e)):eV(this.node(),t).delay},duration:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?function(e,t){return function(){eB(this,e).duration=+t.apply(this,arguments)}}:function(e,t){return t*=1,function(){eB(this,e).duration=t}})(t,e)):eV(this.node(),t).duration},ease:function(e){var t=this._id;return arguments.length?this.each(function(e,t){if("function"!=typeof t)throw Error();return function(){eB(this,e).ease=t}}(t,e)):eV(this.node(),t).ease},easeVarying:function(e){var t;if("function"!=typeof e)throw Error();return this.each((t=this._id,function(){var n=e.apply(this,arguments);if("function"!=typeof n)throw Error();eB(this,t).ease=n}))},end:function(){var e,t,n=this,i=n._id,r=n.size();return new Promise(function(o,s){var a={value:s},l={value:function(){0==--r&&o()}};n.each(function(){var n=eB(this,i),r=n.on;r!==e&&((t=(e=r).copy())._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),n.on=t}),0===r&&o()})},[Symbol.iterator]:e2[Symbol.iterator]};var e5={time:null,delay:0,duration:250,ease:function(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};er.prototype.interrupt=function(e){return this.each(function(){eH(this,e)})},er.prototype.transition=function(e){var t,n;e instanceof e1?(t=e._id,e=e._name):(t=++e0,(n=e5).time=eL(),e=null==e?null:e+"");for(var i=this._groups,r=i.length,o=0;o<r;++o)for(var s,a=i[o],l=a.length,u=0;u<l;++u)(s=a[u])&&eD(s,e,t,u,a,n||function(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw Error(`transition ${t} not found`);return n}(s,t));return new e1(i,this._parents,e,t)};const{abs:e3,max:e4,min:e8}=Math;function e9(e){return{type:e}}function e6(e){var t=0,n=e.children,i=n&&n.length;if(i)for(;--i>=0;)t+=n[i].value;else t=1;e.value=t}function e7(e,t){e instanceof Map?(e=[void 0,e],void 0===t&&(t=tt)):void 0===t&&(t=te);for(var n,i,r,o,s,a=new tr(e),l=[a];n=l.pop();)if((r=t(n.data))&&(s=(r=Array.from(r)).length))for(n.children=r,o=s-1;o>=0;--o)l.push(i=r[o]=new tr(r[o])),i.parent=n,i.depth=n.depth+1;return a.eachBefore(ti)}function te(e){return e.children}function tt(e){return Array.isArray(e)?e[1]:null}function tn(e){void 0!==e.data.value&&(e.value=e.data.value),e.data=e.data.data}function ti(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function tr(e){this.data=e,this.depth=this.height=0,this.parent=null}function to(e,t){return e.parent===t.parent?1:2}function ts(e){var t=e.children;return t?t[0]:e.t}function ta(e){var t=e.children;return t?t[t.length-1]:e.t}function tl(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}function tu(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function th(e){this._context=e}function tc(e){return new th(e)}function td(e,t){this._context=e,this._t=t}function tf(e){return new td(e,.5)}["w","e"].map(e9),["n","s"].map(e9),["n","w","e","s","nw","ne","sw","se"].map(e9),tr.prototype=e7.prototype={constructor:tr,count:function(){return this.eachAfter(e6)},each:function(e,t){let n=-1;for(let i of this)e.call(t,i,++n,this);return this},eachAfter:function(e,t){for(var n,i,r,o=this,s=[o],a=[],l=-1;o=s.pop();)if(a.push(o),n=o.children)for(i=0,r=n.length;i<r;++i)s.push(n[i]);for(;o=a.pop();)e.call(t,o,++l,this);return this},eachBefore:function(e,t){for(var n,i,r=this,o=[r],s=-1;r=o.pop();)if(e.call(t,r,++s,this),n=r.children)for(i=n.length-1;i>=0;--i)o.push(n[i]);return this},find:function(e,t){let n=-1;for(let i of this)if(e.call(t,i,++n,this))return i},sum:function(e){return this.eachAfter(function(t){for(var n=+e(t.data)||0,i=t.children,r=i&&i.length;--r>=0;)n+=i[r].value;t.value=n})},sort:function(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})},path:function(e){for(var t=this,n=function(e,t){if(e===t)return e;var n=e.ancestors(),i=t.ancestors(),r=null;for(e=n.pop(),t=i.pop();e===t;)r=e,e=n.pop(),t=i.pop();return r}(t,e),i=[t];t!==n;)i.push(t=t.parent);for(var r=i.length;e!==n;)i.splice(r,0,e),e=e.parent;return i},ancestors:function(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t},descendants:function(){return Array.from(this)},leaves:function(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e},links:function(){var e=this,t=[];return e.each(function(n){n!==e&&t.push({source:n.parent,target:n})}),t},copy:function(){return e7(this).eachBefore(tn)},[Symbol.iterator]:function*(){var e,t,n,i,r=this,o=[r];do for(e=o.reverse(),o=[];r=e.pop();)if(yield r,t=r.children)for(n=0,i=t.length;n<i;++n)o.push(t[n]);while(o.length)}},tl.prototype=Object.create(tr.prototype),th.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:tu(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e*=1,t*=1,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:tu(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},td.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e*=1,t*=1,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}}this._x=e,this._y=t}};var tp=Array.prototype.slice;function tg(e){return function(){return e}}function tm(e){this._context=e}function ty(e){return new tm(e)}tm.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e*=1,t*=1,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}};const tv=Math.PI,t_=2*tv,tx=t_-1e-6;function tb(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}class tw{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==e?tb:function(e){let t=Math.floor(e);if(!(t>=0))throw Error(`invalid digits: ${e}`);if(t>15)return tb;let n=10**t;return function(e){this._+=e[0];for(let t=1,i=e.length;t<i;++t)this._+=Math.round(arguments[t]*n)/n+e[t]}}(e)}moveTo(e,t){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,t){this._append`L${this._x1=+e},${this._y1=+t}`}quadraticCurveTo(e,t,n,i){this._append`Q${+e},${+t},${this._x1=+n},${this._y1=+i}`}bezierCurveTo(e,t,n,i,r,o){this._append`C${+e},${+t},${+n},${+i},${this._x1=+r},${this._y1=+o}`}arcTo(e,t,n,i,r){if(e*=1,t*=1,n*=1,i*=1,(r*=1)<0)throw Error(`negative radius: ${r}`);let o=this._x1,s=this._y1,a=n-e,l=i-t,u=o-e,h=s-t,c=u*u+h*h;if(null===this._x1)this._append`M${this._x1=e},${this._y1=t}`;else if(c>1e-6)if(Math.abs(h*a-l*u)>1e-6&&r){let d=n-o,f=i-s,p=a*a+l*l,g=Math.sqrt(p),m=Math.sqrt(c),y=r*Math.tan((tv-Math.acos((p+c-(d*d+f*f))/(2*g*m)))/2),v=y/m,_=y/g;Math.abs(v-1)>1e-6&&this._append`L${e+v*u},${t+v*h}`,this._append`A${r},${r},0,0,${+(h*d>u*f)},${this._x1=e+_*a},${this._y1=t+_*l}`}else this._append`L${this._x1=e},${this._y1=t}`}arc(e,t,n,i,r,o){if(e*=1,t*=1,n*=1,o=!!o,n<0)throw Error(`negative radius: ${n}`);let s=n*Math.cos(i),a=n*Math.sin(i),l=e+s,u=t+a,h=1^o,c=o?i-r:r-i;null===this._x1?this._append`M${l},${u}`:(Math.abs(this._x1-l)>1e-6||Math.abs(this._y1-u)>1e-6)&&this._append`L${l},${u}`,n&&(c<0&&(c=c%t_+t_),c>tx?this._append`A${n},${n},0,1,${h},${e-s},${t-a}A${n},${n},0,1,${h},${this._x1=l},${this._y1=u}`:c>1e-6&&this._append`A${n},${n},0,${+(c>=tv)},${h},${this._x1=e+n*Math.cos(r)},${this._y1=t+n*Math.sin(r)}`)}rect(e,t,n,i){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${n*=1}v${+i}h${-n}Z`}toString(){return this._}}function tk(e){let t=3;return e.digits=function(n){if(!arguments.length)return t;if(null==n)t=null;else{let e=Math.floor(n);if(!(e>=0))throw RangeError(`invalid digits: ${n}`);t=e}return e},()=>new tw(t)}function tS(e){return e[0]}function tE(e){return e[1]}function t$(e,t){var n=tg(!0),i=null,r=ty,o=null,s=tk(a);function a(a){var l,u,h,c,d=(a="object"==typeof(l=a)&&"length"in l?l:Array.from(l)).length,f=!1;for(null==i&&(o=r(c=s())),u=0;u<=d;++u)!(u<d&&n(h=a[u],u,a))===f&&((f=!f)?o.lineStart():o.lineEnd()),f&&o.point(+e(h,u,a),+t(h,u,a));if(c)return o=null,c+""||null}return e="function"==typeof e?e:void 0===e?tS:tg(e),t="function"==typeof t?t:void 0===t?tE:tg(t),a.x=function(t){return arguments.length?(e="function"==typeof t?t:tg(+t),a):e},a.y=function(e){return arguments.length?(t="function"==typeof e?e:tg(+e),a):t},a.defined=function(e){return arguments.length?(n="function"==typeof e?e:tg(!!e),a):n},a.curve=function(e){return arguments.length?(r=e,null!=i&&(o=r(i)),a):r},a.context=function(e){return arguments.length?(null==e?i=o=null:o=r(i=e),a):i},a}tw.prototype;class tC{constructor(e,t){this._context=e,this._x=t}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line}point(e,t){switch(e*=1,t*=1,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._x?this._context.bezierCurveTo(this._x0=(this._x0+e)/2,this._y0,this._x0,t,e,t):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+t)/2,e,this._y0,e,t)}this._x0=e,this._y0=t}}function tO(e){return new tC(e,!0)}function tL(e){return new tC(e,!1)}function tR(e){return e.source}function tA(e){return e.target}function tM(e){let t=tR,n=tA,i=tS,r=tE,o=null,s=null,a=tk(l);function l(){let l,u=tp.call(arguments),h=t.apply(this,u),c=n.apply(this,u);if(null==o&&(s=e(l=a())),s.lineStart(),u[0]=h,s.point(+i.apply(this,u),+r.apply(this,u)),u[0]=c,s.point(+i.apply(this,u),+r.apply(this,u)),s.lineEnd(),l)return s=null,l+""||null}return l.source=function(e){return arguments.length?(t=e,l):t},l.target=function(e){return arguments.length?(n=e,l):n},l.x=function(e){return arguments.length?(i="function"==typeof e?e:tg(+e),l):i},l.y=function(e){return arguments.length?(r="function"==typeof e?e:tg(+e),l):r},l.context=function(t){return arguments.length?(null==t?o=s=null:s=e(o=t),l):o},l}function tI(e){return((e=Math.exp(e))+1/e)/2}var tN=function e(t,n,i){function r(e,r){var o,s,a=e[0],l=e[1],u=e[2],h=r[0],c=r[1],d=r[2],f=h-a,p=c-l,g=f*f+p*p;if(g<1e-12)s=Math.log(d/u)/t,o=function(e){return[a+e*f,l+e*p,u*Math.exp(t*e*s)]};else{var m=Math.sqrt(g),y=(d*d-u*u+i*g)/(2*u*n*m),v=(d*d-u*u-i*g)/(2*d*n*m),_=Math.log(Math.sqrt(y*y+1)-y);s=(Math.log(Math.sqrt(v*v+1)-v)-_)/t,o=function(e){var i,r,o=e*s,h=tI(_),c=u/(n*m)*(h*(((i=Math.exp(2*(i=t*o+_)))-1)/(i+1))-((r=Math.exp(r=_))-1/r)/2);return[a+c*f,l+c*p,u*h/tI(t*o+_)]}}return o.duration=1e3*s*t/Math.SQRT2,o}return r.rho=function(t){var n=Math.max(.001,+t),i=n*n;return e(n,i,i*i)},r}(Math.SQRT2,2,4),tT=e=>()=>e;function tz(e,{sourceEvent:t,target:n,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function tP(e,t,n){this.k=e,this.x=t,this.y=n}tP.prototype={constructor:tP,scale:function(e){return 1===e?this:new tP(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new tP(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var tF=new tP(1,0,0);function tD(e){e.stopImmediatePropagation()}function tj(e){e.preventDefault(),e.stopImmediatePropagation()}function tB(e){return(!e.ctrlKey||"wheel"===e.type)&&!e.button}function tV(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e).hasAttribute("viewBox")?[[(e=e.viewBox.baseVal).x,e.y],[e.x+e.width,e.y+e.height]]:[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]:[[0,0],[e.clientWidth,e.clientHeight]]}function tH(){return this.__zoom||tF}function tU(e){return-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function tK(){return navigator.maxTouchPoints||"ontouchstart"in this}function tq(e,t,n){var i=e.invertX(t[0][0])-n[0][0],r=e.invertX(t[1][0])-n[1][0],o=e.invertY(t[0][1])-n[0][1],s=e.invertY(t[1][1])-n[1][1];return e.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),s>o?(o+s)/2:Math.min(0,o)||Math.max(0,s))}function tG(){var e,t,n,i=tB,r=tV,o=tq,s=tU,a=tK,l=[0,1/0],u=[[-1/0,-1/0],[1/0,1/0]],h=250,c=tN,d=g("start","zoom","end"),f=0,p=10;function m(e){e.property("__zoom",tH).on("wheel.zoom",k,{passive:!1}).on("mousedown.zoom",S).on("dblclick.zoom",E).filter(a).on("touchstart.zoom",$).on("touchmove.zoom",C).on("touchend.zoom touchcancel.zoom",O).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function y(e,t){return(t=Math.max(l[0],Math.min(l[1],t)))===e.k?e:new tP(t,e.x,e.y)}function v(e,t,n){var i=t[0]-n[0]*e.k,r=t[1]-n[1]*e.k;return i===e.x&&r===e.y?e:new tP(e.k,i,r)}function _(e){return[(+e[0][0]+ +e[1][0])/2,(+e[0][1]+ +e[1][1])/2]}function x(e,t,n,i){e.on("start.zoom",function(){b(this,arguments).event(i).start()}).on("interrupt.zoom end.zoom",function(){b(this,arguments).event(i).end()}).tween("zoom",function(){var e=arguments,o=b(this,e).event(i),s=r.apply(this,e),a=null==n?_(s):"function"==typeof n?n.apply(this,e):n,l=Math.max(s[1][0]-s[0][0],s[1][1]-s[0][1]),u=this.__zoom,h="function"==typeof t?t.apply(this,e):t,d=c(u.invert(a).concat(l/u.k),h.invert(a).concat(l/h.k));return function(e){if(1===e)e=h;else{var t=d(e),n=l/t[2];e=new tP(n,a[0]-t[0]*n,a[1]-t[1]*n)}o.zoom(null,e)}})}function b(e,t,n){return!n&&e.__zooming||new w(e,t)}function w(e,t){this.that=e,this.args=t,this.active=0,this.sourceEvent=null,this.extent=r.apply(e,t),this.taps=0}function k(e,...t){if(i.apply(this,arguments)){var n=b(this,t).event(e),r=this.__zoom,a=Math.max(l[0],Math.min(l[1],r.k*Math.pow(2,s.apply(this,arguments)))),h=ey(e);if(n.wheel)(n.mouse[0][0]!==h[0]||n.mouse[0][1]!==h[1])&&(n.mouse[1]=r.invert(n.mouse[0]=h)),clearTimeout(n.wheel);else{if(r.k===a)return;n.mouse=[h,r.invert(h)],eH(this),n.start()}tj(e),n.wheel=setTimeout(function(){n.wheel=null,n.end()},150),n.zoom("mouse",o(v(y(r,a),n.mouse[0],n.mouse[1]),n.extent,u))}}function S(e,...t){if(!n&&i.apply(this,arguments)){var r,s,a,l=e.currentTarget,h=b(this,t,!0).event(e),c=eo(e.view).on("mousemove.zoom",function(e){if(tj(e),!h.moved){var t=e.clientX-p,n=e.clientY-g;h.moved=t*t+n*n>f}h.event(e).zoom("mouse",o(v(h.that.__zoom,h.mouse[0]=ey(e,l),h.mouse[1]),h.extent,u))},!0).on("mouseup.zoom",function(e){var t,n,i,r;c.on("mousemove.zoom mouseup.zoom",null),t=e.view,n=h.moved,i=t.document.documentElement,r=eo(t).on("dragstart.drag",null),n&&(r.on("click.drag",ea,es),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in i?r.on("selectstart.drag",null):(i.style.MozUserSelect=i.__noselect,delete i.__noselect),tj(e),h.event(e).end()},!0),d=ey(e,l),p=e.clientX,g=e.clientY;s=(r=e.view).document.documentElement,a=eo(r).on("dragstart.drag",ea,es),"onselectstart"in s?a.on("selectstart.drag",ea,es):(s.__noselect=s.style.MozUserSelect,s.style.MozUserSelect="none"),tD(e),h.mouse=[d,this.__zoom.invert(d)],eH(this),h.start()}}function E(e,...t){if(i.apply(this,arguments)){var n=this.__zoom,s=ey(e.changedTouches?e.changedTouches[0]:e,this),a=n.invert(s),l=n.k*(e.shiftKey?.5:2),c=o(v(y(n,l),s,a),r.apply(this,t),u);tj(e),h>0?eo(this).transition().duration(h).call(x,c,s,e):eo(this).call(m.transform,c,s,e)}}function $(n,...r){if(i.apply(this,arguments)){var o,s,a,l,u=n.touches,h=u.length,c=b(this,r,n.changedTouches.length===h).event(n);for(tD(n),s=0;s<h;++s)l=[l=ey(a=u[s],this),this.__zoom.invert(l),a.identifier],c.touch0?c.touch1||c.touch0[2]===l[2]||(c.touch1=l,c.taps=0):(c.touch0=l,o=!0,c.taps=1+!!e);e&&(e=clearTimeout(e)),o&&(c.taps<2&&(t=l[0],e=setTimeout(function(){e=null},500)),eH(this),c.start())}}function C(e,...t){if(this.__zooming){var n,i,r,s,a=b(this,t).event(e),l=e.changedTouches,h=l.length;for(tj(e),n=0;n<h;++n)r=ey(i=l[n],this),a.touch0&&a.touch0[2]===i.identifier?a.touch0[0]=r:a.touch1&&a.touch1[2]===i.identifier&&(a.touch1[0]=r);if(i=a.that.__zoom,a.touch1){var c=a.touch0[0],d=a.touch0[1],f=a.touch1[0],p=a.touch1[1],g=(g=f[0]-c[0])*g+(g=f[1]-c[1])*g,m=(m=p[0]-d[0])*m+(m=p[1]-d[1])*m;i=y(i,Math.sqrt(g/m)),r=[(c[0]+f[0])/2,(c[1]+f[1])/2],s=[(d[0]+p[0])/2,(d[1]+p[1])/2]}else{if(!a.touch0)return;r=a.touch0[0],s=a.touch0[1]}a.zoom("touch",o(v(i,r,s),a.extent,u))}}function O(e,...i){if(this.__zooming){var r,o,s=b(this,i).event(e),a=e.changedTouches,l=a.length;for(tD(e),n&&clearTimeout(n),n=setTimeout(function(){n=null},500),r=0;r<l;++r)o=a[r],s.touch0&&s.touch0[2]===o.identifier?delete s.touch0:s.touch1&&s.touch1[2]===o.identifier&&delete s.touch1;if(s.touch1&&!s.touch0&&(s.touch0=s.touch1,delete s.touch1),s.touch0)s.touch0[1]=this.__zoom.invert(s.touch0[0]);else if(s.end(),2===s.taps&&(o=ey(o,this),Math.hypot(t[0]-o[0],t[1]-o[1])<p)){var u=eo(this).on("dblclick.zoom");u&&u.apply(this,arguments)}}}return m.transform=function(e,t,n,i){var r=e.selection?e.selection():e;r.property("__zoom",tH),e!==r?x(e,t,n,i):r.interrupt().each(function(){b(this,arguments).event(i).start().zoom(null,"function"==typeof t?t.apply(this,arguments):t).end()})},m.scaleBy=function(e,t,n,i){m.scaleTo(e,function(){var e=this.__zoom.k,n="function"==typeof t?t.apply(this,arguments):t;return e*n},n,i)},m.scaleTo=function(e,t,n,i){m.transform(e,function(){var e=r.apply(this,arguments),i=this.__zoom,s=null==n?_(e):"function"==typeof n?n.apply(this,arguments):n,a=i.invert(s),l="function"==typeof t?t.apply(this,arguments):t;return o(v(y(i,l),s,a),e,u)},n,i)},m.translateBy=function(e,t,n,i){m.transform(e,function(){return o(this.__zoom.translate("function"==typeof t?t.apply(this,arguments):t,"function"==typeof n?n.apply(this,arguments):n),r.apply(this,arguments),u)},null,i)},m.translateTo=function(e,t,n,i,s){m.transform(e,function(){var e=r.apply(this,arguments),s=this.__zoom,a=null==i?_(e):"function"==typeof i?i.apply(this,arguments):i;return o(tF.translate(a[0],a[1]).scale(s.k).translate("function"==typeof t?-t.apply(this,arguments):-t,"function"==typeof n?-n.apply(this,arguments):-n),e,u)},i,s)},w.prototype={event:function(e){return e&&(this.sourceEvent=e),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(e,t){return this.mouse&&"mouse"!==e&&(this.mouse[1]=t.invert(this.mouse[0])),this.touch0&&"touch"!==e&&(this.touch0[1]=t.invert(this.touch0[0])),this.touch1&&"touch"!==e&&(this.touch1[1]=t.invert(this.touch1[0])),this.that.__zoom=t,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(e){var t=eo(this.that).datum();d.call(e,this.that,new tz(e,{sourceEvent:this.sourceEvent,target:m,type:e,transform:this.that.__zoom,dispatch:d}),t)}},m.wheelDelta=function(e){return arguments.length?(s="function"==typeof e?e:tT(+e),m):s},m.filter=function(e){return arguments.length?(i="function"==typeof e?e:tT(!!e),m):i},m.touchable=function(e){return arguments.length?(a="function"==typeof e?e:tT(!!e),m):a},m.extent=function(e){return arguments.length?(r="function"==typeof e?e:tT([[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]]),m):r},m.scaleExtent=function(e){return arguments.length?(l[0]=+e[0],l[1]=+e[1],m):[l[0],l[1]]},m.translateExtent=function(e){return arguments.length?(u[0][0]=+e[0][0],u[1][0]=+e[1][0],u[0][1]=+e[0][1],u[1][1]=+e[1][1],m):[[u[0][0],u[0][1]],[u[1][0],u[1][1]]]},m.constrain=function(e){return arguments.length?(o=e,m):o},m.duration=function(e){return arguments.length?(h=+e,m):h},m.interpolate=function(e){return arguments.length?(c=e,m):c},m.on=function(){var e=d.on.apply(d,arguments);return e===d?m:e},m.clickDistance=function(e){return arguments.length?(f=(e*=1)*e,m):Math.sqrt(f)},m.tapDistance=function(e){return arguments.length?(p=+e,m):p},m}tP.prototype;const tW=e=>"string"==typeof e,tY=()=>{let e,t,n=new Promise((n,i)=>{e=n,t=i});return n.resolve=e,n.reject=t,n},tX=e=>null==e?"":""+e,tJ=(e,t,n)=>{e.forEach(e=>{t[e]&&(n[e]=t[e])})},tQ=/###/g,tZ=e=>e&&e.indexOf("###")>-1?e.replace(tQ,"."):e,t0=e=>!e||tW(e),t1=(e,t,n)=>{let i=tW(t)?t.split("."):t,r=0;for(;r<i.length-1;){if(t0(e))return{};let t=tZ(i[r]);!e[t]&&n&&(e[t]=new n),e=Object.prototype.hasOwnProperty.call(e,t)?e[t]:{},++r}return t0(e)?{}:{obj:e,k:tZ(i[r])}},t2=(e,t,n)=>{let{obj:i,k:r}=t1(e,t,Object);if(void 0!==i||1===t.length){i[r]=n;return}let o=t[t.length-1],s=t.slice(0,t.length-1),a=t1(e,s,Object);for(;void 0===a.obj&&s.length;)o=`${s[s.length-1]}.${o}`,a=t1(e,s=s.slice(0,s.length-1),Object),a?.obj&&void 0!==a.obj[`${a.k}.${o}`]&&(a.obj=void 0);a.obj[`${a.k}.${o}`]=n},t5=(e,t,n,i)=>{let{obj:r,k:o}=t1(e,t,Object);r[o]=r[o]||[],r[o].push(n)},t3=(e,t)=>{let{obj:n,k:i}=t1(e,t);if(n&&Object.prototype.hasOwnProperty.call(n,i))return n[i]},t4=(e,t,n)=>{let i=t3(e,n);return void 0!==i?i:t3(t,n)},t8=(e,t,n)=>{for(let i in t)"__proto__"!==i&&"constructor"!==i&&(i in e?tW(e[i])||e[i]instanceof String||tW(t[i])||t[i]instanceof String?n&&(e[i]=t[i]):t8(e[i],t[i],n):e[i]=t[i]);return e},t9=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var t6={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const t7=e=>tW(e)?e.replace(/[&<>"'\/]/g,e=>t6[e]):e,ne=[" ",",","?","!",";"],nt=new class{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){let t=this.regExpMap.get(e);if(void 0!==t)return t;let n=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,n),this.regExpQueue.push(e),n}}(20),nn=(e,t,n)=>{t=t||"",n=n||"";let i=ne.filter(e=>0>t.indexOf(e)&&0>n.indexOf(e));if(0===i.length)return!0;let r=nt.getRegExp(`(${i.map(e=>"?"===e?"\\?":e).join("|")})`),o=!r.test(e);if(!o){let t=e.indexOf(n);t>0&&!r.test(e.substring(0,t))&&(o=!0)}return o},ni=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";if(!e)return;if(e[t]){if(!Object.prototype.hasOwnProperty.call(e,t))return;return e[t]}let i=t.split(n),r=e;for(let e=0;e<i.length;){let t;if(!r||"object"!=typeof r)return;let o="";for(let s=e;s<i.length;++s)if(s!==e&&(o+=n),o+=i[s],void 0!==(t=r[o])){if(["string","number","boolean"].indexOf(typeof t)>-1&&s<i.length-1)continue;e+=s-e+1;break}r=t}return r},nr=e=>e?.replace("_","-"),no={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){console?.[e]?.apply?.(console,t)}};class ns{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.init(e,t)}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||no,this.options=t,this.debug=t.debug}log(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"log","",!0)}warn(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","",!0)}error(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"error","")}deprecate(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,n,i){return i&&!this.debug?null:(tW(e[0])&&(e[0]=`${n}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new ns(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return(e=e||this.options).prefix=e.prefix||this.prefix,new ns(this.logger,e)}}var na=new ns;class nl{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(e=>{this.observers[e]||(this.observers[e]=new Map);let n=this.observers[e].get(t)||0;this.observers[e].set(t,n+1)}),this}off(e,t){if(this.observers[e]){if(!t){delete this.observers[e];return}this.observers[e].delete(t)}}emit(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(e=>{let[t,i]=e;for(let e=0;e<i;e++)t(...n)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(t=>{let[i,r]=t;for(let t=0;t<r;t++)i.apply(i,[e,...n])})}}class nu extends nl{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),void 0===this.options.ignoreJSONStructure&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){0>this.options.ns.indexOf(e)&&this.options.ns.push(e)}removeNamespaces(e){let t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,n){let i,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=void 0!==r.keySeparator?r.keySeparator:this.options.keySeparator,s=void 0!==r.ignoreJSONStructure?r.ignoreJSONStructure:this.options.ignoreJSONStructure;e.indexOf(".")>-1?i=e.split("."):(i=[e,t],n&&(Array.isArray(n)?i.push(...n):tW(n)&&o?i.push(...n.split(o)):i.push(n)));let a=t3(this.data,i);return(!a&&!t&&!n&&e.indexOf(".")>-1&&(e=i[0],t=i[1],n=i.slice(2).join(".")),!a&&s&&tW(n))?ni(this.data?.[e]?.[t],n,o):a}addResource(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1},o=void 0!==r.keySeparator?r.keySeparator:this.options.keySeparator,s=[e,t];n&&(s=s.concat(o?n.split(o):n)),e.indexOf(".")>-1&&(s=e.split("."),i=t,t=s[1]),this.addNamespaces(t),t2(this.data,s,i),r.silent||this.emit("added",e,t,n,i)}addResources(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(let i in n)(tW(n[i])||Array.isArray(n[i]))&&this.addResource(e,t,i,n[i],{silent:!0});i.silent||this.emit("added",e,t,n)}addResourceBundle(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1,skipCopy:!1},s=[e,t];e.indexOf(".")>-1&&(s=e.split("."),i=n,n=t,t=s[1]),this.addNamespaces(t);let a=t3(this.data,s)||{};o.skipCopy||(n=JSON.parse(JSON.stringify(n))),i?t8(a,n,r):a={...a,...n},t2(this.data,s,a),o.silent||this.emit("added",e,t,n)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return void 0!==this.getResource(e,t)}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){let t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(e=>t[e]&&Object.keys(t[e]).length>0)}toJSON(){return this.data}}var nh={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,n,i,r){return e.forEach(e=>{t=this.processors[e]?.process(t,n,i,r)??t}),t}};const nc={},nd=e=>!tW(e)&&"boolean"!=typeof e&&"number"!=typeof e;class nf extends nl{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),tJ(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),this.logger=na.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};if(null==e)return!1;let n=this.resolve(e,t);return n?.res!==void 0}extractFromKey(e,t){let n=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===n&&(n=":");let i=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,r=t.ns||this.options.defaultNS||[],o=n&&e.indexOf(n)>-1,s=!this.options.userDefinedKeySeparator&&!t.keySeparator&&!this.options.userDefinedNsSeparator&&!t.nsSeparator&&!nn(e,n,i);if(o&&!s){let t=e.match(this.interpolator.nestingRegexp);if(t&&t.length>0)return{key:e,namespaces:tW(r)?[r]:r};let o=e.split(n);(n!==i||n===i&&this.options.ns.indexOf(o[0])>-1)&&(r=o.shift()),e=o.join(i)}return{key:e,namespaces:tW(r)?[r]:r}}translate(e,t,n){if("object"!=typeof t&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),"object"==typeof t&&(t={...t}),t||(t={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);let i=void 0!==t.returnDetails?t.returnDetails:this.options.returnDetails,r=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,{key:o,namespaces:s}=this.extractFromKey(e[e.length-1],t),a=s[s.length-1],l=t.lng||this.language,u=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(l?.toLowerCase()==="cimode"){if(u){let e=t.nsSeparator||this.options.nsSeparator;return i?{res:`${a}${e}${o}`,usedKey:o,exactUsedKey:o,usedLng:l,usedNS:a,usedParams:this.getUsedParamsDetails(t)}:`${a}${e}${o}`}return i?{res:o,usedKey:o,exactUsedKey:o,usedLng:l,usedNS:a,usedParams:this.getUsedParamsDetails(t)}:o}let h=this.resolve(e,t),c=h?.res,d=h?.usedKey||o,f=h?.exactUsedKey||o,p=void 0!==t.joinArrays?t.joinArrays:this.options.joinArrays,g=!this.i18nFormat||this.i18nFormat.handleAsObject,m=void 0!==t.count&&!tW(t.count),y=nf.hasDefaultValue(t),v=m?this.pluralResolver.getSuffix(l,t.count,t):"",_=t.ordinal&&m?this.pluralResolver.getSuffix(l,t.count,{ordinal:!1}):"",x=m&&!t.ordinal&&0===t.count,b=x&&t[`defaultValue${this.options.pluralSeparator}zero`]||t[`defaultValue${v}`]||t[`defaultValue${_}`]||t.defaultValue,w=c;g&&!c&&y&&(w=b);let k=nd(w),S=Object.prototype.toString.apply(w);if(g&&w&&k&&0>["[object Number]","[object Function]","[object RegExp]"].indexOf(S)&&!(tW(p)&&Array.isArray(w))){if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");let e=this.options.returnedObjectHandler?this.options.returnedObjectHandler(d,w,{...t,ns:s}):`key '${o} (${this.language})' returned an object instead of string.`;return i?(h.res=e,h.usedParams=this.getUsedParamsDetails(t),h):e}if(r){let e=Array.isArray(w),n=e?[]:{},i=e?f:d;for(let e in w)if(Object.prototype.hasOwnProperty.call(w,e)){let o=`${i}${r}${e}`;y&&!c?n[e]=this.translate(o,{...t,defaultValue:nd(b)?b[e]:void 0,joinArrays:!1,ns:s}):n[e]=this.translate(o,{...t,joinArrays:!1,ns:s}),n[e]===o&&(n[e]=w[e])}c=n}}else if(g&&tW(p)&&Array.isArray(c))(c=c.join(p))&&(c=this.extendTranslation(c,e,t,n));else{let i=!1,s=!1;!this.isValidLookup(c)&&y&&(i=!0,c=b),this.isValidLookup(c)||(s=!0,c=o);let u=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&s?void 0:c,d=y&&b!==c&&this.options.updateMissing;if(s||i||d){if(this.logger.log(d?"updateKey":"missingKey",l,a,o,d?b:c),r){let e=this.resolve(o,{...t,keySeparator:!1});e&&e.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let e=[],n=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if("fallback"===this.options.saveMissingTo&&n&&n[0])for(let t=0;t<n.length;t++)e.push(n[t]);else"all"===this.options.saveMissingTo?e=this.languageUtils.toResolveHierarchy(t.lng||this.language):e.push(t.lng||this.language);let i=(e,n,i)=>{let r=y&&i!==c?i:u;this.options.missingKeyHandler?this.options.missingKeyHandler(e,a,n,r,d,t):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(e,a,n,r,d,t),this.emit("missingKey",e,a,n,c)};this.options.saveMissing&&(this.options.saveMissingPlurals&&m?e.forEach(e=>{let n=this.pluralResolver.getSuffixes(e,t);x&&t[`defaultValue${this.options.pluralSeparator}zero`]&&0>n.indexOf(`${this.options.pluralSeparator}zero`)&&n.push(`${this.options.pluralSeparator}zero`),n.forEach(n=>{i([e],o+n,t[`defaultValue${n}`]||b)})}):i(e,o,b))}c=this.extendTranslation(c,e,t,h,n),s&&c===o&&this.options.appendNamespaceToMissingKey&&(c=`${a}:${o}`),(s||i)&&this.options.parseMissingKeyHandler&&(c=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${a}:${o}`:o,i?c:void 0))}return i?(h.res=c,h.usedParams=this.getUsedParamsDetails(t),h):c}extendTranslation(e,t,n,i,r){var o=this;if(this.i18nFormat?.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...n},n.lng||this.language||i.usedLng,i.usedNS,i.usedKey,{resolved:i});else if(!n.skipInterpolation){let s;n.interpolation&&this.interpolator.init({...n,interpolation:{...this.options.interpolation,...n.interpolation}});let a=tW(e)&&(n?.interpolation?.skipOnVariables!==void 0?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);if(a){let t=e.match(this.interpolator.nestingRegexp);s=t&&t.length}let l=n.replace&&!tW(n.replace)?n.replace:n;if(this.options.interpolation.defaultVariables&&(l={...this.options.interpolation.defaultVariables,...l}),e=this.interpolator.interpolate(e,l,n.lng||this.language||i.usedLng,n),a){let t=e.match(this.interpolator.nestingRegexp);s<(t&&t.length)&&(n.nest=!1)}!n.lng&&i&&i.res&&(n.lng=this.language||i.usedLng),!1!==n.nest&&(e=this.interpolator.nest(e,function(){for(var e=arguments.length,i=Array(e),s=0;s<e;s++)i[s]=arguments[s];return r?.[0]!==i[0]||n.context?o.translate(...i,t):(o.logger.warn(`It seems you are nesting recursively key: ${i[0]} in key: ${t[0]}`),null)},n)),n.interpolation&&this.interpolator.reset()}let s=n.postProcess||this.options.postProcess,a=tW(s)?[s]:s;return null!=e&&a?.length&&!1!==n.applyPostProcessor&&(e=nh.handle(a,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...i,usedParams:this.getUsedParamsDetails(n)},...n}:n,this)),e}resolve(e){let t,n,i,r,o,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return tW(e)&&(e=[e]),e.forEach(e=>{if(this.isValidLookup(t))return;let a=this.extractFromKey(e,s),l=a.key;n=l;let u=a.namespaces;this.options.fallbackNS&&(u=u.concat(this.options.fallbackNS));let h=void 0!==s.count&&!tW(s.count),c=h&&!s.ordinal&&0===s.count,d=void 0!==s.context&&(tW(s.context)||"number"==typeof s.context)&&""!==s.context,f=s.lngs?s.lngs:this.languageUtils.toResolveHierarchy(s.lng||this.language,s.fallbackLng);u.forEach(e=>{this.isValidLookup(t)||(o=e,!nc[`${f[0]}-${e}`]&&this.utils?.hasLoadedNamespace&&!this.utils?.hasLoadedNamespace(o)&&(nc[`${f[0]}-${e}`]=!0,this.logger.warn(`key "${n}" for languages "${f.join(", ")}" won't get resolved as namespace "${o}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),f.forEach(n=>{let o;if(this.isValidLookup(t))return;r=n;let a=[l];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(a,l,n,e,s);else{let e;h&&(e=this.pluralResolver.getSuffix(n,s.count,s));let t=`${this.options.pluralSeparator}zero`,i=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(h&&(a.push(l+e),s.ordinal&&0===e.indexOf(i)&&a.push(l+e.replace(i,this.options.pluralSeparator)),c&&a.push(l+t)),d){let n=`${l}${this.options.contextSeparator}${s.context}`;a.push(n),h&&(a.push(n+e),s.ordinal&&0===e.indexOf(i)&&a.push(n+e.replace(i,this.options.pluralSeparator)),c&&a.push(n+t))}}for(;o=a.pop();)this.isValidLookup(t)||(i=o,t=this.getResource(n,e,o,s))}))})}),{res:t,usedKey:n,exactUsedKey:i,usedLng:r,usedNS:o}}isValidLookup(e){return void 0!==e&&!(!this.options.returnNull&&null===e)&&!(!this.options.returnEmptyString&&""===e)}getResource(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.i18nFormat?.getResource?this.i18nFormat.getResource(e,t,n,i):this.resourceStore.getResource(e,t,n,i)}getUsedParamsDetails(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.replace&&!tW(e.replace),n=t?e.replace:e;if(t&&void 0!==e.count&&(n.count=e.count),this.options.interpolation.defaultVariables&&(n={...this.options.interpolation.defaultVariables,...n}),!t)for(let e of(n={...n},["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"]))delete n[e];return n}static hasDefaultValue(e){let t="defaultValue";for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t===n.substring(0,t.length)&&void 0!==e[n])return!0;return!1}}class np{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=na.create("languageUtils")}getScriptPartFromCode(e){if(!(e=nr(e))||0>e.indexOf("-"))return null;let t=e.split("-");return 2===t.length?null:(t.pop(),"x"===t[t.length-1].toLowerCase())?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(e){if(!(e=nr(e))||0>e.indexOf("-"))return e;let t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(tW(e)&&e.indexOf("-")>-1){let t;try{t=Intl.getCanonicalLocales(e)[0]}catch(e){}return(t&&this.options.lowerCaseLng&&(t=t.toLowerCase()),t)?t:this.options.lowerCaseLng?e.toLowerCase():e}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){let t;return e?(e.forEach(e=>{if(t)return;let n=this.formatLanguageCode(e);(!this.options.supportedLngs||this.isSupportedCode(n))&&(t=n)}),!t&&this.options.supportedLngs&&e.forEach(e=>{if(t)return;let n=this.getLanguagePartFromCode(e);if(this.isSupportedCode(n))return t=n;t=this.options.supportedLngs.find(e=>{if(e===n||!(0>e.indexOf("-")&&0>n.indexOf("-"))&&(e.indexOf("-")>0&&0>n.indexOf("-")&&e.substring(0,e.indexOf("-"))===n||0===e.indexOf(n)&&n.length>1))return e})}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t):null}getFallbackCodes(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),tW(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let n=e[t];return n||(n=e[this.getScriptPartFromCode(t)]),n||(n=e[this.formatLanguageCode(t)]),n||(n=e[this.getLanguagePartFromCode(t)]),n||(n=e.default),n||[]}toResolveHierarchy(e,t){let n=this.getFallbackCodes(t||this.options.fallbackLng||[],e),i=[],r=e=>{e&&(this.isSupportedCode(e)?i.push(e):this.logger.warn(`rejecting language code not found in supportedLngs: ${e}`))};return tW(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?("languageOnly"!==this.options.load&&r(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&r(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&r(this.getLanguagePartFromCode(e))):tW(e)&&r(this.formatLanguageCode(e)),n.forEach(e=>{0>i.indexOf(e)&&r(this.formatLanguageCode(e))}),i}}const ng={zero:0,one:1,two:2,few:3,many:4,other:5},nm={select:e=>1===e?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class ny{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.languageUtils=e,this.options=t,this.logger=na.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=nr("dev"===e?"en":e),r=n.ordinal?"ordinal":"cardinal",o=JSON.stringify({cleanedCode:i,type:r});if(o in this.pluralRulesCache)return this.pluralRulesCache[o];try{t=new Intl.PluralRules(i,{type:r})}catch(r){if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),nm;if(!e.match(/-|_/))return nm;let i=this.languageUtils.getLanguagePartFromCode(e);t=this.getRule(i,n)}return this.pluralRulesCache[o]=t,t}needsPlural(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getRule(e,t);return n||(n=this.getRule("dev",t)),n?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.getSuffixes(e,n).map(e=>`${t}${e}`)}getSuffixes(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getRule(e,t);return(n||(n=this.getRule("dev",t)),n)?n.resolvedOptions().pluralCategories.sort((e,t)=>ng[e]-ng[t]).map(e=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${e}`):[]}getSuffix(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=this.getRule(e,n);return i?`${this.options.prepend}${n.ordinal?`ordinal${this.options.prepend}`:""}${i.select(t)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",t,n))}}const nv=function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:".",r=!(arguments.length>4)||void 0===arguments[4]||arguments[4],o=t4(e,t,n);return!o&&r&&tW(n)&&void 0===(o=ni(e,n,i))&&(o=ni(t,n,i)),o},n_=e=>e.replace(/\$/g,"$$$$");class nx{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=na.create("interpolator"),this.options=e,this.format=e?.interpolation?.format||(e=>e),this.init(e)}init(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});let{escape:t,escapeValue:n,useRawValueToEscape:i,prefix:r,prefixEscaped:o,suffix:s,suffixEscaped:a,formatSeparator:l,unescapeSuffix:u,unescapePrefix:h,nestingPrefix:c,nestingPrefixEscaped:d,nestingSuffix:f,nestingSuffixEscaped:p,nestingOptionsSeparator:g,maxReplaces:m,alwaysFormat:y}=e.interpolation;this.escape=void 0!==t?t:t7,this.escapeValue=void 0===n||n,this.useRawValueToEscape=void 0!==i&&i,this.prefix=r?t9(r):o||"{{",this.suffix=s?t9(s):a||"}}",this.formatSeparator=l||",",this.unescapePrefix=u?"":h||"-",this.unescapeSuffix=this.unescapePrefix?"":u||"",this.nestingPrefix=c?t9(c):d||t9("$t("),this.nestingSuffix=f?t9(f):p||t9(")"),this.nestingOptionsSeparator=g||",",this.maxReplaces=m||1e3,this.alwaysFormat=void 0!==y&&y,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){let e=(e,t)=>e?.source===t?(e.lastIndex=0,e):RegExp(t,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,n,i){let r,o,s,a=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},l=e=>{if(0>e.indexOf(this.formatSeparator)){let r=nv(t,a,e,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(r,void 0,n,{...i,...t,interpolationkey:e}):r}let r=e.split(this.formatSeparator),o=r.shift().trim(),s=r.join(this.formatSeparator).trim();return this.format(nv(t,a,o,this.options.keySeparator,this.options.ignoreJSONStructure),s,n,{...i,...t,interpolationkey:o})};this.resetRegExp();let u=i?.missingInterpolationHandler||this.options.missingInterpolationHandler,h=i?.interpolation?.skipOnVariables!==void 0?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:e=>n_(e)},{regex:this.regexp,safeValue:e=>this.escapeValue?n_(this.escape(e)):n_(e)}].forEach(t=>{for(s=0;r=t.regex.exec(e);){let n=r[1].trim();if(void 0===(o=l(n)))if("function"==typeof u){let t=u(e,r,i);o=tW(t)?t:""}else if(i&&Object.prototype.hasOwnProperty.call(i,n))o="";else if(h){o=r[0];continue}else this.logger.warn(`missed to pass in variable ${n} for interpolating ${e}`),o="";else tW(o)||this.useRawValueToEscape||(o=tX(o));let a=t.safeValue(o);if(e=e.replace(r[0],a),h?(t.regex.lastIndex+=o.length,t.regex.lastIndex-=r[0].length):t.regex.lastIndex=0,++s>=this.maxReplaces)break}}),e}nest(e,t){let n,i,r,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=(e,t)=>{let n=this.nestingOptionsSeparator;if(0>e.indexOf(n))return e;let i=e.split(RegExp(`${n}[ ]*{`)),o=`{${i[1]}`;e=i[0];let s=(o=this.interpolate(o,r)).match(/'/g),a=o.match(/"/g);((s?.length??0)%2!=0||a)&&a.length%2==0||(o=o.replace(/'/g,'"'));try{r=JSON.parse(o),t&&(r={...t,...r})}catch(t){return this.logger.warn(`failed parsing options string in nesting for key ${e}`,t),`${e}${n}${o}`}return r.defaultValue&&r.defaultValue.indexOf(this.prefix)>-1&&delete r.defaultValue,e};for(;n=this.nestingRegexp.exec(e);){let a=[];(r=(r={...o}).replace&&!tW(r.replace)?r.replace:r).applyPostProcessor=!1,delete r.defaultValue;let l=!1;if(-1!==n[0].indexOf(this.formatSeparator)&&!/{.*}/.test(n[1])){let e=n[1].split(this.formatSeparator).map(e=>e.trim());n[1]=e.shift(),a=e,l=!0}if((i=t(s.call(this,n[1].trim(),r),r))&&n[0]===e&&!tW(i))return i;tW(i)||(i=tX(i)),i||(this.logger.warn(`missed to resolve ${n[1]} for nesting ${e}`),i=""),l&&(i=a.reduce((e,t)=>this.format(e,t,o.lng,{...o,interpolationkey:n[1].trim()}),i.trim())),e=e.replace(n[0],i),this.regexp.lastIndex=0}return e}}const nb=e=>{let t=e.toLowerCase().trim(),n={};if(e.indexOf("(")>-1){let i=e.split("(");t=i[0].toLowerCase().trim();let r=i[1].substring(0,i[1].length-1);"currency"===t&&0>r.indexOf(":")?n.currency||(n.currency=r.trim()):"relativetime"===t&&0>r.indexOf(":")?n.range||(n.range=r.trim()):r.split(";").forEach(e=>{if(e){let[t,...i]=e.split(":"),r=i.join(":").trim().replace(/^'+|'+$/g,""),o=t.trim();n[o]||(n[o]=r),"false"===r&&(n[o]=!1),"true"===r&&(n[o]=!0),isNaN(r)||(n[o]=parseInt(r,10))}})}return{formatName:t,formatOptions:n}},nw=e=>{let t={};return(n,i,r)=>{let o=r;r&&r.interpolationkey&&r.formatParams&&r.formatParams[r.interpolationkey]&&r[r.interpolationkey]&&(o={...o,[r.interpolationkey]:void 0});let s=i+JSON.stringify(o),a=t[s];return a||(a=e(nr(i),r),t[s]=a),a(n)}};class nk{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=na.create("formatter"),this.options=e,this.formats={number:nw((e,t)=>{let n=new Intl.NumberFormat(e,{...t});return e=>n.format(e)}),currency:nw((e,t)=>{let n=new Intl.NumberFormat(e,{...t,style:"currency"});return e=>n.format(e)}),datetime:nw((e,t)=>{let n=new Intl.DateTimeFormat(e,{...t});return e=>n.format(e)}),relativetime:nw((e,t)=>{let n=new Intl.RelativeTimeFormat(e,{...t});return e=>n.format(e,t.range||"day")}),list:nw((e,t)=>{let n=new Intl.ListFormat(e,{...t});return e=>n.format(e)})},this.init(e)}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};this.formatSeparator=t.interpolation.formatSeparator||","}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=nw(t)}format(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=t.split(this.formatSeparator);if(r.length>1&&r[0].indexOf("(")>1&&0>r[0].indexOf(")")&&r.find(e=>e.indexOf(")")>-1)){let e=r.findIndex(e=>e.indexOf(")")>-1);r[0]=[r[0],...r.splice(1,e)].join(this.formatSeparator)}return r.reduce((e,t)=>{let{formatName:r,formatOptions:o}=nb(t);if(this.formats[r]){let t=e;try{let s=i?.formatParams?.[i.interpolationkey]||{},a=s.locale||s.lng||i.locale||i.lng||n;t=this.formats[r](e,a,{...o,...i,...s})}catch(e){this.logger.warn(e)}return t}return this.logger.warn(`there was no format function for ${r}`),e},e)}}const nS=(e,t)=>{void 0!==e.pending[t]&&(delete e.pending[t],e.pendingCount--)};class nE extends nl{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(),this.backend=e,this.store=t,this.services=n,this.languageUtils=n.languageUtils,this.options=i,this.logger=na.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=i.maxParallelReads||10,this.readingCalls=0,this.maxRetries=i.maxRetries>=0?i.maxRetries:5,this.retryTimeout=i.retryTimeout>=1?i.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(n,i.backend,i)}queueLoad(e,t,n,i){let r={},o={},s={},a={};return e.forEach(e=>{let i=!0;t.forEach(t=>{let s=`${e}|${t}`;!n.reload&&this.store.hasResourceBundle(e,t)?this.state[s]=2:this.state[s]<0||(1===this.state[s]?void 0===o[s]&&(o[s]=!0):(this.state[s]=1,i=!1,void 0===o[s]&&(o[s]=!0),void 0===r[s]&&(r[s]=!0),void 0===a[t]&&(a[t]=!0)))}),i||(s[e]=!0)}),(Object.keys(r).length||Object.keys(o).length)&&this.queue.push({pending:o,pendingCount:Object.keys(o).length,loaded:{},errors:[],callback:i}),{toLoad:Object.keys(r),pending:Object.keys(o),toLoadLanguages:Object.keys(s),toLoadNamespaces:Object.keys(a)}}loaded(e,t,n){let i=e.split("|"),r=i[0],o=i[1];t&&this.emit("failedLoading",r,o,t),!t&&n&&this.store.addResourceBundle(r,o,n,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&n&&(this.state[e]=0);let s={};this.queue.forEach(n=>{t5(n.loaded,[r],o),nS(n,e),t&&n.errors.push(t),0!==n.pendingCount||n.done||(Object.keys(n.loaded).forEach(e=>{s[e]||(s[e]={});let t=n.loaded[e];t.length&&t.forEach(t=>{void 0===s[e][t]&&(s[e][t]=!0)})}),n.done=!0,n.errors.length?n.callback(n.errors):n.callback())}),this.emit("loaded",s),this.queue=this.queue.filter(e=>!e.done)}read(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.retryTimeout,o=arguments.length>5?arguments[5]:void 0;if(!e.length)return o(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:t,fcName:n,tried:i,wait:r,callback:o});return}this.readingCalls++;let s=(s,a)=>{if(this.readingCalls--,this.waitingReads.length>0){let e=this.waitingReads.shift();this.read(e.lng,e.ns,e.fcName,e.tried,e.wait,e.callback)}if(s&&a&&i<this.maxRetries){setTimeout(()=>{this.read.call(this,e,t,n,i+1,2*r,o)},r);return}o(s,a)},a=this.backend[n].bind(this.backend);if(2===a.length){try{let n=a(e,t);n&&"function"==typeof n.then?n.then(e=>s(null,e)).catch(s):s(null,n)}catch(e){s(e)}return}return a(e,t,s)}prepareLoading(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),i&&i();tW(e)&&(e=this.languageUtils.toResolveHierarchy(e)),tW(t)&&(t=[t]);let r=this.queueLoad(e,t,n,i);if(!r.toLoad.length)return r.pending.length||i(),null;r.toLoad.forEach(e=>{this.loadOne(e)})}load(e,t,n){this.prepareLoading(e,t,{},n)}reload(e,t,n){this.prepareLoading(e,t,{reload:!0},n)}loadOne(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=e.split("|"),i=n[0],r=n[1];this.read(i,r,"read",void 0,void 0,(n,o)=>{n&&this.logger.warn(`${t}loading namespace ${r} for language ${i} failed`,n),!n&&o&&this.logger.log(`${t}loaded namespace ${r} for language ${i}`,o),this.loaded(e,n,o)})}saveMissing(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:()=>{};if(this.services?.utils?.hasLoadedNamespace&&!this.services?.utils?.hasLoadedNamespace(t)){this.logger.warn(`did not save key "${n}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(null!=n&&""!==n){if(this.backend?.create){let a={...o,isUpdate:r},l=this.backend.create.bind(this.backend);if(l.length<6)try{let r;(r=5===l.length?l(e,t,n,i,a):l(e,t,n,i))&&"function"==typeof r.then?r.then(e=>s(null,e)).catch(s):s(null,r)}catch(e){s(e)}else l(e,t,n,i,s,a)}e&&e[0]&&this.store.addResource(e[0],t,n,i)}}}const n$=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if("object"==typeof e[1]&&(t=e[1]),tW(e[1])&&(t.defaultValue=e[1]),tW(e[2])&&(t.tDescription=e[2]),"object"==typeof e[2]||"object"==typeof e[3]){let n=e[3]||e[2];Object.keys(n).forEach(e=>{t[e]=n[e]})}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),nC=e=>(tW(e.ns)&&(e.ns=[e.ns]),tW(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),tW(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),e.supportedLngs?.indexOf?.("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),"boolean"==typeof e.initImmediate&&(e.initAsync=e.initImmediate),e),nO=()=>{},nL=e=>{Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach(t=>{"function"==typeof e[t]&&(e[t]=e[t].bind(e))})};class nR extends nl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(super(),this.options=nC(e),this.services={},this.logger=na,this.modules={external:[]},nL(this),t&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,"function"==typeof t&&(n=t,t={}),null==t.defaultNS&&t.ns&&(tW(t.ns)?t.defaultNS=t.ns:0>t.ns.indexOf("translation")&&(t.defaultNS=t.ns[0]));let i=n$();this.options={...i,...this.options,...nC(t)},this.options.interpolation={...i.interpolation,...this.options.interpolation},void 0!==t.keySeparator&&(this.options.userDefinedKeySeparator=t.keySeparator),void 0!==t.nsSeparator&&(this.options.userDefinedNsSeparator=t.nsSeparator);let r=e=>e?"function"==typeof e?new e:e:null;if(!this.options.isClone){let t;this.modules.logger?na.init(r(this.modules.logger),this.options):na.init(null,this.options),t=this.modules.formatter?this.modules.formatter:nk;let n=new np(this.options);this.store=new nu(this.options.resources,this.options);let o=this.services;o.logger=na,o.resourceStore=this.store,o.languageUtils=n,o.pluralResolver=new ny(n,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),t&&(!this.options.interpolation.format||this.options.interpolation.format===i.interpolation.format)&&(o.formatter=r(t),o.formatter.init(o,this.options),this.options.interpolation.format=o.formatter.format.bind(o.formatter)),o.interpolator=new nx(this.options),o.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},o.backendConnector=new nE(r(this.modules.backend),o.resourceStore,o,this.options),o.backendConnector.on("*",function(t){for(var n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];e.emit(t,...i)}),this.modules.languageDetector&&(o.languageDetector=r(this.modules.languageDetector),o.languageDetector.init&&o.languageDetector.init(o,this.options.detection,this.options)),this.modules.i18nFormat&&(o.i18nFormat=r(this.modules.i18nFormat),o.i18nFormat.init&&o.i18nFormat.init(this)),this.translator=new nf(this.services,this.options),this.translator.on("*",function(t){for(var n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];e.emit(t,...i)}),this.modules.external.forEach(e=>{e.init&&e.init(this)})}if(this.format=this.options.interpolation.format,n||(n=nO),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){let e=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);e.length>0&&"dev"!==e[0]&&(this.options.lng=e[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(t=>{this[t]=function(){return e.store[t](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(t=>{this[t]=function(){return e.store[t](...arguments),e}});let o=tY(),s=()=>{let e=(e,t)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),o.resolve(t),n(e,t)};if(this.languages&&!this.isInitialized)return e(null,this.t.bind(this));this.changeLanguage(this.options.lng,e)};return this.options.resources||!this.options.initAsync?s():setTimeout(s,0),o}loadResources(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nO,n=t,i=tW(e)?e:this.language;if("function"==typeof e&&(n=e),!this.options.resources||this.options.partialBundledLanguages){if(i?.toLowerCase()==="cimode"&&(!this.options.preload||0===this.options.preload.length))return n();let e=[],t=t=>{t&&"cimode"!==t&&this.services.languageUtils.toResolveHierarchy(t).forEach(t=>{"cimode"!==t&&0>e.indexOf(t)&&e.push(t)})};i?t(i):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(e=>t(e)),this.options.preload?.forEach?.(e=>t(e)),this.services.backendConnector.load(e,this.options.ns,e=>{e||this.resolvedLanguage||!this.language||this.setResolvedLanguage(this.language),n(e)})}else n(null)}reloadResources(e,t,n){let i=tY();return"function"==typeof e&&(n=e,e=void 0),"function"==typeof t&&(n=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),n||(n=nO),this.services.backendConnector.reload(e,t,e=>{i.resolve(),n(e)}),i}use(e){if(!e)throw Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&nh.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}setResolvedLanguage(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1))for(let e=0;e<this.languages.length;e++){let t=this.languages[e];if(!(["cimode","dev"].indexOf(t)>-1)&&this.store.hasLanguageSomeTranslations(t)){this.resolvedLanguage=t;break}}}changeLanguage(e,t){var n=this;this.isLanguageChangingTo=e;let i=tY();this.emit("languageChanging",e);let r=e=>{this.language=e,this.languages=this.services.languageUtils.toResolveHierarchy(e),this.resolvedLanguage=void 0,this.setResolvedLanguage(e)},o=(e,o)=>{o?(r(o),this.translator.changeLanguage(o),this.isLanguageChangingTo=void 0,this.emit("languageChanged",o),this.logger.log("languageChanged",o)):this.isLanguageChangingTo=void 0,i.resolve(function(){return n.t(...arguments)}),t&&t(e,function(){return n.t(...arguments)})},s=t=>{e||t||!this.services.languageDetector||(t=[]);let n=tW(t)?t:this.services.languageUtils.getBestMatchFromCodes(t);n&&(this.language||r(n),this.translator.language||this.translator.changeLanguage(n),this.services.languageDetector?.cacheUserLanguage?.(n)),this.loadResources(n,e=>{o(e,n)})};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?0===this.services.languageDetector.detect.length?this.services.languageDetector.detect().then(s):this.services.languageDetector.detect(s):s(e):s(this.services.languageDetector.detect()),i}getFixedT(e,t,n){var i=this;let r=function(e,t){let o,s;if("object"!=typeof t){for(var a=arguments.length,l=Array(a>2?a-2:0),u=2;u<a;u++)l[u-2]=arguments[u];o=i.options.overloadTranslationOptionHandler([e,t].concat(l))}else o={...t};o.lng=o.lng||r.lng,o.lngs=o.lngs||r.lngs,o.ns=o.ns||r.ns,""!==o.keyPrefix&&(o.keyPrefix=o.keyPrefix||n||r.keyPrefix);let h=i.options.keySeparator||".";return s=o.keyPrefix&&Array.isArray(e)?e.map(e=>`${o.keyPrefix}${h}${e}`):o.keyPrefix?`${o.keyPrefix}${h}${e}`:e,i.t(s,o)};return tW(e)?r.lng=e:r.lngs=e,r.ns=t,r.keyPrefix=n,r}t(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.translator?.translate(...t)}exists(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.translator?.exists(...t)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;let n=t.lng||this.resolvedLanguage||this.languages[0],i=!!this.options&&this.options.fallbackLng,r=this.languages[this.languages.length-1];if("cimode"===n.toLowerCase())return!0;let o=(e,t)=>{let n=this.services.backendConnector.state[`${e}|${t}`];return -1===n||0===n||2===n};if(t.precheck){let e=t.precheck(this,o);if(void 0!==e)return e}return!!(this.hasResourceBundle(n,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||o(n,e)&&(!i||o(r,e)))}loadNamespaces(e,t){let n=tY();return this.options.ns?(tW(e)&&(e=[e]),e.forEach(e=>{0>this.options.ns.indexOf(e)&&this.options.ns.push(e)}),this.loadResources(e=>{n.resolve(),t&&t(e)}),n):(t&&t(),Promise.resolve())}loadLanguages(e,t){let n=tY();tW(e)&&(e=[e]);let i=this.options.preload||[],r=e.filter(e=>0>i.indexOf(e)&&this.services.languageUtils.isSupportedCode(e));return r.length?(this.options.preload=i.concat(r),this.loadResources(e=>{n.resolve(),t&&t(e)}),n):(t&&t(),Promise.resolve())}dir(e){return(e||(e=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),e)?["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf((this.services?.languageUtils||new np(n$())).getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr":"rtl"}static createInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return new nR(e,t)}cloneInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nO,n=e.forkResourceStore;n&&delete e.forkResourceStore;let i={...this.options,...e,isClone:!0},r=new nR(i);return(void 0!==e.debug||void 0!==e.prefix)&&(r.logger=r.logger.clone(e)),["store","services","language"].forEach(e=>{r[e]=this[e]}),r.services={...this.services},r.services.utils={hasLoadedNamespace:r.hasLoadedNamespace.bind(r)},n&&(r.store=new nu(Object.keys(this.store.data).reduce((e,t)=>(e[t]={...this.store.data[t]},Object.keys(e[t]).reduce((n,i)=>(n[i]={...e[t][i]},n),{})),{}),i),r.services.resourceStore=r.store),r.translator=new nf(r.services,i),r.translator.on("*",function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];r.emit(e,...n)}),r.init(i,t),r.translator.options=i,r.translator.backendConnector.services.utils={hasLoadedNamespace:r.hasLoadedNamespace.bind(r)},r}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const nA=nR.createInstance();nA.createInstance=nR.createInstance,nA.createInstance,nA.dir,nA.init,nA.loadResources,nA.reloadResources,nA.use,nA.changeLanguage,nA.getFixedT,nA.t,nA.exists,nA.setDefaultNamespace,nA.hasLoadedNamespace,nA.loadNamespaces,nA.loadLanguages;const{slice:nM,forEach:nI}=[],nN=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,nT=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{path:"/"},i=encodeURIComponent(t),r=`${e}=${i}`;if(n.maxAge>0){let e=n.maxAge-0;if(Number.isNaN(e))throw Error("maxAge should be a Number");r+=`; Max-Age=${Math.floor(e)}`}if(n.domain){if(!nN.test(n.domain))throw TypeError("option domain is invalid");r+=`; Domain=${n.domain}`}if(n.path){if(!nN.test(n.path))throw TypeError("option path is invalid");r+=`; Path=${n.path}`}if(n.expires){if("function"!=typeof n.expires.toUTCString)throw TypeError("option expires is invalid");r+=`; Expires=${n.expires.toUTCString()}`}if(n.httpOnly&&(r+="; HttpOnly"),n.secure&&(r+="; Secure"),n.sameSite)switch("string"==typeof n.sameSite?n.sameSite.toLowerCase():n.sameSite){case!0:case"strict":r+="; SameSite=Strict";break;case"lax":r+="; SameSite=Lax";break;case"none":r+="; SameSite=None";break;default:throw TypeError("option sameSite is invalid")}return r},nz={create(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{path:"/",sameSite:"strict"};n&&(r.expires=new Date,r.expires.setTime(r.expires.getTime()+6e4*n)),i&&(r.domain=i),document.cookie=nT(e,encodeURIComponent(t),r)},read(e){let t=`${e}=`,n=document.cookie.split(";");for(let e=0;e<n.length;e++){let i=n[e];for(;" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return i.substring(t.length,i.length)}return null},remove(e){this.create(e,"",-1)}};let nP=null;const nF=()=>{if(null!==nP)return nP;try{if(!(nP="undefined"!=typeof window&&null!==window.localStorage))return!1;let e="i18next.translate.boo";window.localStorage.setItem(e,"foo"),window.localStorage.removeItem(e)}catch(e){nP=!1}return nP};let nD=null;const nj=()=>{if(null!==nD)return nD;try{if(!(nD="undefined"!=typeof window&&null!==window.sessionStorage))return!1;let e="i18next.translate.boo";window.sessionStorage.setItem(e,"foo"),window.sessionStorage.removeItem(e)}catch(e){nD=!1}return nD};let nB=!1;try{document.cookie,nB=!0}catch(e){}const nV=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];nB||nV.splice(1,1);function nH(e,t={}){try{return nA.t(e,t)}catch(t){return!function(e,t=null){console.log(`[i18n] ${e}`),t&&console.log(t)}(`Error translating key: ${e}`,t),e}}function nU(e,t=null){console.log(`[NodeRenderer] ${e}`),t&&console.log(t)}class nK{constructor(e){this.config=e,this.nodeWidth=220,this.nodeHeight=140,nU("Initialized NodeRenderer with config",e)}createNodes(e,t,n){nU("Creating nodes",{nodeCount:t.length}),e.selectAll(".node").data(t).enter().append("g").attr("class","node").attr("transform",e=>n?`translate(${e.y},${e.x})`:`translate(${e.x},${e.y})`).each((e,t,n)=>{let i=eo(n[t]),r=e.data;"family-root"!==r.id&&this.createFamilyBox(i,r,e)})}createFamilyBox(e,t,n){let i,r;nU(`Creating family box for unit ${t.id}`);let o=t.person,s=t.spouse;if(!o){nU(`No person found for family unit ${t.id}`);return}"male"===o.gender?(i=o,r=s):(i=s,r=o);let a="";a=n.parent&&"family-root"!==n.parent.data.id?this.determineRelationClass(n,t):i&&!r?"male-node":!i&&r?"female-node":"couple-node";let l=this.nodeWidth,u=this.nodeHeight;e.append("rect").attr("x",-l/2).attr("y",-u/2).attr("width",l).attr("height",u).attr("class",`node-box ${a}`);let h=l/4,c=3*l/4,d=e.append("g").attr("class","photo-section").attr("transform",`translate(${-l/2+h/2}, 0)`);i&&r?d.append("g").attr("class","couple-silhouette").attr("transform","scale(0.5)").append("path").attr("d","M-25,-20 C-25,-30 -15,-40 -5,-40 C5,-40 15,-30 15,-20 C15,-10 5,0 -5,0 L-5,20 M15,-20 C15,-30 25,-40 35,-40 C45,-40 55,-30 55,-20 C55,-10 45,0 35,0 L35,20"):i?d.append("g").attr("class","male-silhouette").attr("transform","scale(2) translate(-15, -5)").append("path").attr("d","M15,-5 C17.761,-5 20,-2.761 20,0 C20,2.761 17.761,5 15,5 C12.239,5 10,2.761 10,0 C10,-2.761 12.239,-5 15,-5 Z M15,7 C10.029,7 6,11.029 6,16 L24,16 C24,11.029 19.971,7 15,7 Z"):r&&d.append("g").attr("class","female-silhouette").attr("transform","scale(2) translate(-15, -5)").append("path").attr("d","M15,-5 C17.761,-5 20,-2.761 20,0 C20,2.761 17.761,5 15,5 C12.239,5 10,2.761 10,0 C10,-2.761 12.239,-5 15,-5 Z M15,7 C10.029,7 6,11.029 6,16 L24,16 C24,11.029 19.971,7 15,7 Z");let f=e.append("g").attr("class","text-content").attr("transform",`translate(0, ${-u/2+16})`),p=0;if(i){let e=f.append("text").attr("class","name").attr("y",p).attr("text-anchor","middle").text(i.name||nH("unknown",{lng:this.config.language}));p+=16+(this.wrapText(e,c-20)-1)*16;let t="";if(i.birth_date&&"undefined"!==i.birth_date&&(t=i.birth_date,i.death_date&&"undefined"!==i.death_date&&(t+=` - ${i.death_date}`)),t){let e=f.append("text").attr("class","lifespan").attr("y",p).attr("text-anchor","middle").text(t);p+=14+(this.wrapText(e,c-20)-1)*14}else p+=6}if(r){i&&(f.append("line").attr("class","spouse-divider").attr("x1",-c/2+10).attr("y1",p-2).attr("x2",c/2-10).attr("y2",p-2),p+=12);let e=f.append("text").attr("class","spouse-name").attr("y",p).attr("text-anchor","middle").text(r.name||nH("unknown",{lng:this.config.language}));p+=16+(this.wrapText(e,c-20)-1)*16;let t="";if(r.birth_date&&"undefined"!==r.birth_date&&(t=r.birth_date,r.death_date&&"undefined"!==r.death_date&&(t+=` - ${r.death_date}`)),t){let e=f.append("text").attr("class","spouse-lifespan").attr("y",p).attr("text-anchor","middle").text(t);p+=14+(this.wrapText(e,c-20)-1)*14}else p+=6}}determineRelationClass(e,t){if(!e.parent||!e.parent.data||!e.parent.data.coupleInfo)return"couple-node";let n=e.parent.data,i=t.person;if(!i)return"couple-node";let r=n.coupleInfo.fatherId,o=n.coupleInfo.motherId,s=i.parents.includes(r),a=i.parents.includes(o);return s&&!a||a&&!s||s&&a?"male"===i.gender?"boy-child-node":"girl-child-node":"couple-node"}calculateAge(e){if(!e)return null;try{if(/^\d{4}$/.test(e)){let t=parseInt(e,10);return new Date().getFullYear()-t}let t=new Date(e);if(isNaN(t.getTime()))return null;let n=new Date,i=n.getFullYear()-t.getFullYear(),r=n.getMonth()-t.getMonth();return(r<0||0===r&&n.getDate()<t.getDate())&&i--,i}catch(t){return nU("Error calculating age",{birthDateString:e,error:t}),null}}wrapText(e,t){let n=1;return e.each(function(){let e=eo(this),i=e.text().split(/\s+/).reverse(),r=e.attr("y"),o=parseFloat(e.attr("dy")||0),s=e.attr("text-anchor")||"start",a=e.attr("x")||0,l=[],u=0,h=i.pop(),c=e.text(null).append("tspan").attr("x",a).attr("y",r).attr("dy",o+"em").attr("text-anchor",s);for(;h;)l.push(h),c.text(l.join(" ")),c.node().getComputedTextLength()>t&&(l.pop(),c.text(l.join(" ")),l=[h],c=e.append("tspan").attr("x",a).attr("y",r).attr("dy",1.3*++u+o+"em").attr("text-anchor",s).text(h),n++),h=i.pop()}),n}getPersonColor(e){if(!e)return"#757575";if("gender"===this.config.colorScheme){let t=e.gender?e.gender.toLowerCase():"";return"male"===t?"var(--tree-male-color)":"female"===t?"var(--tree-female-color)":"#757575"}if("generation"===this.config.colorScheme){let t=["#1976d2","#388e3c","#f57c00","#d32f2f","#7b1fa2","#00796b"],n=e.generation%t.length;return t[n]}return"tree"===this.config.colorScheme?"var(--tree-node-stroke)":"#2196f3"}}function nq(e,t=null){console.log(`[LinkRenderer] ${e}`),t&&console.log(t)}class nG{constructor(e){this.config=e,this.nodeWidth=220,this.nodeHeight=140,nq("Initialized LinkRenderer with config",e)}createLinks(e,t){nq("Creating parent-child links");let n=t.links().filter(e=>"family-root"!==e.source.data.id),i=this.getLinkGenerator();e.selectAll(".link").data(n).enter().append("path").attr("class","link").attr("d",i)}createMarriageLinks(e,t,n){let i=t.filter(e=>"family-root"!==e.data.id&&e.data.spouse);nq(`Creating marriage links for ${i.length} nodes with spouses`),i.forEach(t=>{try{nq(`Creating marriage link for node ${t.data.id}`);let i=t$().x(e=>e.x).y(e=>e.y),r=[];r=n?[{x:t.y-this.nodeWidth/4,y:t.x},{x:t.y+this.nodeWidth/4,y:t.x}]:[{x:t.x-this.nodeWidth/4,y:t.y},{x:t.x+this.nodeWidth/4,y:t.y}],e.append("path").attr("class","link-marriage").attr("d",i(r))}catch(e){nq(`Error creating marriage link for node ${t.data.id}`,e)}})}getLinkGenerator(){let e;this.config.orientation;let t=this.config.lineStyle,n=this.isHorizontalOrientation();return(e=n?tM(tO).x(e=>e.y).y(e=>e.x):tM(tL).x(e=>e.x).y(e=>e.y),"curved"===t)?e=>{let t,i={x:e.source.x,y:e.source.y},r={x:e.target.x,y:e.target.y};if(n){let e=(i.y+r.y)/2;t=t$().x(e=>e.y).y(e=>e.x).curve(tc)([{x:i.x,y:i.y},{x:i.x,y:e},{x:r.x,y:e},{x:r.x,y:r.y}])}else{let e=(i.x+r.x)/2;t=t$().curve(tc)([{x:i.x,y:i.y},{x:e,y:i.y},{x:e,y:r.y},{x:r.x,y:r.y}])}return t}:"orthogonal"===t||"angled"===t?e=>{let t,i={x:e.source.x,y:e.source.y},r={x:e.target.x,y:e.target.y};return n?t$().x(e=>e.y).y(e=>e.x).curve(tf)([i,r]):t$().curve(tf)([i,r])}:e}isHorizontalOrientation(){return"left-right"===this.config.orientation||"right-left"===this.config.orientation}}function nW(e,t=null){console.log(`[TreeBuilder] ${e}`),t&&console.log(t)}class nY{constructor(e,t){this.familyTree=e,this.config=t,this.rootPersonId=this.config.rootPersonId||this.familyTree.rootPersonId,this.processedCouples=new Set,this.coupleGenerations=new Map,nW(`Initialized TreeBuilder with ${e.individuals.length} individuals`)}buildHierarchy(){nW("Converting family tree to hierarchy with root person ID:",this.rootPersonId),this.processedCouples.clear(),this.coupleGenerations.clear();let e=this.familyTree.individuals.find(e=>e.id===this.rootPersonId);e||(nW("Root person not found, using first person in data"),e=this.familyTree.individuals[0]);let t={id:"family-root",name:"Family Root",children:[]};if(e.spouses&&e.spouses.length>0&&e.spouses.forEach(n=>{let i=this.familyTree.individuals.find(e=>e.id===n);if(i){let n=[e.id,i.id].sort(),r=`couple-${n[0]}-${n[1]}`;this.coupleGenerations.set(r,0);let o=this.createFamilyUnit(e,i);t.children.push(o),this.config.showOnlyDirectFamily?this.processDirectChildrenForMarriage(o,e,i,1):this.processDescendantsForMarriage(o,e,i,new Set([e.id,i.id]),1)}}),0===t.children.length){let n=`single-${e.id}`;this.coupleGenerations.set(n,0);let i=this.createFamilyUnit(e,null);t.children.push(i),this.config.showOnlyDirectFamily?this.processDirectChildren(i,e,1):this.processDescendants(i,e,new Set([e.id]),1)}return nW("Hierarchy built with structure",{rootId:t.id,childrenCount:t.children.length}),e7(t)}processDirectChildrenForMarriage(e,t,n,i){nW(`Processing direct children for marriage of ${t.id} and ${n?n.id:"null"} at generation ${i}`);let r=e.coupleInfo.fatherId,o=e.coupleInfo.motherId;[...this.familyTree.individuals.filter(e=>{let i=!r||e.parents.includes(r),s=!o||e.parents.includes(o);return i&&s&&e.id!==t.id&&e.id!==(n?n.id:null)})].sort((e,t)=>e.birthOrder&&t.birthOrder?e.birthOrder-t.birthOrder:0).forEach(t=>{if(nW(`Processing child ${t.id} of marriage ${e.id}`),t.spouses&&t.spouses.length>0)t.spouses.forEach(n=>{let r=this.familyTree.individuals.find(e=>e.id===n);if(r){let n=[t.id,r.id].sort(),o=`couple-${n[0]}-${n[1]}`;this.coupleGenerations.set(o,i);let s=this.createFamilyUnit(t,r);e.children.push(s),this.processDirectChildrenForMarriage(s,t,r,i+1)}});else{let n=`single-${t.id}`;this.coupleGenerations.set(n,i);let r=this.createFamilyUnit(t,null);e.children.push(r),this.processDirectChildren(r,t,i+1)}})}processDirectChildren(e,t,n){nW(`Processing direct children for single person ${t.id} at generation ${n}`),[...this.familyTree.individuals.filter(e=>e.parents.includes(t.id)&&e.id!==t.id)].sort((e,t)=>e.birthOrder&&t.birthOrder?e.birthOrder-t.birthOrder:0).forEach(i=>{if(nW(`Processing child ${i.id} of single parent ${t.id}`),i.spouses&&i.spouses.length>0)i.spouses.forEach(t=>{let r=this.familyTree.individuals.find(e=>e.id===t);if(r){let t=[i.id,r.id].sort(),o=`couple-${t[0]}-${t[1]}`;this.coupleGenerations.set(o,n);let s=this.createFamilyUnit(i,r);e.children.push(s),this.processDirectChildrenForMarriage(s,i,r,n+1)}});else{let t=`single-${i.id}`;this.coupleGenerations.set(t,n);let r=this.createFamilyUnit(i,null);e.children.push(r),this.processDirectChildren(r,i,n+1)}})}processDescendantsForMarriage(e,t,n,i,r){nW(`Processing descendants for marriage of ${t.id} and ${n?n.id:"null"} at generation ${r}`);let o=e.coupleInfo.fatherId,s=e.coupleInfo.motherId;[...this.familyTree.individuals.filter(e=>{if(i.has(e.id))return!1;let r=!o||e.parents.includes(o),a=!s||e.parents.includes(s);return r&&a&&e.id!==t.id&&e.id!==(n?n.id:null)})].sort((e,t)=>e.birthOrder&&t.birthOrder?e.birthOrder-t.birthOrder:0).forEach(t=>{if(i.add(t.id),t.spouses&&t.spouses.length>0)t.spouses.forEach(n=>{let o=this.familyTree.individuals.find(e=>e.id===n);if(o){let n=[t.id,o.id].sort(),s=`couple-${n[0]}-${n[1]}`;this.coupleGenerations.set(s,r);let a=this.createFamilyUnit(t,o);e.children.push(a);let l=new Set(i);l.add(o.id),this.processDescendantsForMarriage(a,t,o,l,r+1)}});else{let n=`single-${t.id}`;this.coupleGenerations.set(n,r);let o=this.createFamilyUnit(t,null);e.children.push(o),this.processDescendants(o,t,new Set(i),r+1)}})}processDescendants(e,t,n,i){nW(`Processing all descendants for person ${t.id} at generation ${i}`),[...this.familyTree.individuals.filter(e=>!n.has(e.id)&&e.parents.includes(t.id)&&e.id!==t.id)].sort((e,t)=>e.birthOrder&&t.birthOrder?e.birthOrder-t.birthOrder:0).forEach(t=>{if(n.add(t.id),t.spouses&&t.spouses.length>0)t.spouses.forEach(r=>{let o=this.familyTree.individuals.find(e=>e.id===r);if(o){let r=[t.id,o.id].sort(),s=`couple-${r[0]}-${r[1]}`;this.coupleGenerations.set(s,i);let a=this.createFamilyUnit(t,o);e.children.push(a);let l=new Set(n);l.add(o.id),this.processDescendantsForMarriage(a,t,o,l,i+1)}});else{let r=`single-${t.id}`;this.coupleGenerations.set(r,i);let o=this.createFamilyUnit(t,null);e.children.push(o),this.processDescendants(o,t,new Set(n),i+1)}})}createFamilyUnit(e,t){let n,i=t?` with ${t.name}`:" (single)";if(nW(`Creating family unit for person ${e.id}${i}`),t){let i=[e.id,t.id].sort();n=`couple-${i[0]}-${i[1]}`}else n=`single-${e.id}`;return{id:n,name:t?`${e.name} & ${t.name}`:e.name,person:e,spouse:t,children:[],coupleInfo:{fatherId:"male"===e.gender?e.id:t?t.id:null,motherId:"female"===e.gender?e.id:t?t.id:null}}}}function nX(e,t=null){console.log(`[TreeLayout] ${e}`),t&&console.log(t)}class nJ{constructor(e){this.config=e,this.nodeWidth=220,this.nodeHeight=140,this.transform=null,this.treeLayout=null,this.setupTreeLayout(),nX("Initialized TreeLayout with config",e)}setupTreeLayout(){nX("Setting up tree layout");let e=[this.nodeWidth*this.config.nodeSize,this.nodeHeight*this.config.nodeSize],t=[e[0]*this.config.nodeSpacing,e[1]*this.config.nodeSpacing];this.treeLayout=(function(){var e=to,t=1,n=1,i=null;function r(r){var l=function(e){for(var t,n,i,r,o,s=new tl(e,0),a=[s];t=a.pop();)if(i=t._.children)for(t.children=Array(o=i.length),r=o-1;r>=0;--r)a.push(n=t.children[r]=new tl(i[r],r)),n.parent=t;return(s.parent=new tl(null,0)).children=[s],s}(r);if(l.eachAfter(o),l.parent.m=-l.z,l.eachBefore(s),i)r.eachBefore(a);else{var u=r,h=r,c=r;r.eachBefore(function(e){e.x<u.x&&(u=e),e.x>h.x&&(h=e),e.depth>c.depth&&(c=e)});var d=u===h?1:e(u,h)/2,f=d-u.x,p=t/(h.x+d+f),g=n/(c.depth||1);r.eachBefore(function(e){e.x=(e.x+f)*p,e.y=e.depth*g})}return r}function o(t){var n=t.children,i=t.parent.children,r=t.i?i[t.i-1]:null;if(n){!function(e){for(var t,n=0,i=0,r=e.children,o=r.length;--o>=0;)t=r[o],t.z+=n,t.m+=n,n+=t.s+(i+=t.c)}(t);var o=(n[0].z+n[n.length-1].z)/2;r?(t.z=r.z+e(t._,r._),t.m=t.z-o):t.z=o}else r&&(t.z=r.z+e(t._,r._));t.parent.A=function(t,n,i){if(n){for(var r,o,s,a=t,l=t,u=n,h=a.parent.children[0],c=a.m,d=l.m,f=u.m,p=h.m;u=ta(u),a=ts(a),u&&a;)h=ts(h),(l=ta(l)).a=t,(s=u.z+f-a.z-c+e(u._,a._))>0&&(function(e,t,n){var i=n/(t.i-e.i);t.c-=i,t.s+=n,e.c+=i,t.z+=n,t.m+=n}((r=u,o=i,r.a.parent===t.parent?r.a:o),t,s),c+=s,d+=s),f+=u.m,c+=a.m,p+=h.m,d+=l.m;u&&!ta(l)&&(l.t=u,l.m+=f-d),a&&!ts(h)&&(h.t=a,h.m+=c-p,i=t)}return i}(t,r,t.parent.A||i[0])}function s(e){e._.x=e.z+e.parent.m,e.m+=e.parent.m}function a(e){e.x*=t,e.y=e.depth*n}return r.separation=function(t){return arguments.length?(e=t,r):e},r.size=function(e){return arguments.length?(i=!1,t=+e[0],n=+e[1],r):i?null:[t,n]},r.nodeSize=function(e){return arguments.length?(i=!0,t=+e[0],n=+e[1],r):i?[t,n]:null},r})().nodeSize(t).separation((e,t)=>e.parent===t.parent?1.2:1.5),this.setupOrientation(),nX("Tree layout configured",{nodeSize:t,orientation:this.config.orientation})}setupOrientation(){switch(this.config.orientation){case"top-down":default:this.transform=e=>e;break;case"bottom-up":this.transform=e=>(e.y=-e.y,e);break;case"left-right":this.transform=e=>{let t=e.x;return e.x=e.y,e.y=t,e};break;case"right-left":this.transform=e=>{let t=e.x;return e.x=-e.y,e.y=t,e}}}applyLayout(e){nX("Applying tree layout to hierarchy data"),e.sort((e,t)=>{let n=e.depth-t.depth;return 0!==n?n:0});let t=this.treeLayout(e);return t.each(e=>{this.transform&&this.transform(e)}),t}isHorizontalOrientation(){return"left-right"===this.config.orientation||"right-left"===this.config.orientation}setupZoom(e,t){nX("Setting up zoom behavior");let n=tG().scaleExtent([.1,3]).on("zoom",e=>{t.attr("transform",e.transform)});e.call(n)}resetView(e,t,n){nX("Resetting view to fit tree");let i=n.descendants().filter(e=>"family-root"!==e.data.id);if(0===i.length)return;let r=1/0,o=-1/0,s=1/0,a=-1/0;i.forEach(e=>{let t=this.isHorizontalOrientation()?e.y:e.x,n=this.isHorizontalOrientation()?e.x:e.y;r=Math.min(r,t-this.nodeWidth/2),o=Math.max(o,t+this.nodeWidth/2),s=Math.min(s,n-this.nodeHeight/2),a=Math.max(a,n+this.nodeHeight/2)}),r-=50,o+=50,s-=50,a+=50;let l=o-r,u=a-s,h=Math.min(this.config.svgWidth/l,this.config.svgHeight/u,1),c=this.config.svgWidth/2-(r+l/2)*h,d=this.config.svgHeight/2-(s+u/2)*h,f=tF.translate(c,d).scale(h);e.transition().duration(750).call(tG().transform,f)}}function nQ(e,t=null){console.log(`[ExportUtils] ${e}`),t&&console.log(t)}function nZ(e,t,n){if(nQ("Exporting SVG"),!e||e.empty()){console.error("No SVG to export");return}try{let i=e.node().cloneNode(!0),r=eo(i).select(".tree-group");if(r.empty()){console.error("No tree group found in SVG");return}r.attr("transform");let o=eo(i).selectAll(".node");if(o.empty()){console.error("No nodes found in SVG");return}let s=1/0,a=1/0,l=-1/0,u=-1/0;o.each(function(){let e,i,r=eo(this).attr("transform");if(r.startsWith("translate("))try{let t=r.substring(10,r.length-1).split(",");e=parseFloat(t[0]),i=parseFloat(t[1])}catch(e){nQ("Error parsing transform",{transform:r,error:e});return}else try{let t=this.getScreenCTM();if(!t)return;e=t.e,i=t.f}catch(e){nQ("Error getting CTM",{error:e});return}let o=t/2,h=n/2;s=Math.min(s,e-o),a=Math.min(a,i-h),l=Math.max(l,e+o),u=Math.max(u,i+h)}),s-=80,a-=80,l+=80,u+=80;let h=l-s,c=u-a;nQ("SVG bounds calculated",{minX:s,minY:a,maxX:l,maxY:u,width:h,height:c}),r.attr("transform",`translate(${-s}, ${-a})`),i.setAttribute("viewBox",`0 0 ${h} ${c}`),i.setAttribute("width",h),i.setAttribute("height",c);let d=document.createElement("style");d.textContent=`
            /* Node styling */
            .node-box {
                stroke: #5d4037;
                stroke-width: 2px;
                fill: #8bc34a;
                rx: 5px;
                ry: 5px;
            }
            
            /* Gender-specific styling */
            .male-node {
                fill: #8BC34A;
            }
            
            .female-node {
                fill: #F8BBD0;
            }
            
            /* Couple node */
            .couple-node {
                fill: #8BC34A;
            }
            
            /* Relationship-based styling */
            .boy-child-node {
                fill: #8BC34A;
            }
            
            .girl-child-node {
                fill: #F8BBD0;
            }
            
            /* Text styling */
            .name {
                font-weight: bold;
                font-size: 14px;
                fill: #212121;
            }
            
            .spouse-name {
                font-size: 14px;
                fill: #212121;
            }
            
            .lifespan, .spouse-lifespan, .native-place, .birth-order {
                font-size: 12px;
                fill: #757575;
            }
            
            /* Links styling */
            .link {
                fill: none;
                stroke: #795548;
                stroke-width: 4px;
                stroke-linecap: round;
            }
            
            .link-marriage {
                fill: none;
                stroke: #795548;
                stroke-width: 3px;
                stroke-dasharray: 5, 5;
            }
            
            /* Silhouette styling */
            .male-silhouette path,
            .female-silhouette path,
            .couple-silhouette path {
                fill: #444;
                stroke: #212121;
                stroke-width: 0.5px;
            }
            
            /* Spouse divider */
            .spouse-divider {
                stroke: #757575;
                stroke-width: 1px;
                stroke-dasharray: 2, 2;
            }
            
            /* Text positioning */
            .text-content {
                text-anchor: middle;
            }
            .node text, .node tspan {
                text-anchor: middle;
            }
        `,i.insertBefore(d,i.firstChild);let f=document.createElement("link");f.setAttribute("href","https://fonts.googleapis.com/css2?family=Noto+Sans+Tamil&display=swap"),f.setAttribute("rel","stylesheet"),i.insertBefore(f,i.firstChild);let p=new XMLSerializer().serializeToString(i);p='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n'+p;let g=new Blob([p],{type:"image/svg+xml"}),m=URL.createObjectURL(g),y=document.createElement("a");y.href=m,y.download="family-tree.svg",document.body.appendChild(y),y.click(),setTimeout(()=>{document.body.removeChild(y),URL.revokeObjectURL(m),nQ("SVG export complete")},100)}catch(e){console.error("Error exporting SVG:",e)}}function n0(e,t=null){console.log(`[TreeRenderer] ${e}`),t&&console.log(t)}class n1{constructor(e,t,n){this.familyTree=e,this.container=t,this.config=n,this.svg=null,this.treeGroup=null,this.nodesGroup=null,this.linksGroup=null,this.treeBuilder=new nY(e,n),this.treeLayout=new nJ(n),this.nodeRenderer=new nK(n),this.linkRenderer=new nG(n),this.nodeWidth=220,this.nodeHeight=140,this.hierarchyData=null,this.root=null,n0(`Initialized renderer with ${e.individuals.length} individuals`)}render(){n0("Starting rendering"),this.createSvg(),this.hierarchyData=this.treeBuilder.buildHierarchy(),n0("Created hierarchy data",{nodes:this.hierarchyData.descendants().length}),this.root=this.treeLayout.applyLayout(this.hierarchyData),this.linkRenderer.createLinks(this.linksGroup,this.root),this.nodeRenderer.createNodes(this.nodesGroup,this.root.descendants(),this.treeLayout.isHorizontalOrientation()),this.linkRenderer.createMarriageLinks(this.linksGroup,this.root.descendants(),this.treeLayout.isHorizontalOrientation()),this.treeLayout.setupZoom(this.svg,this.treeGroup),this.resetView(),n0("Rendering complete")}createSvg(){eo(this.container).selectAll("svg").remove(),this.svg=eo(this.container).append("svg").attr("width",this.config.svgWidth).attr("height",this.config.svgHeight).attr("viewBox",`0 0 ${this.config.svgWidth} ${this.config.svgHeight}`).attr("class","family-tree-svg"),this.svg.append("defs").append("marker").attr("id","arrow").attr("viewBox","0 -5 10 10").attr("refX",8).attr("refY",0).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5").attr("class","arrow-head"),this.treeGroup=this.svg.append("g").attr("class","tree-group").attr("transform",`translate(${this.config.svgWidth/2}, 60)`),this.linksGroup=this.treeGroup.append("g").attr("class","links-group"),this.nodesGroup=this.treeGroup.append("g").attr("class","nodes-group")}resetView(){this.treeLayout.resetView(this.svg,this.treeGroup,this.root)}updateLanguage(e){this.config.language=e,this.render()}exportSVG(){nZ(this.svg,this.nodeWidth,this.nodeHeight)}}function n2(e,t,n=e=>e){let i=document.getElementById(e),r=document.getElementById(t);r||((r=document.createElement("span")).id=t,r.className="range-value",i.parentNode.insertBefore(r,i.nextSibling)),r.textContent=n(i.value),i.addEventListener("input",()=>{r.textContent=n(i.value)}),i.addEventListener("change",n5)}function n5(){try{let e={orientation:document.getElementById("orientation").value,nodeSize:parseFloat(document.getElementById("node-size").value),nodeSpacing:parseFloat(document.getElementById("node-spacing").value),colorScheme:document.getElementById("color-scheme").value,fontSize:parseInt(document.getElementById("font-size").value),lineStyle:document.getElementById("line-style").value,svgWidth:parseInt(document.getElementById("svg-width").value),svgHeight:parseInt(document.getElementById("svg-height").value)};localStorage.setItem("familyTreeConfig",JSON.stringify(e))}catch(e){console.warn("Failed to save configuration:",e)}}const n3=[{id:1,name:"Rajan Kumar",gender:"Male",spouse_name:"Priya Kumar",father_name:"Mohan Kumar",mother_name:"Lakshmi Kumar",birth_date:"1945-05-15",death_date:"2015-10-23",native_place:"Chennai",father_id:5,mother_id:6,spouse_id:2},{id:2,name:"Priya Kumar",gender:"Female",spouse_name:"Rajan Kumar",father_name:"Venkat Rao",mother_name:"Saraswati Rao",birth_date:"1948-09-30",death_date:null,native_place:"Madurai",father_id:7,mother_id:8,spouse_id:1},{id:3,name:"Arjun Kumar",gender:"Male",spouse_name:"Deepa Kumar",father_name:"Rajan Kumar",mother_name:"Priya Kumar",birth_date:"1970-03-22",death_date:null,native_place:"Chennai",father_id:1,mother_id:2,spouse_id:4},{id:4,name:"Deepa Kumar",gender:"Female",spouse_name:"Arjun Kumar",father_name:"Ramesh Sharma",mother_name:"Anita Sharma",birth_date:"1972-11-08",death_date:null,native_place:"Bangalore",father_id:9,mother_id:10,spouse_id:3},{id:5,name:"Mohan Kumar",gender:"Male",spouse_name:"Lakshmi Kumar",father_name:null,mother_name:null,birth_date:"1920-01-05",death_date:"1990-12-15",native_place:"Chennai",father_id:null,mother_id:null,spouse_id:6},{id:6,name:"Lakshmi Kumar",gender:"Female",spouse_name:"Mohan Kumar",father_name:null,mother_name:null,birth_date:"1925-04-20",death_date:"1995-08-10",native_place:"Chennai",father_id:null,mother_id:null,spouse_id:5},{id:7,name:"Venkat Rao",gender:"Male",spouse_name:"Saraswati Rao",father_name:null,mother_name:null,birth_date:"1922-07-12",death_date:"1992-03-18",native_place:"Madurai",father_id:null,mother_id:null,spouse_id:8},{id:8,name:"Saraswati Rao",gender:"Female",spouse_name:"Venkat Rao",father_name:null,mother_name:null,birth_date:"1926-11-30",death_date:"1998-05-22",native_place:"Madurai",father_id:null,mother_id:null,spouse_id:7},{id:9,name:"Ramesh Sharma",gender:"Male",spouse_name:"Anita Sharma",father_name:null,mother_name:null,birth_date:"1945-08-16",death_date:"2010-02-28",native_place:"Bangalore",father_id:null,mother_id:null,spouse_id:10},{id:10,name:"Anita Sharma",gender:"Female",spouse_name:"Ramesh Sharma",father_name:null,mother_name:null,birth_date:"1947-12-03",death_date:null,native_place:"Bangalore",father_id:null,mother_id:null,spouse_id:9},{id:11,name:"Vikram Kumar",gender:"Male",spouse_name:"Kavita Kumar",father_name:"Arjun Kumar",mother_name:"Deepa Kumar",birth_date:"1995-06-20",death_date:null,native_place:"Chennai",father_id:3,mother_id:4,spouse_id:12},{id:12,name:"Kavita Kumar",gender:"Female",spouse_name:"Vikram Kumar",father_name:"Dinesh Patel",mother_name:"Sunita Patel",birth_date:"1997-09-15",death_date:null,native_place:"Mumbai",father_id:null,mother_id:null,spouse_id:11},{id:13,name:"Meera Kumar",gender:"Female",spouse_name:null,father_name:"Arjun Kumar",mother_name:"Deepa Kumar",birth_date:"1998-04-12",death_date:null,native_place:"Chennai",father_id:3,mother_id:4,spouse_id:null},{id:14,name:"ராஜன் குமார்",gender:"ஆண்",spouse_name:"பிரியா குமார்",father_name:"மோகன் குமார்",mother_name:"லக்ஷ்மி குமார்",birth_date:"1945-05-15",death_date:"2015-10-23",native_place:"சென்னை",father_id:18,mother_id:19,spouse_id:15},{id:15,name:"பிரியா குமார்",gender:"பெண்",spouse_name:"ராஜன் குமார்",father_name:"வெங்கட் ராவ்",mother_name:"சரஸ்வதி ராவ்",birth_date:"1948-09-30",death_date:null,native_place:"மதுரை",father_id:20,mother_id:21,spouse_id:14},{id:16,name:"அர்ஜுன் குமார்",gender:"ஆண்",spouse_name:"தீபா குமார்",father_name:"ராஜன் குமார்",mother_name:"பிரியா குமார்",birth_date:"1970-03-22",death_date:null,native_place:"சென்னை",father_id:14,mother_id:15,spouse_id:17},{id:17,name:"தீபா குமார்",gender:"பெண்",spouse_name:"அர்ஜுன் குமார்",father_name:"ரமேஷ் சர்மா",mother_name:"அனிதா சர்மா",birth_date:"1972-11-08",death_date:null,native_place:"பெங்களூர்",father_id:null,mother_id:null,spouse_id:16},{id:18,name:"மோகன் குமார்",gender:"ஆண்",spouse_name:"லக்ஷ்மி குமார்",father_name:null,mother_name:null,birth_date:"1920-01-05",death_date:"1990-12-15",native_place:"சென்னை",father_id:null,mother_id:null,spouse_id:19},{id:19,name:"லக்ஷ்மி குமார்",gender:"பெண்",spouse_name:"மோகன் குமார்",father_name:null,mother_name:null,birth_date:"1925-04-20",death_date:"1995-08-10",native_place:"சென்னை",father_id:null,mother_id:null,spouse_id:18},{id:20,name:"வெங்கட் ராவ்",gender:"ஆண்",spouse_name:"சரஸ்வதி ராவ்",father_name:null,mother_name:null,birth_date:"1922-07-12",death_date:"1992-03-18",native_place:"மதுரை",father_id:null,mother_id:null,spouse_id:21},{id:21,name:"சரஸ்வதி ராவ்",gender:"பெண்",spouse_name:"வெங்கட் ராவ்",father_name:null,mother_name:null,birth_date:"1926-11-30",death_date:"1998-05-22",native_place:"மதுரை",father_id:null,mother_id:null,spouse_id:20}];function n4(e,t=null){console.log(`[App] ${e}`),t&&console.log(t)}const n8=document.getElementById("csv-file"),n9=document.getElementById("load-sample"),n6=document.getElementById("generate-tree"),n7=document.getElementById("export-svg"),ie=document.getElementById("reset-view"),it=document.getElementById("visualization-container"),ii=document.getElementById("person-selection"),ir=document.getElementById("root-person");let io=null,is=null,ia=null,il=null;async function iu(){n4("Initializing application"),function(){n4("Validating DOM elements");let e=[];if([{id:"csv-file",name:"CSV File Input"},{id:"load-sample",name:"Load Sample Button"},{id:"generate-tree",name:"Generate Tree Button"},{id:"export-svg",name:"Export SVG Button"},{id:"reset-view",name:"Reset View Button"},{id:"visualization-container",name:"Visualization Container"},{id:"person-selection",name:"Person Selection Container"},{id:"root-person",name:"Root Person Dropdown"}].forEach(t=>{document.getElementById(t.id)||(e.push(t.name),n4(`Missing DOM element: ${t.id}`))}),e.length>0){let t=`Some required DOM elements were not found: ${e.join(", ")}`;n4(t),console.error(t);try{iv(`Application initialization error: Missing DOM elements - ${e.join(", ")}`,"error")}catch(n){let e=document.createElement("div");e.style.backgroundColor="#ffebee",e.style.color="#c62828",e.style.padding="15px",e.style.margin="15px",e.style.border="1px solid #ef9a9a",e.style.borderRadius="4px",e.textContent=t,(document.querySelector(".container")||document.body).prepend(e)}return}n4("All required DOM elements found")}(),n2("node-size","node-size-value",e=>`${e}x`),n2("node-spacing","node-spacing-value",e=>`${e}x`),n2("font-size","font-size-value",e=>`${e}px`),document.getElementById("svg-width").addEventListener("change",n5),document.getElementById("svg-height").addEventListener("change",n5),document.getElementById("orientation").addEventListener("change",n5),document.getElementById("color-scheme").addEventListener("change",n5),document.getElementById("line-style").addEventListener("change",n5),function(){try{let t=localStorage.getItem("familyTreeConfig");if(t){var e;(e=JSON.parse(t)).orientation&&(document.getElementById("orientation").value=e.orientation),e.nodeSize&&(document.getElementById("node-size").value=e.nodeSize),e.nodeSpacing&&(document.getElementById("node-spacing").value=e.nodeSpacing),e.colorScheme&&(document.getElementById("color-scheme").value=e.colorScheme),e.fontSize&&(document.getElementById("font-size").value=e.fontSize),e.lineStyle&&(document.getElementById("line-style").value=e.lineStyle),e.svgWidth&&(document.getElementById("svg-width").value=e.svgWidth),e.svgHeight&&(document.getElementById("svg-height").value=e.svgHeight),document.getElementById("node-size-value").textContent=`${e.nodeSize}x`,document.getElementById("node-spacing-value").textContent=`${e.nodeSpacing}x`,document.getElementById("font-size-value").textContent=`${e.fontSize}px`}}catch(e){console.warn("Failed to load saved configuration:",e)}}(),n4("Setting up event listeners"),n8.addEventListener("change",ih),n9.addEventListener("click",ic),n6.addEventListener("click",ig),n7.addEventListener("click",im),ie.addEventListener("click",iy),ir.addEventListener("change",e=>{il=e.target.value,ig()}),n4("Application initialized successfully"),iv("Application initialized. Please load data or sample to begin.","info")}async function ih(e){n4("File upload initiated");let n=e.target.files[0];if(!n){n4("No file selected");return}n4("Processing file",{name:n.name,size:n.size,type:n.type});try{iv("Parsing CSV file...","info"),io=await function(e){u("Starting CSV parsing");try{let r=e instanceof File;if(u(`Input is ${r?"a File object":"a string"}`),r){var n;return n=e,u(`Parsing CSV file: ${n.name}`),new Promise((e,i)=>{t(l).parse(n,{header:!0,skipEmptyLines:!0,trimHeaders:!0,transform:e=>e.trim(),complete:function(t){try{if(u(`Papa parse complete with ${t.data.length} rows`),t.errors&&t.errors.length>0){u("CSV parsing errors found",t.errors);let e=t.errors.filter(e=>"FieldMismatch"!==e.type);if(e.length>0){i(Error(`CSV parsing error: ${e[0].message}`));return}u("Non-critical parsing errors found, proceeding with data")}h(t.meta.fields);let n=c(t.data);u(`Successfully parsed ${n.length} rows from CSV`),e(n)}catch(e){u("Error during CSV parsing",e),i(e)}},error:function(e){u("Error during CSV parsing",e),i(e)}})})}var i=e;u("Parsing CSV from string");try{let e=t(l).parse(i,{header:!0,skipEmptyLines:!0,trimHeaders:!0,transform:e=>e.trim()});if(e.errors&&e.errors.length>0){u("CSV parsing errors found",e.errors);let t=e.errors.filter(e=>"FieldMismatch"!==e.type);if(t.length>0)throw Error(`CSV parsing error: ${t[0].message}`)}h(e.meta.fields);let n=c(e.data);return u(`Successfully parsed ${n.length} rows from CSV string`),n}catch(e){throw u("Error parsing CSV string",e),e}return}catch(e){throw u("Error in parseCSV",e),e}}(n),n4("CSV data parsed successfully",{records:io.length}),iv(`Successfully loaded ${io.length} records from CSV file.`,"success"),ip(io),id()}catch(e){n4("Error parsing CSV file",e),iv("Error parsing CSV file: "+e.message,"error")}}function ic(){n4("Loading sample data");try{io=n3,n4("Sample data loaded successfully",{records:io.length}),iv(`Successfully loaded ${io.length} sample records.`,"success"),ip(io),id()}catch(e){n4("Error loading sample data",e),iv("Error loading sample data: "+e.message,"error")}}function id(){ir.options.length>1&&(ir.selectedIndex=1,(il=ir.value)&&(n4("Auto-selecting first person:",il),ig()))}function ip(e){n4("Populating person selection dropdown"),ir.innerHTML="";let t=document.createElement("option");t.value="",t.textContent="-- Select a person --",ir.appendChild(t);try{let t=f(e).individuals,n=new Map;t.forEach(e=>{n.set(e.id,e.generation)});let i={};e.forEach(e=>{let t=n.has(e.id)?n.get(e.id):999;i[t]||(i[t]=[]),i[t].push(e)}),Object.keys(i).map(Number).sort((e,t)=>e-t).forEach(e=>{let t=document.createElement("optgroup");t.label=`Generation ${e}`,i[e].sort((e,t)=>e.name.localeCompare(t.name)).forEach(e=>{let n=document.createElement("option");n.value=e.id;let i=e.name;e.birth_date&&(i+=` (${e.birth_date})`),n.textContent=i,t.appendChild(n)}),ir.appendChild(t)})}catch(t){n4("Error organizing dropdown by generations",t),[...e].sort((e,t)=>e.name.localeCompare(t.name)).forEach(e=>{let t=document.createElement("option");t.value=e.id;let n=e.name;e.birth_date&&(n+=` (${e.birth_date})`),t.textContent=n,ir.appendChild(t)})}ii.style.display="block",n4("Person selection dropdown populated")}function ig(){if(n4("Generate family tree requested"),!io||0===io.length){n4("No family data available"),iv("Please upload a CSV file or load sample data first.","error");return}if(!il){n4("No root person selected"),iv("Please select a person to view their family tree.","error");return}try{iv("Generating family tree...","info"),it.innerHTML="",n4("Visualization container cleared"),it.style.display="block",it.style.minHeight="500px",it.style.border="1px solid #ccc";let e={orientation:document.getElementById("orientation").value,nodeSize:parseFloat(document.getElementById("node-size").value),nodeSpacing:parseFloat(document.getElementById("node-spacing").value),colorScheme:document.getElementById("color-scheme").value,fontSize:parseInt(document.getElementById("font-size").value),lineStyle:document.getElementById("line-style").value,svgWidth:parseInt(document.getElementById("svg-width").value),svgHeight:parseInt(document.getElementById("svg-height").value),language:"en",rootPersonId:il,showOnlyDirectFamily:!1};n4("Using configuration",e),n4("Building family tree");try{is=f(io,il),n4("Family tree built successfully",{individuals:is.individuals.length,generations:is.generations})}catch(e){n4("Error building family tree",e),iv("Error building family tree: "+e.message,"error");return}n4("Rendering family tree");try{ia=function(e,t,n){if(n0("Starting tree rendering"),!e||!e.individuals||0===e.individuals.length)throw Error("Invalid family tree data provided");if(!t)throw Error("No container element provided for rendering");let i={orientation:"top-down",nodeSize:1.5,nodeSpacing:3.5,colorScheme:"gender",fontSize:14,lineStyle:"straight",svgWidth:2e3,svgHeight:1500,language:"en",rootPersonId:null,showOnlyDirectFamily:!0,...n};n0("Rendering with config",i);let r=new n1(e,t,i);try{r.render(),n0("Tree rendering complete")}catch(e){throw n0("Error during tree rendering",e),e}return r}(is,it,e),n4("Family tree rendered successfully"),iv("Family tree generated successfully.","success"),it.scrollIntoView({behavior:"smooth"})}catch(e){n4("Error rendering family tree",e),iv("Error rendering family tree: "+e.message,"error")}}catch(e){n4("Error generating family tree",e),iv("Error generating family tree: "+e.message,"error")}}function im(){if(!ia){alert("Please generate a family tree first.");return}try{console.log("Exporting SVG..."),nZ(ia.svg,ia.nodeWidth,ia.nodeHeight)}catch(e){console.error("Error exporting SVG:",e),alert("Error exporting SVG: "+e.message)}}function iy(){ia&&ia.resetView()}function iv(e,t="info"){let n=document.getElementById("status-container");n||((n=document.createElement("div")).id="status-container",n.style.marginTop="10px",n.style.padding="10px",n.style.borderRadius="4px",n.style.fontWeight="bold",document.querySelector(".input-section").appendChild(n)),n.textContent=e,"error"===t?(n.style.backgroundColor="#ffebee",n.style.color="#c62828",n.style.border="1px solid #ef9a9a"):"success"===t?(n.style.backgroundColor="#e8f5e9",n.style.color="#2e7d32",n.style.border="1px solid #a5d6a7"):(n.style.backgroundColor="#e3f2fd",n.style.color="#1565c0",n.style.border="1px solid #90caf9"),n.scrollIntoView({behavior:"smooth"})}document.addEventListener("DOMContentLoaded",function(){iu()});
//# sourceMappingURL=family-tree.681c4f06.js.map
