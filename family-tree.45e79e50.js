function t(t,e,n,i){Object.defineProperty(t,e,{get:n,set:i,enumerable:!0,configurable:!0})}function e(t){return t&&t.__esModule?t.default:t}var n,i=globalThis,r={},o={},s=i.parcelRequirea7a4;null==s&&((s=function(t){if(t in r)return r[t].exports;if(t in o){var e=o[t];delete o[t];var n={id:t,exports:{}};return r[t]=n,e.call(n.exports,n,n.exports),n.exports}var i=Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(t,e){o[t]=e},i.parcelRequirea7a4=s);var a=s.register;a("bYoiY",function(e,n){t(e.exports,"Color",()=>r),t(e.exports,"darker",()=>o),t(e.exports,"brighter",()=>a),t(e.exports,"default",()=>b),t(e.exports,"hslConvert",()=>P),t(e.exports,"Rgb",()=>$),t(e.exports,"rgbConvert",()=>S),t(e.exports,"rgb",()=>E),t(e.exports,"hsl",()=>N);var i=s("bfWFq");function r(){}var o=.7,a=1.4285714285714286,l="\\s*([+-]?\\d+)\\s*",h="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",u="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",c=/^#([0-9a-f]{3,8})$/,d=RegExp(`^rgb\\(${l},${l},${l}\\)$`),f=RegExp(`^rgb\\(${u},${u},${u}\\)$`),p=RegExp(`^rgba\\(${l},${l},${l},${h}\\)$`),g=RegExp(`^rgba\\(${u},${u},${u},${h}\\)$`),m=RegExp(`^hsl\\(${h},${u},${u}\\)$`),y=RegExp(`^hsla\\(${h},${u},${u},${h}\\)$`),v={aliceblue:0xf0f8ff,antiquewhite:0xfaebd7,aqua:65535,aquamarine:8388564,azure:0xf0ffff,beige:0xf5f5dc,bisque:0xffe4c4,black:0,blanchedalmond:0xffebcd,blue:255,blueviolet:9055202,brown:0xa52a2a,burlywood:0xdeb887,cadetblue:6266528,chartreuse:8388352,chocolate:0xd2691e,coral:0xff7f50,cornflowerblue:6591981,cornsilk:0xfff8dc,crimson:0xdc143c,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:0xb8860b,darkgray:0xa9a9a9,darkgreen:25600,darkgrey:0xa9a9a9,darkkhaki:0xbdb76b,darkmagenta:9109643,darkolivegreen:5597999,darkorange:0xff8c00,darkorchid:0x9932cc,darkred:9109504,darksalmon:0xe9967a,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:0xff1493,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:0xb22222,floralwhite:0xfffaf0,forestgreen:2263842,fuchsia:0xff00ff,gainsboro:0xdcdcdc,ghostwhite:0xf8f8ff,gold:0xffd700,goldenrod:0xdaa520,gray:8421504,green:32768,greenyellow:0xadff2f,grey:8421504,honeydew:0xf0fff0,hotpink:0xff69b4,indianred:0xcd5c5c,indigo:4915330,ivory:0xfffff0,khaki:0xf0e68c,lavender:0xe6e6fa,lavenderblush:0xfff0f5,lawngreen:8190976,lemonchiffon:0xfffacd,lightblue:0xadd8e6,lightcoral:0xf08080,lightcyan:0xe0ffff,lightgoldenrodyellow:0xfafad2,lightgray:0xd3d3d3,lightgreen:9498256,lightgrey:0xd3d3d3,lightpink:0xffb6c1,lightsalmon:0xffa07a,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:0xb0c4de,lightyellow:0xffffe0,lime:65280,limegreen:3329330,linen:0xfaf0e6,magenta:0xff00ff,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:0xba55d3,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:0xc71585,midnightblue:1644912,mintcream:0xf5fffa,mistyrose:0xffe4e1,moccasin:0xffe4b5,navajowhite:0xffdead,navy:128,oldlace:0xfdf5e6,olive:8421376,olivedrab:7048739,orange:0xffa500,orangered:0xff4500,orchid:0xda70d6,palegoldenrod:0xeee8aa,palegreen:0x98fb98,paleturquoise:0xafeeee,palevioletred:0xdb7093,papayawhip:0xffefd5,peachpuff:0xffdab9,peru:0xcd853f,pink:0xffc0cb,plum:0xdda0dd,powderblue:0xb0e0e6,purple:8388736,rebeccapurple:6697881,red:0xff0000,rosybrown:0xbc8f8f,royalblue:4286945,saddlebrown:9127187,salmon:0xfa8072,sandybrown:0xf4a460,seagreen:3050327,seashell:0xfff5ee,sienna:0xa0522d,silver:0xc0c0c0,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:0xfffafa,springgreen:65407,steelblue:4620980,tan:0xd2b48c,teal:32896,thistle:0xd8bfd8,tomato:0xff6347,turquoise:4251856,violet:0xee82ee,wheat:0xf5deb3,white:0xffffff,whitesmoke:0xf5f5f5,yellow:0xffff00,yellowgreen:0x9acd32};function x(){return this.rgb().formatHex()}function _(){return this.rgb().formatRgb()}function b(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=c.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?w(e):3===n?new $(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?k(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?k(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=d.exec(t))?new $(e[1],e[2],e[3],1):(e=f.exec(t))?new $(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=p.exec(t))?k(e[1],e[2],e[3],e[4]):(e=g.exec(t))?k(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=m.exec(t))?T(e[1],e[2]/100,e[3]/100,1):(e=y.exec(t))?T(e[1],e[2]/100,e[3]/100,e[4]):v.hasOwnProperty(t)?w(v[t]):"transparent"===t?new $(NaN,NaN,NaN,0):null}function w(t){return new $(t>>16&255,t>>8&255,255&t,1)}function k(t,e,n,i){return i<=0&&(t=e=n=NaN),new $(t,e,n,i)}function S(t){return(t instanceof r||(t=b(t)),t)?new $((t=t.rgb()).r,t.g,t.b,t.opacity):new $}function E(t,e,n,i){return 1==arguments.length?S(t):new $(t,e,n,null==i?1:i)}function $(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}function C(){return`#${A(this.r)}${A(this.g)}${A(this.b)}`}function O(){let t=L(this.opacity);return`${1===t?"rgb(":"rgba("}${R(this.r)}, ${R(this.g)}, ${R(this.b)}${1===t?")":`, ${t})`}`}function L(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function R(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function A(t){return((t=R(t))<16?"0":"")+t.toString(16)}function T(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new M(t,e,n,i)}function P(t){if(t instanceof M)return new M(t.h,t.s,t.l,t.opacity);if(t instanceof r||(t=b(t)),!t)return new M;if(t instanceof M)return t;var e=(t=t.rgb()).r/255,n=t.g/255,i=t.b/255,o=Math.min(e,n,i),s=Math.max(e,n,i),a=NaN,l=s-o,h=(s+o)/2;return l?(a=e===s?(n-i)/l+(n<i)*6:n===s?(i-e)/l+2:(e-n)/l+4,l/=h<.5?s+o:2-s-o,a*=60):l=h>0&&h<1?0:a,new M(a,l,h,t.opacity)}function N(t,e,n,i){return 1==arguments.length?P(t):new M(t,e,n,null==i?1:i)}function M(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}function I(t){return(t=(t||0)%360)<0?t+360:t}function z(t){return Math.max(0,Math.min(1,t||0))}function F(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}(0,i.default)(r,b,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:x,formatHex:x,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return P(this).formatHsl()},formatRgb:_,toString:_}),(0,i.default)($,E,(0,i.extend)(r,{brighter(t){return t=null==t?a:Math.pow(a,t),new $(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?o:Math.pow(o,t),new $(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new $(R(this.r),R(this.g),R(this.b),L(this.opacity))},displayable(){return -.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:C,formatHex:C,formatHex8:function(){return`#${A(this.r)}${A(this.g)}${A(this.b)}${A((isNaN(this.opacity)?1:this.opacity)*255)}`},formatRgb:O,toString:O})),(0,i.default)(M,N,(0,i.extend)(r,{brighter(t){return t=null==t?a:Math.pow(a,t),new M(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?o:Math.pow(o,t),new M(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new $(F(t>=240?t-240:t+120,r,i),F(t,r,i),F(t<120?t+240:t-120,r,i),this.opacity)},clamp(){return new M(I(this.h),z(this.s),z(this.l),L(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let t=L(this.opacity);return`${1===t?"hsl(":"hsla("}${I(this.h)}, ${100*z(this.s)}%, ${100*z(this.l)}%${1===t?")":`, ${t})`}`}}))}),a("bfWFq",function(e,n){function i(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function r(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}t(e.exports,"default",()=>i),t(e.exports,"extend",()=>r)}),a("hkR60",function(t,e){t.exports=import("6wkRR").then(()=>s("lUp03"))}),a("2C5f3",function(t,e){t.exports=import("1BmZ9").then(()=>s("1S7aa"))}),a("663DU",function(t,e){t.exports=import("l0ejr").then(()=>s("7JB23"))});var l={};function h(t,e=null){console.log(`[CSVParser] ${t}`),e&&console.log(e)}function u(t){h("Starting CSV parsing");try{let r=t instanceof File;if(h(`Input is ${r?"a File object":"a string"}`),r){var n;return n=t,h(`Parsing CSV file: ${n.name}`),new Promise((t,i)=>{e(l).parse(n,{header:!0,skipEmptyLines:!0,trimHeaders:!0,transform:t=>t.trim(),complete:function(e){try{if(h(`Papa parse complete with ${e.data.length} rows`),e.errors&&e.errors.length>0){h("CSV parsing errors found",e.errors);let t=e.errors.filter(t=>"FieldMismatch"!==t.type);if(t.length>0){i(Error(`CSV parsing error: ${t[0].message}`));return}h("Non-critical parsing errors found, proceeding with data")}c(e.meta.fields);let n=d(e.data);h(`Successfully parsed ${n.length} rows from CSV`),t(n)}catch(t){h("Error during CSV parsing",t),i(t)}},error:function(t){h("Error during CSV parsing",t),i(t)}})})}var i=t;h("Parsing CSV from string");try{let t=e(l).parse(i,{header:!0,skipEmptyLines:!0,trimHeaders:!0,transform:t=>t.trim()});if(t.errors&&t.errors.length>0){h("CSV parsing errors found",t.errors);let e=t.errors.filter(t=>"FieldMismatch"!==t.type);if(e.length>0)throw Error(`CSV parsing error: ${e[0].message}`)}c(t.meta.fields);let n=d(t.data);return h(`Successfully parsed ${n.length} rows from CSV string`),n}catch(t){throw h("Error parsing CSV string",t),t}return}catch(t){throw h("Error in parseCSV",t),t}}function c(t){h("Validating CSV fields",t);let e=["id","name","gender"].filter(e=>!t.includes(e));if(e.length>0)throw Error(`Missing required fields: ${e.join(", ")}`);h("All required fields present")}function d(t){h(`Processing ${t.length} rows of CSV data`);let e=t.map(t=>{try{return{id:t.id,name:t.name.trim(),gender:t.gender.trim(),spouse_name:t.spouse_name?t.spouse_name.trim():null,father_name:t.father_name?t.father_name.trim():null,mother_name:t.mother_name?t.mother_name.trim():null,birth_date:t.birth_date?t.birth_date.trim():null,death_date:t.death_date?t.death_date.trim():null,native_place:t.native_place?t.native_place.trim():null,father_id:t.father_id?t.father_id.trim():null,mother_id:t.mother_id?t.mother_id.trim():null,spouse_id:t.spouse_id?t.spouse_id.trim():null}}catch(e){throw h("Error processing row",{row:t,error:e}),Error(`Error processing row with ID ${t.id||"unknown"}: ${e.message}`)}});return h(`Successfully processed ${e.length} rows`),e}function f(t,e=null){console.log(`[FamilyTreeBuilder] ${t}`),e&&console.log(e)}tv=function t(){var e,n="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n?n:{},i=!n.document&&!!n.postMessage,r=n.IS_PAPA_WORKER||!1,o={},s=0,a={};function l(t){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(t){var e=x(t);e.chunkSize=parseInt(e.chunkSize),t.step||t.chunk||(e.chunkSize=null),this._handle=new f(e),(this._handle.streamer=this)._config=e}).call(this,t),this.parseChunk=function(t,e){var i=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<i){let e=this._config.newline;e||(o=this._config.quoteChar||'"',e=this._handle.guessLineEndings(t,o)),t=[...t.split(e).slice(i)].join(e)}this.isFirstChunk&&b(this._config.beforeFirstChunk)&&void 0!==(o=this._config.beforeFirstChunk(t))&&(t=o),this.isFirstChunk=!1,this._halted=!1;var i=this._partialLine+t,o=(this._partialLine="",this._handle.parse(i,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(t=o.meta.cursor,this._finished||(this._partialLine=i.substring(t-this._baseIndex),this._baseIndex=t),o&&o.data&&(this._rowCount+=o.data.length),i=this._finished||this._config.preview&&this._rowCount>=this._config.preview,r)n.postMessage({results:o,workerId:a.WORKER_ID,finished:i});else if(b(this._config.chunk)&&!e){if(this._config.chunk(o,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=o=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(o.data),this._completeResults.errors=this._completeResults.errors.concat(o.errors),this._completeResults.meta=o.meta),this._completed||!i||!b(this._config.complete)||o&&o.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),i||o&&o.meta.paused||this._nextChunk(),o}this._halted=!0},this._sendError=function(t){b(this._config.error)?this._config.error(t):r&&this._config.error&&n.postMessage({workerId:a.WORKER_ID,error:t,finished:!1})}}function h(t){var e;(t=t||{}).chunkSize||(t.chunkSize=a.RemoteChunkSize),l.call(this,t),this._nextChunk=i?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(t){this._input=t,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(e=new XMLHttpRequest,this._config.withCredentials&&(e.withCredentials=this._config.withCredentials),i||(e.onload=_(this._chunkLoaded,this),e.onerror=_(this._chunkError,this)),e.open(this._config.downloadRequestBody?"POST":"GET",this._input,!i),this._config.downloadRequestHeaders){var t,n,r=this._config.downloadRequestHeaders;for(n in r)e.setRequestHeader(n,r[n])}this._config.chunkSize&&(t=this._start+this._config.chunkSize-1,e.setRequestHeader("Range","bytes="+this._start+"-"+t));try{e.send(this._config.downloadRequestBody)}catch(t){this._chunkError(t.message)}i&&0===e.status&&this._chunkError()}},this._chunkLoaded=function(){let t;4===e.readyState&&(e.status<200||400<=e.status?this._chunkError():(this._start+=this._config.chunkSize||e.responseText.length,this._finished=!this._config.chunkSize||this._start>=(null!==(t=(t=e).getResponseHeader("Content-Range"))?parseInt(t.substring(t.lastIndexOf("/")+1)):-1),this.parseChunk(e.responseText)))},this._chunkError=function(t){t=e.statusText||t,this._sendError(Error(t))}}function u(t){(t=t||{}).chunkSize||(t.chunkSize=a.LocalChunkSize),l.call(this,t);var e,n,i="undefined"!=typeof FileReader;this.stream=function(t){this._input=t,n=t.slice||t.webkitSlice||t.mozSlice,i?((e=new FileReader).onload=_(this._chunkLoaded,this),e.onerror=_(this._chunkError,this)):e=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var t=this._input,r=(this._config.chunkSize&&(r=Math.min(this._start+this._config.chunkSize,this._input.size),t=n.call(t,this._start,r)),e.readAsText(t,this._config.encoding));i||this._chunkLoaded({target:{result:r}})},this._chunkLoaded=function(t){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(t.target.result)},this._chunkError=function(){this._sendError(e.error)}}function c(t){var e;l.call(this,t=t||{}),this.stream=function(t){return e=t,this._nextChunk()},this._nextChunk=function(){var t,n;if(!this._finished)return e=(t=this._config.chunkSize)?(n=e.substring(0,t),e.substring(t)):(n=e,""),this._finished=!e,this.parseChunk(n)}}function d(t){l.call(this,t=t||{});var e=[],n=!0,i=!1;this.pause=function(){l.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){l.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(t){this._input=t,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){i&&1===e.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),e.length?this.parseChunk(e.shift()):n=!0},this._streamData=_(function(t){try{e.push("string"==typeof t?t:t.toString(this._config.encoding)),n&&(n=!1,this._checkIsFinished(),this.parseChunk(e.shift()))}catch(t){this._streamError(t)}},this),this._streamError=_(function(t){this._streamCleanUp(),this._sendError(t)},this),this._streamEnd=_(function(){this._streamCleanUp(),i=!0,this._streamData("")},this),this._streamCleanUp=_(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function f(t){var e,n,i,r,o=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,s=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,l=this,h=0,u=0,c=!1,d=!1,f=[],m={data:[],errors:[],meta:{}};function y(e){return"greedy"===t.skipEmptyLines?""===e.join("").trim():1===e.length&&0===e[0].length}function v(){if(m&&i&&(w("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+a.DefaultDelimiter+"'"),i=!1),t.skipEmptyLines&&(m.data=m.data.filter(function(t){return!y(t)})),_()){if(m)if(Array.isArray(m.data[0])){for(var e,n=0;_()&&n<m.data.length;n++)m.data[n].forEach(r);m.data.splice(0,1)}else m.data.forEach(r);function r(e,n){b(t.transformHeader)&&(e=t.transformHeader(e,n)),f.push(e)}}function l(e,n){for(var i=t.header?{}:[],r=0;r<e.length;r++){var a=r,l=e[r],l=((e,n)=>(t.dynamicTypingFunction&&void 0===t.dynamicTyping[e]&&(t.dynamicTyping[e]=t.dynamicTypingFunction(e)),!0===(t.dynamicTyping[e]||t.dynamicTyping))?"true"===n||"TRUE"===n||"false"!==n&&"FALSE"!==n&&((t=>{if(o.test(t)&&-0x20000000000000<(t=parseFloat(t))&&t<0x20000000000000)return 1})(n)?parseFloat(n):s.test(n)?new Date(n):""===n?null:n):n)(a=t.header?r>=f.length?"__parsed_extra":f[r]:a,l=t.transform?t.transform(l,a):l);"__parsed_extra"===a?(i[a]=i[a]||[],i[a].push(l)):i[a]=l}return t.header&&(r>f.length?w("FieldMismatch","TooManyFields","Too many fields: expected "+f.length+" fields but parsed "+r,u+n):r<f.length&&w("FieldMismatch","TooFewFields","Too few fields: expected "+f.length+" fields but parsed "+r,u+n)),i}m&&(t.header||t.dynamicTyping||t.transform)&&(e=1,!m.data.length||Array.isArray(m.data[0])?(m.data=m.data.map(l),e=m.data.length):m.data=l(m.data,0),t.header&&m.meta&&(m.meta.fields=f),u+=e)}function _(){return t.header&&0===f.length}function w(t,e,n,i){t={type:t,code:e,message:n},void 0!==i&&(t.row=i),m.errors.push(t)}b(t.step)&&(r=t.step,t.step=function(e){m=e,_()?v():(v(),0!==m.data.length&&(h+=e.data.length,t.preview&&h>t.preview?n.abort():(m.data=m.data[0],r(m,l))))}),this.parse=function(r,o,s){var l=t.quoteChar||'"',l=(t.newline||(t.newline=this.guessLineEndings(r,l)),i=!1,t.delimiter?b(t.delimiter)&&(t.delimiter=t.delimiter(r),m.meta.delimiter=t.delimiter):((l=((e,n,i,r,o)=>{var s,l,h,u;o=o||[",","	","|",";",a.RECORD_SEP,a.UNIT_SEP];for(var c=0;c<o.length;c++){for(var d,f=o[c],p=0,m=0,v=0,x=(h=void 0,new g({comments:r,delimiter:f,newline:n,preview:10}).parse(e)),_=0;_<x.data.length;_++)i&&y(x.data[_])?v++:(m+=d=x.data[_].length,void 0===h?h=d:0<d&&(p+=Math.abs(d-h),h=d));0<x.data.length&&(m/=x.data.length-v),(void 0===l||p<=l)&&(void 0===u||u<m)&&1.99<m&&(l=p,s=f,u=m)}return{successful:!!(t.delimiter=s),bestDelimiter:s}})(r,t.newline,t.skipEmptyLines,t.comments,t.delimitersToGuess)).successful?t.delimiter=l.bestDelimiter:(i=!0,t.delimiter=a.DefaultDelimiter),m.meta.delimiter=t.delimiter),x(t));return t.preview&&t.header&&l.preview++,e=r,m=(n=new g(l)).parse(e,o,s),v(),c?{meta:{paused:!0}}:m||{meta:{paused:!1}}},this.paused=function(){return c},this.pause=function(){c=!0,n.abort(),e=b(t.chunk)?"":e.substring(n.getCharIndex())},this.resume=function(){l.streamer._halted?(c=!1,l.streamer.parseChunk(e,!0)):setTimeout(l.resume,3)},this.aborted=function(){return d},this.abort=function(){d=!0,n.abort(),m.meta.aborted=!0,b(t.complete)&&t.complete(m),e=""},this.guessLineEndings=function(t,e){t=t.substring(0,1048576);var e=RegExp(p(e)+"([^]*?)"+p(e),"gm"),n=(t=t.replace(e,"")).split("\r"),e=t.split("\n"),t=1<e.length&&e[0].length<n[0].length;if(1===n.length||t)return"\n";for(var i=0,r=0;r<n.length;r++)"\n"===n[r][0]&&i++;return i>=n.length/2?"\r\n":"\r"}}function p(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function g(t){var e=(t=t||{}).delimiter,n=t.newline,i=t.comments,r=t.step,o=t.preview,s=t.fastMode,l=null,h=!1,u=null==t.quoteChar?'"':t.quoteChar,c=u;if(void 0!==t.escapeChar&&(c=t.escapeChar),("string"!=typeof e||-1<a.BAD_DELIMITERS.indexOf(e))&&(e=","),i===e)throw Error("Comment character same as delimiter");!0===i?i="#":("string"!=typeof i||-1<a.BAD_DELIMITERS.indexOf(i))&&(i=!1),"\n"!==n&&"\r"!==n&&"\r\n"!==n&&(n="\n");var d=0,f=!1;this.parse=function(a,g,m){if("string"!=typeof a)throw Error("Input must be a string");var y=a.length,v=e.length,x=n.length,_=i.length,w=b(r),k=[],S=[],E=[],$=d=0;if(!a)return F();if(s||!1!==s&&-1===a.indexOf(u)){for(var C=a.split(n),O=0;O<C.length;O++){if(E=C[O],d+=E.length,O!==C.length-1)d+=n.length;else if(m)break;if(!i||E.substring(0,_)!==i){if(w){if(k=[],N(E.split(e)),D(),f)return F()}else N(E.split(e));if(o&&o<=O)return k=k.slice(0,o),F(!0)}}return F()}for(var L=a.indexOf(e,d),R=a.indexOf(n,d),A=RegExp(p(c)+p(u),"g"),T=a.indexOf(u,d);;)if(a[d]===u)for(T=d,d++;;){if(-1===(T=a.indexOf(u,T+1)))return m||S.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:k.length,index:d}),I();if(T===y-1)return I(a.substring(d,T).replace(A,u));if(u===c&&a[T+1]===c)T++;else if(u===c||0===T||a[T-1]!==c){-1!==L&&L<T+1&&(L=a.indexOf(e,T+1));var P=M(-1===(R=-1!==R&&R<T+1?a.indexOf(n,T+1):R)?L:Math.min(L,R));if(a.substr(T+1+P,v)===e){E.push(a.substring(d,T).replace(A,u)),a[d=T+1+P+v]!==u&&(T=a.indexOf(u,d)),L=a.indexOf(e,d),R=a.indexOf(n,d);break}if(P=M(R),a.substring(T+1+P,T+1+P+x)===n){if(E.push(a.substring(d,T).replace(A,u)),z(T+1+P+x),L=a.indexOf(e,d),T=a.indexOf(u,d),w&&(D(),f))return F();if(o&&k.length>=o)return F(!0);break}S.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:k.length,index:d}),T++}}else if(i&&0===E.length&&a.substring(d,d+_)===i){if(-1===R)return F();d=R+x,R=a.indexOf(n,d),L=a.indexOf(e,d)}else if(-1!==L&&(L<R||-1===R))E.push(a.substring(d,L)),d=L+v,L=a.indexOf(e,d);else{if(-1===R)break;if(E.push(a.substring(d,R)),z(R+x),w&&(D(),f))return F();if(o&&k.length>=o)return F(!0)}return I();function N(t){k.push(t),$=d}function M(t){return -1!==t&&(t=a.substring(T+1,t))&&""===t.trim()?t.length:0}function I(t){return m||(void 0===t&&(t=a.substring(d)),E.push(t),d=y,N(E),w&&D()),F()}function z(t){d=t,N(E),E=[],R=a.indexOf(n,d)}function F(i){if(t.header&&!g&&k.length&&!h){var r=k[0],o={},s=new Set(r);let e=!1;for(let n=0;n<r.length;n++){let i=r[n];if(o[i=b(t.transformHeader)?t.transformHeader(i,n):i]){let t,a=o[i];for(;t=i+"_"+a,a++,s.has(t););s.add(t),r[n]=t,o[i]++,e=!0,(l=null===l?{}:l)[t]=i}else o[i]=1,r[n]=i;s.add(i)}e&&console.warn("Duplicate headers found and renamed."),h=!0}return{data:k,errors:S,meta:{delimiter:e,linebreak:n,aborted:f,truncated:!!i,cursor:$+(g||0),renamedHeaders:l}}}function D(){r(F()),k=[],S=[]}},this.abort=function(){f=!0},this.getCharIndex=function(){return d}}function m(t){var e=t.data,n=o[e.workerId],i=!1;if(e.error)n.userError(e.error,e.file);else if(e.results&&e.results.data){var r={abort:function(){i=!0,y(e.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:v,resume:v};if(b(n.userStep)){for(var s=0;s<e.results.data.length&&(n.userStep({data:e.results.data[s],errors:e.results.errors,meta:e.results.meta},r),!i);s++);delete e.results}else b(n.userChunk)&&(n.userChunk(e.results,r,e.file),delete e.results)}e.finished&&!i&&y(e.workerId,e.results)}function y(t,e){var n=o[t];b(n.userComplete)&&n.userComplete(e),n.terminate(),delete o[t]}function v(){throw Error("Not implemented.")}function x(t){if("object"!=typeof t||null===t)return t;var e,n=Array.isArray(t)?[]:{};for(e in t)n[e]=x(t[e]);return n}function _(t,e){return function(){t.apply(e,arguments)}}function b(t){return"function"==typeof t}return a.parse=function(e,i){var r,l,f,p=(i=i||{}).dynamicTyping||!1;if(b(p)&&(i.dynamicTypingFunction=p,p={}),i.dynamicTyping=p,i.transform=!!b(i.transform)&&i.transform,!i.worker||!a.WORKERS_SUPPORTED){let t;return p=null,a.NODE_STREAM_INPUT,"string"==typeof e?(e=65279!==(t=e).charCodeAt(0)?t:t.slice(1),p=new(i.download?h:c)(i)):!0===e.readable&&b(e.read)&&b(e.on)?p=new d(i):(n.File&&e instanceof File||e instanceof Object)&&(p=new u(i)),p.stream(e)}(p=!!a.WORKERS_SUPPORTED&&(l=n.URL||n.webkitURL||null,f=t.toString(),r=a.BLOB_URL||(a.BLOB_URL=l.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",f,")();"],{type:"text/javascript"}))),(r=new n.Worker(r)).onmessage=m,r.id=s++,o[r.id]=r)).userStep=i.step,p.userChunk=i.chunk,p.userComplete=i.complete,p.userError=i.error,i.step=b(i.step),i.chunk=b(i.chunk),i.complete=b(i.complete),i.error=b(i.error),delete i.worker,p.postMessage({input:e,config:i,workerId:p.id})},a.unparse=function(t,e){var n=!1,i=!0,r=",",o="\r\n",s='"',l=s+s,h=!1,u=null,c=!1,d=((()=>{if("object"==typeof e){if("string"!=typeof e.delimiter||a.BAD_DELIMITERS.filter(function(t){return -1!==e.delimiter.indexOf(t)}).length||(r=e.delimiter),("boolean"==typeof e.quotes||"function"==typeof e.quotes||Array.isArray(e.quotes))&&(n=e.quotes),"boolean"!=typeof e.skipEmptyLines&&"string"!=typeof e.skipEmptyLines||(h=e.skipEmptyLines),"string"==typeof e.newline&&(o=e.newline),"string"==typeof e.quoteChar&&(s=e.quoteChar),"boolean"==typeof e.header&&(i=e.header),Array.isArray(e.columns)){if(0===e.columns.length)throw Error("Option columns is empty");u=e.columns}void 0!==e.escapeChar&&(l=e.escapeChar+s),e.escapeFormulae instanceof RegExp?c=e.escapeFormulae:"boolean"==typeof e.escapeFormulae&&e.escapeFormulae&&(c=/^[=+\-@\t\r].*$/)}})(),RegExp(p(s),"g"));if("string"==typeof t&&(t=JSON.parse(t)),Array.isArray(t)){if(!t.length||Array.isArray(t[0]))return f(null,t,h);if("object"==typeof t[0])return f(u||Object.keys(t[0]),t,h)}else if("object"==typeof t)return"string"==typeof t.data&&(t.data=JSON.parse(t.data)),Array.isArray(t.data)&&(t.fields||(t.fields=t.meta&&t.meta.fields||u),t.fields||(t.fields=Array.isArray(t.data[0])?t.fields:"object"==typeof t.data[0]?Object.keys(t.data[0]):[]),Array.isArray(t.data[0])||"object"==typeof t.data[0]||(t.data=[t.data])),f(t.fields||[],t.data||[],h);throw Error("Unable to serialize unrecognized input");function f(t,e,n){var s="",a=("string"==typeof t&&(t=JSON.parse(t)),"string"==typeof e&&(e=JSON.parse(e)),Array.isArray(t)&&0<t.length),l=!Array.isArray(e[0]);if(a&&i){for(var h=0;h<t.length;h++)0<h&&(s+=r),s+=g(t[h],h);0<e.length&&(s+=o)}for(var u=0;u<e.length;u++){var c=(a?t:e[u]).length,d=!1,f=a?0===Object.keys(e[u]).length:0===e[u].length;if(n&&!a&&(d="greedy"===n?""===e[u].join("").trim():1===e[u].length&&0===e[u][0].length),"greedy"===n&&a){for(var p=[],m=0;m<c;m++){var y=l?t[m]:m;p.push(e[u][y])}d=""===p.join("").trim()}if(!d){for(var v=0;v<c;v++){0<v&&!f&&(s+=r);var x=a&&l?t[v]:v;s+=g(e[u][x],v)}u<e.length-1&&(!n||0<c&&!f)&&(s+=o)}}return s}function g(t,e){var i,o;return null==t?"":t.constructor===Date?JSON.stringify(t).slice(1,25):(o=!1,c&&"string"==typeof t&&c.test(t)&&(t="'"+t,o=!0),i=t.toString().replace(d,l),(o=o||!0===n||"function"==typeof n&&n(t,e)||Array.isArray(n)&&n[e]||((t,e)=>{for(var n=0;n<e.length;n++)if(-1<t.indexOf(e[n]))return!0;return!1})(i,a.BAD_DELIMITERS)||-1<i.indexOf(r)||" "===i.charAt(0)||" "===i.charAt(i.length-1))?s+i+s:i)}},a.RECORD_SEP="\x1e",a.UNIT_SEP="\x1f",a.BYTE_ORDER_MARK="\uFEFF",a.BAD_DELIMITERS=["\r","\n",'"',a.BYTE_ORDER_MARK],a.WORKERS_SUPPORTED=!i&&!!n.Worker,a.NODE_STREAM_INPUT=1,a.LocalChunkSize=0xa00000,a.RemoteChunkSize=5242880,a.DefaultDelimiter=",",a.Parser=g,a.ParserHandle=f,a.NetworkStreamer=h,a.FileStreamer=u,a.StringStreamer=c,a.ReadableStreamStreamer=d,n.jQuery&&((e=n.jQuery).fn.parse=function(t){var i=t.config||{},r=[];return this.each(function(t){if(!("INPUT"===e(this).prop("tagName").toUpperCase()&&"file"===e(this).attr("type").toLowerCase()&&n.FileReader)||!this.files||0===this.files.length)return!0;for(var o=0;o<this.files.length;o++)r.push({file:this.files[o],inputElem:this,instanceConfig:e.extend({},i)})}),o(),this;function o(){if(0===r.length)b(t.complete)&&t.complete();else{var n,i,o,l=r[0];if(b(t.before)){var h=t.before(l.file,l.inputElem);if("object"==typeof h){if("abort"===h.action)return n=l.file,i=l.inputElem,o=h.reason,void(b(t.error)&&t.error({name:"AbortError"},n,i,o));if("skip"===h.action)return void s();"object"==typeof h.config&&(l.instanceConfig=e.extend(l.instanceConfig,h.config))}else if("skip"===h)return void s()}var u=l.instanceConfig.complete;l.instanceConfig.complete=function(t){b(u)&&u(t,l.file,l.inputElem),s()},a.parse(l.file,l.instanceConfig)}}function s(){r.splice(0,1),o()}}),r&&(n.onmessage=function(t){t=t.data,void 0===a.WORKER_ID&&t&&(a.WORKER_ID=t.workerId),"string"==typeof t.input?n.postMessage({workerId:a.WORKER_ID,results:a.parse(t.input,t.config),finished:!0}):(n.File&&t.input instanceof File||t.input instanceof Object)&&(t=a.parse(t.input,t.config))&&n.postMessage({workerId:a.WORKER_ID,results:t,finished:!0})}),(h.prototype=Object.create(l.prototype)).constructor=h,(u.prototype=Object.create(l.prototype)).constructor=u,(c.prototype=Object.create(c.prototype)).constructor=c,(d.prototype=Object.create(l.prototype)).constructor=d,a},"function"==typeof define&&define.amd?define([],tv):l=tv();var p={value:()=>{}};function g(){for(var t,e=0,n=arguments.length,i={};e<n;++e){if(!(t=arguments[e]+"")||t in i||/[\s.]/.test(t))throw Error("illegal type: "+t);i[t]=[]}return new m(i)}function m(t){this._=t}function y(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=p,t=t.slice(0,i).concat(t.slice(i+1));break}return null!=n&&t.push({name:e,value:n}),t}function v(){}function x(t){return null==t?v:function(){return this.querySelector(t)}}function _(){return[]}function b(t){return null==t?_:function(){return this.querySelectorAll(t)}}function w(t){return function(){return this.matches(t)}}function k(t){return function(e){return e.matches(t)}}m.prototype=g.prototype={constructor:m,on:function(t,e){var n,i=this._,r=(t+"").trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");if(n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),t&&!i.hasOwnProperty(t))throw Error("unknown type: "+t);return{type:t,name:e}}),o=-1,s=r.length;if(arguments.length<2){for(;++o<s;)if((n=(t=r[o]).type)&&(n=function(t,e){for(var n,i=0,r=t.length;i<r;++i)if((n=t[i]).name===e)return n.value}(i[n],t.name)))return n;return}if(null!=e&&"function"!=typeof e)throw Error("invalid callback: "+e);for(;++o<s;)if(n=(t=r[o]).type)i[n]=y(i[n],t.name,e);else if(null==e)for(n in i)i[n]=y(i[n],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new m(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,i,r=Array(n),o=0;o<n;++o)r[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw Error("unknown type: "+t);for(i=this._[t],o=0,n=i.length;o<n;++o)i[o].value.apply(e,r)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw Error("unknown type: "+t);for(var i=this._[t],r=0,o=i.length;r<o;++r)i[r].value.apply(e,n)}};var S=Array.prototype.find;function E(){return this.firstElementChild}var $=Array.prototype.filter;function C(){return Array.from(this.children)}function O(t){return Array(t.length)}function L(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function R(t,e,n,i,r,o){for(var s,a=0,l=e.length,h=o.length;a<h;++a)(s=e[a])?(s.__data__=o[a],i[a]=s):n[a]=new L(t,o[a]);for(;a<l;++a)(s=e[a])&&(r[a]=s)}function A(t,e,n,i,r,o,s){var a,l,h,u=new Map,c=e.length,d=o.length,f=Array(c);for(a=0;a<c;++a)(l=e[a])&&(f[a]=h=s.call(l,l.__data__,a,e)+"",u.has(h)?r[a]=l:u.set(h,l));for(a=0;a<d;++a)h=s.call(t,o[a],a,o)+"",(l=u.get(h))?(i[a]=l,l.__data__=o[a],u.delete(h)):n[a]=new L(t,o[a]);for(a=0;a<c;++a)(l=e[a])&&u.get(f[a])===l&&(r[a]=l)}function T(t){return t.__data__}function P(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}L.prototype={constructor:L,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var N="http://www.w3.org/1999/xhtml",M={svg:"http://www.w3.org/2000/svg",xhtml:N,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function I(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),M.hasOwnProperty(e)?{space:M[e],local:t}:t}function z(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function F(t,e){return t.style.getPropertyValue(e)||z(t).getComputedStyle(t,null).getPropertyValue(e)}function D(t){return t.trim().split(/^|\s+/)}function j(t){return t.classList||new B(t)}function B(t){this._node=t,this._names=D(t.getAttribute("class")||"")}function V(t,e){for(var n=j(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function U(t,e){for(var n=j(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function H(){this.textContent=""}function q(){this.innerHTML=""}function G(){this.nextSibling&&this.parentNode.appendChild(this)}function K(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function W(t){var e=I(t);return(e.local?function(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}:function(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===N&&e.documentElement.namespaceURI===N?e.createElement(t):e.createElementNS(n,t)}})(e)}function Y(){return null}function X(){var t=this.parentNode;t&&t.removeChild(this)}function J(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Q(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Z(t){return function(){var e=this.__on;if(e){for(var n,i=0,r=-1,o=e.length;i<o;++i)(n=e[i],t.type&&n.type!==t.type||n.name!==t.name)?e[++r]=n:this.removeEventListener(n.type,n.listener,n.options);++r?e.length=r:delete this.__on}}}function tt(t,e,n){return function(){var i,r=this.__on,o=function(t){e.call(this,t,this.__data__)};if(r){for(var s=0,a=r.length;s<a;++s)if((i=r[s]).type===t.type&&i.name===t.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=n),i.value=e;return}}this.addEventListener(t.type,o,n),i={type:t.type,name:t.name,value:e,listener:o,options:n},r?r.push(i):this.__on=[i]}}function te(t,e,n){var i=z(t),r=i.CustomEvent;"function"==typeof r?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}B.prototype={add:function(t){0>this._names.indexOf(t)&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var tn=[null];function ti(t,e){this._groups=t,this._parents=e}function tr(){return new ti([[document.documentElement]],tn)}function to(t){return"string"==typeof t?new ti([[document.querySelector(t)]],[document.documentElement]):new ti([[t]],tn)}ti.prototype=tr.prototype={constructor:ti,select:function(t){"function"!=typeof t&&(t=x(t));for(var e=this._groups,n=e.length,i=Array(n),r=0;r<n;++r)for(var o,s,a=e[r],l=a.length,h=i[r]=Array(l),u=0;u<l;++u)(o=a[u])&&(s=t.call(o,o.__data__,u,a))&&("__data__"in o&&(s.__data__=o.__data__),h[u]=s);return new ti(i,this._parents)},selectAll:function(t){if("function"==typeof t){var e;e=t,t=function(){var t;return t=e.apply(this,arguments),null==t?[]:Array.isArray(t)?t:Array.from(t)}}else t=b(t);for(var n=this._groups,i=n.length,r=[],o=[],s=0;s<i;++s)for(var a,l=n[s],h=l.length,u=0;u<h;++u)(a=l[u])&&(r.push(t.call(a,a.__data__,u,l)),o.push(a));return new ti(r,o)},selectChild:function(t){var e;return this.select(null==t?E:(e="function"==typeof t?t:k(t),function(){return S.call(this.children,e)}))},selectChildren:function(t){var e;return this.selectAll(null==t?C:(e="function"==typeof t?t:k(t),function(){return $.call(this.children,e)}))},filter:function(t){"function"!=typeof t&&(t=w(t));for(var e=this._groups,n=e.length,i=Array(n),r=0;r<n;++r)for(var o,s=e[r],a=s.length,l=i[r]=[],h=0;h<a;++h)(o=s[h])&&t.call(o,o.__data__,h,s)&&l.push(o);return new ti(i,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,T);var n=e?A:R,i=this._parents,r=this._groups;"function"!=typeof t&&(v=t,t=function(){return v});for(var o=r.length,s=Array(o),a=Array(o),l=Array(o),h=0;h<o;++h){var u=i[h],c=r[h],d=c.length,f="object"==typeof(y=t.call(u,u&&u.__data__,h,i))&&"length"in y?y:Array.from(y),p=f.length,g=a[h]=Array(p),m=s[h]=Array(p);n(u,c,g,m,l[h]=Array(d),f,e);for(var y,v,x,_,b=0,w=0;b<p;++b)if(x=g[b]){for(b>=w&&(w=b+1);!(_=m[w])&&++w<p;);x._next=_||null}}return(s=new ti(s,i))._enter=a,s._exit=l,s},enter:function(){return new ti(this._enter||this._groups.map(O),this._parents)},exit:function(){return new ti(this._exit||this._groups.map(O),this._parents)},join:function(t,e,n){var i=this.enter(),r=this,o=this.exit();return"function"==typeof t?(i=t(i))&&(i=i.selection()):i=i.append(t+""),null!=e&&(r=e(r))&&(r=r.selection()),null==n?o.remove():n(o),i&&r?i.merge(r).order():r},merge:function(t){for(var e=t.selection?t.selection():t,n=this._groups,i=e._groups,r=n.length,o=i.length,s=Math.min(r,o),a=Array(r),l=0;l<s;++l)for(var h,u=n[l],c=i[l],d=u.length,f=a[l]=Array(d),p=0;p<d;++p)(h=u[p]||c[p])&&(f[p]=h);for(;l<r;++l)a[l]=n[l];return new ti(a,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i,r=t[e],o=r.length-1,s=r[o];--o>=0;)(i=r[o])&&(s&&4^i.compareDocumentPosition(s)&&s.parentNode.insertBefore(i,s),s=i);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=P);for(var n=this._groups,i=n.length,r=Array(i),o=0;o<i;++o){for(var s,a=n[o],l=a.length,h=r[o]=Array(l),u=0;u<l;++u)(s=a[u])&&(h[u]=s);h.sort(e)}return new ti(r,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,o=i.length;r<o;++r){var s=i[r];if(s)return s}return null},size:function(){let t=0;for(let e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r,o=e[n],s=0,a=o.length;s<a;++s)(r=o[s])&&t.call(r,r.__data__,s,o);return this},attr:function(t,e){var n=I(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==e?n.local?function(t){return function(){this.removeAttributeNS(t.space,t.local)}}:function(t){return function(){this.removeAttribute(t)}}:"function"==typeof e?n.local?function(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}:function(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}:n.local?function(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}:function(t,e){return function(){this.setAttribute(t,e)}})(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?function(t){return function(){this.style.removeProperty(t)}}:"function"==typeof e?function(t,e,n){return function(){var i=e.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}:function(t,e,n){return function(){this.style.setProperty(t,e,n)}})(t,e,null==n?"":n)):F(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?function(t){return function(){delete this[t]}}:"function"==typeof e?function(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}:function(t,e){return function(){this[t]=e}})(t,e)):this.node()[t]},classed:function(t,e){var n=D(t+"");if(arguments.length<2){for(var i=j(this.node()),r=-1,o=n.length;++r<o;)if(!i.contains(n[r]))return!1;return!0}return this.each(("function"==typeof e?function(t,e){return function(){(e.apply(this,arguments)?V:U)(this,t)}}:e?function(t){return function(){V(this,t)}}:function(t){return function(){U(this,t)}})(n,e))},text:function(t){return arguments.length?this.each(null==t?H:("function"==typeof t?function(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}:function(t){return function(){this.textContent=t}})(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?q:("function"==typeof t?function(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}:function(t){return function(){this.innerHTML=t}})(t)):this.node().innerHTML},raise:function(){return this.each(G)},lower:function(){return this.each(K)},append:function(t){var e="function"==typeof t?t:W(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})},insert:function(t,e){var n="function"==typeof t?t:W(t),i=null==e?Y:"function"==typeof e?e:x(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})},remove:function(){return this.each(X)},clone:function(t){return this.select(t?Q:J)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var i,r,o=(t+"").trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}),s=o.length;if(arguments.length<2){var a=this.node().__on;if(a){for(var l,h=0,u=a.length;h<u;++h)for(i=0,l=a[h];i<s;++i)if((r=o[i]).type===l.type&&r.name===l.name)return l.value}return}for(i=0,a=e?tt:Z;i<s;++i)this.each(a(o[i],e,n));return this},dispatch:function(t,e){return this.each(("function"==typeof e?function(t,e){return function(){return te(this,t,e.apply(this,arguments))}}:function(t,e){return function(){return te(this,t,e)}})(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i,r=t[e],o=0,s=r.length;o<s;++o)(i=r[o])&&(yield i)}};const ts={capture:!0,passive:!1};function ta(t){t.preventDefault(),t.stopImmediatePropagation()}var tl=(s("bYoiY"),s("bYoiY"));function th(t,e,n,i,r){var o=t*t,s=o*t;return((1-3*t+3*o-s)*e+(4-6*o+3*s)*n+(1+3*t+3*o-3*s)*i+s*r)/6}var tu=t=>()=>t;function tc(t,e){var n=e-t;return n?function(e){return t+e*n}:tu(isNaN(t)?e:t)}var td=function t(e){var n,i=1==(n=+e)?tc:function(t,e){var i,r,o;return e-t?(i=t,r=e,i=Math.pow(i,o=n),r=Math.pow(r,o)-i,o=1/o,function(t){return Math.pow(i+t*r,o)}):tu(isNaN(t)?e:t)};function r(t,e){var n=i((t=(0,tl.rgb)(t)).r,(e=(0,tl.rgb)(e)).r),r=i(t.g,e.g),o=i(t.b,e.b),s=tc(t.opacity,e.opacity);return function(e){return t.r=n(e),t.g=r(e),t.b=o(e),t.opacity=s(e),t+""}}return r.gamma=t,r}(1);function tf(t){return function(e){var n,i,r=e.length,o=Array(r),s=Array(r),a=Array(r);for(n=0;n<r;++n)i=(0,tl.rgb)(e[n]),o[n]=i.r||0,s[n]=i.g||0,a[n]=i.b||0;return o=t(o),s=t(s),a=t(a),i.opacity=1,function(t){return i.r=o(t),i.g=s(t),i.b=a(t),i+""}}}function tp(t,e){return t*=1,e*=1,function(n){return t*(1-n)+e*n}}tf(function(t){var e=t.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),r=t[i],o=t[i+1],s=i>0?t[i-1]:2*r-o,a=i<e-1?t[i+2]:2*o-r;return th((n-i/e)*e,s,r,o,a)}}),tf(function(t){var e=t.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*e),r=t[(i+e-1)%e],o=t[i%e],s=t[(i+1)%e],a=t[(i+2)%e];return th((n-i/e)*e,r,o,s,a)}});var tg=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,tm=RegExp(tg.source,"g");function ty(t,e){if(t=function(t){let e;for(;e=t.sourceEvent;)t=e;return t}(t),void 0===e&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,[(i=i.matrixTransform(e.getScreenCTM().inverse())).x,i.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}}return[t.pageX,t.pageY]}var tv,tx,t_,tb=0,tw=0,tk=0,tS=0,tE=0,t$=0,tC="object"==typeof performance&&performance.now?performance:Date,tO="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function tL(){return tE||(tO(tR),tE=tC.now()+t$)}function tR(){tE=0}function tA(){this._call=this._time=this._next=null}function tT(t,e,n){var i=new tA;return i.restart(t,e,n),i}function tP(){tE=(tS=tC.now())+t$,tb=tw=0;try{tL(),++tb;for(var t,e=tx;e;)(t=tE-e._time)>=0&&e._call.call(void 0,t),e=e._next;--tb}finally{tb=0,function(){for(var t,e,n=tx,i=1/0;n;)n._call?(i>n._time&&(i=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:tx=e);t_=t,tM(i)}(),tE=0}}function tN(){var t=tC.now(),e=t-tS;e>1e3&&(t$-=e,tS=t)}function tM(t){!tb&&(tw&&(tw=clearTimeout(tw)),t-tE>24?(t<1/0&&(tw=setTimeout(tP,t-tC.now()-t$)),tk&&(tk=clearInterval(tk))):(tk||(tS=tC.now(),tk=setInterval(tN,1e3)),tb=1,tO(tP)))}function tI(t,e,n){var i=new tA;return e=null==e?0:+e,i.restart(n=>{i.stop(),t(n+e)},e,n),i}tA.prototype=tT.prototype={constructor:tA,restart:function(t,e,n){if("function"!=typeof t)throw TypeError("callback is not a function");n=(null==n?tL():+n)+(null==e?0:+e),this._next||t_===this||(t_?t_._next=this:tx=this,t_=this),this._call=t,this._time=n,tM()},stop:function(){this._call&&(this._call=null,this._time=1/0,tM())}};var tz=g("start","end","cancel","interrupt"),tF=[];function tD(t,e,n,i,r,o){var s=t.__transition;if(s){if(n in s)return}else t.__transition={};!function(t,e,n){var i,r=t.__transition;function o(l){var h,u,c,d;if(1!==n.state)return a();for(h in r)if((d=r[h]).name===n.name){if(3===d.state)return tI(o);4===d.state?(d.state=6,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete r[h]):+h<e&&(d.state=6,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete r[h])}if(tI(function(){3===n.state&&(n.state=4,n.timer.restart(s,n.delay,n.time),s(l))}),n.state=2,n.on.call("start",t,t.__data__,n.index,n.group),2===n.state){for(h=0,n.state=3,i=Array(c=n.tween.length),u=-1;h<c;++h)(d=n.tween[h].value.call(t,t.__data__,n.index,n.group))&&(i[++u]=d);i.length=u+1}}function s(e){for(var r=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(a),n.state=5,1),o=-1,s=i.length;++o<s;)i[o].call(t,r);5===n.state&&(n.on.call("end",t,t.__data__,n.index,n.group),a())}function a(){for(var i in n.state=6,n.timer.stop(),delete r[e],r)return;delete t.__transition}r[e]=n,n.timer=tT(function(t){n.state=1,n.timer.restart(o,n.delay,n.time),n.delay<=t&&o(t-n.delay)},0,n.time)}(t,n,{name:e,index:i,group:r,on:tz,tween:tF,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:0})}function tj(t,e){var n=tV(t,e);if(n.state>0)throw Error("too late; already scheduled");return n}function tB(t,e){var n=tV(t,e);if(n.state>3)throw Error("too late; already running");return n}function tV(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw Error("transition not found");return n}function tU(t,e){var n,i,r,o=t.__transition,s=!0;if(o){for(r in e=null==e?null:e+"",o){if((n=o[r]).name!==e){s=!1;continue}i=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(i?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete o[r]}s&&delete t.__transition}}var tH=180/Math.PI,tq={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function tG(t,e,n,i,r,o){var s,a,l;return(s=Math.sqrt(t*t+e*e))&&(t/=s,e/=s),(l=t*n+e*i)&&(n-=t*l,i-=e*l),(a=Math.sqrt(n*n+i*i))&&(n/=a,i/=a,l/=a),t*i<e*n&&(t=-t,e=-e,l=-l,s=-s),{translateX:r,translateY:o,rotate:Math.atan2(e,t)*tH,skewX:Math.atan(l)*tH,scaleX:s,scaleY:a}}function tK(t,e,n,i){function r(t){return t.length?t.pop()+" ":""}return function(o,s){var a,l,h,u,c=[],d=[];return o=t(o),s=t(s),!function(t,i,r,o,s,a){if(t!==r||i!==o){var l=s.push("translate(",null,e,null,n);a.push({i:l-4,x:tp(t,r)},{i:l-2,x:tp(i,o)})}else(r||o)&&s.push("translate("+r+e+o+n)}(o.translateX,o.translateY,s.translateX,s.translateY,c,d),a=o.rotate,a!==(l=s.rotate)?(a-l>180?l+=360:l-a>180&&(a+=360),d.push({i:c.push(r(c)+"rotate(",null,i)-2,x:tp(a,l)})):l&&c.push(r(c)+"rotate("+l+i),h=o.skewX,h!==(u=s.skewX)?d.push({i:c.push(r(c)+"skewX(",null,i)-2,x:tp(h,u)}):u&&c.push(r(c)+"skewX("+u+i),!function(t,e,n,i,o,s){if(t!==n||e!==i){var a=o.push(r(o)+"scale(",null,",",null,")");s.push({i:a-4,x:tp(t,n)},{i:a-2,x:tp(e,i)})}else(1!==n||1!==i)&&o.push(r(o)+"scale("+n+","+i+")")}(o.scaleX,o.scaleY,s.scaleX,s.scaleY,c,d),o=s=null,function(t){for(var e,n=-1,i=d.length;++n<i;)c[(e=d[n]).i]=e.x(t);return c.join("")}}}var tW=tK(function(t){let e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?tq:tG(e.a,e.b,e.c,e.d,e.e,e.f)},"px, ","px)","deg)"),tY=tK(function(t){return null==t?tq:(n||(n=document.createElementNS("http://www.w3.org/2000/svg","g")),n.setAttribute("transform",t),t=n.transform.baseVal.consolidate())?tG((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):tq},", ",")",")");function tX(t,e,n){var i=t._id;return t.each(function(){var t=tB(this,i);(t.value||(t.value={}))[e]=n.apply(this,arguments)}),function(t){return tV(t,i).value[e]}}var tl=s("bYoiY");function tJ(t,e){var n;return("number"==typeof e?tp:e instanceof(0,tl.default)?td:(n=(0,tl.default)(e))?(e=n,td):function(t,e){var n,i,r,o,s,a=tg.lastIndex=tm.lastIndex=0,l=-1,h=[],u=[];for(t+="",e+="";(r=tg.exec(t))&&(o=tm.exec(e));)(s=o.index)>a&&(s=e.slice(a,s),h[l]?h[l]+=s:h[++l]=s),(r=r[0])===(o=o[0])?h[l]?h[l]+=o:h[++l]=o:(h[++l]=null,u.push({i:l,x:tp(r,o)})),a=tm.lastIndex;return a<e.length&&(s=e.slice(a),h[l]?h[l]+=s:h[++l]=s),h.length<2?u[0]?(n=u[0].x,function(t){return n(t)+""}):(i=e,function(){return i}):(e=u.length,function(t){for(var n,i=0;i<e;++i)h[(n=u[i]).i]=n.x(t);return h.join("")})})(t,e)}var tQ=tr.prototype.constructor;function tZ(t){return function(){this.style.removeProperty(t)}}var t0=0;function t1(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}var t2=tr.prototype;t1.prototype=(function(t){return tr().transition(t)}).prototype={constructor:t1,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=x(t));for(var i=this._groups,r=i.length,o=Array(r),s=0;s<r;++s)for(var a,l,h=i[s],u=h.length,c=o[s]=Array(u),d=0;d<u;++d)(a=h[d])&&(l=t.call(a,a.__data__,d,h))&&("__data__"in a&&(l.__data__=a.__data__),c[d]=l,tD(c[d],e,n,d,c,tV(a,n)));return new t1(o,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=b(t));for(var i=this._groups,r=i.length,o=[],s=[],a=0;a<r;++a)for(var l,h=i[a],u=h.length,c=0;c<u;++c)if(l=h[c]){for(var d,f=t.call(l,l.__data__,c,h),p=tV(l,n),g=0,m=f.length;g<m;++g)(d=f[g])&&tD(d,e,n,g,f,p);o.push(f),s.push(l)}return new t1(o,s,e,n)},selectChild:t2.selectChild,selectChildren:t2.selectChildren,filter:function(t){"function"!=typeof t&&(t=w(t));for(var e=this._groups,n=e.length,i=Array(n),r=0;r<n;++r)for(var o,s=e[r],a=s.length,l=i[r]=[],h=0;h<a;++h)(o=s[h])&&t.call(o,o.__data__,h,s)&&l.push(o);return new t1(i,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw Error();for(var e=this._groups,n=t._groups,i=e.length,r=n.length,o=Math.min(i,r),s=Array(i),a=0;a<o;++a)for(var l,h=e[a],u=n[a],c=h.length,d=s[a]=Array(c),f=0;f<c;++f)(l=h[f]||u[f])&&(d[f]=l);for(;a<i;++a)s[a]=e[a];return new t1(s,this._parents,this._name,this._id)},selection:function(){return new tQ(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=++t0,i=this._groups,r=i.length,o=0;o<r;++o)for(var s,a=i[o],l=a.length,h=0;h<l;++h)if(s=a[h]){var u=tV(s,e);tD(s,t,n,h,a,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new t1(i,this._parents,t,n)},call:t2.call,nodes:t2.nodes,node:t2.node,size:t2.size,empty:t2.empty,each:t2.each,on:function(t,e){var n,i,r,o,s,a,l=this._id;return arguments.length<2?tV(this.node(),l).on.on(t):this.each((n=l,i=t,r=e,a=(i+"").trim().split(/^|\s+/).every(function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t})?tj:tB,function(){var t=a(this,n),e=t.on;e!==o&&(s=(o=e).copy()).on(i,r),t.on=s}))},attr:function(t,e){var n=I(t),i="transform"===n?tY:tJ;return this.attrTween(t,"function"==typeof e?(n.local?function(t,e,n){var i,r,o;return function(){var s,a,l=n(this);return null==l?void this.removeAttributeNS(t.space,t.local):(s=this.getAttributeNS(t.space,t.local))===(a=l+"")?null:s===i&&a===r?o:(r=a,o=e(i=s,l))}}:function(t,e,n){var i,r,o;return function(){var s,a,l=n(this);return null==l?void this.removeAttribute(t):(s=this.getAttribute(t))===(a=l+"")?null:s===i&&a===r?o:(r=a,o=e(i=s,l))}})(n,i,tX(this,"attr."+t,e)):null==e?(n.local?function(t){return function(){this.removeAttributeNS(t.space,t.local)}}:function(t){return function(){this.removeAttribute(t)}})(n):(n.local?function(t,e,n){var i,r,o=n+"";return function(){var s=this.getAttributeNS(t.space,t.local);return s===o?null:s===i?r:r=e(i=s,n)}}:function(t,e,n){var i,r,o=n+"";return function(){var s=this.getAttribute(t);return s===o?null:s===i?r:r=e(i=s,n)}})(n,i,e))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw Error();var i=I(t);return this.tween(n,(i.local?function(t,e){var n,i;function r(){var r=e.apply(this,arguments);return r!==i&&(n=(i=r)&&function(e){this.setAttributeNS(t.space,t.local,r.call(this,e))}),n}return r._value=e,r}:function(t,e){var n,i;function r(){var r=e.apply(this,arguments);return r!==i&&(n=(i=r)&&function(e){this.setAttribute(t,r.call(this,e))}),n}return r._value=e,r})(i,e))},style:function(t,e,n){var i,r,o,s,a,l,h,u,c,d,f,p,g,m,y,v,x,_,b,w,k,S="transform"==(t+="")?tW:tJ;return null==e?this.styleTween(t,(i=t,function(){var t=F(this,i),e=(this.style.removeProperty(i),F(this,i));return t===e?null:t===r&&e===o?s:s=S(r=t,o=e)})).on("end.style."+t,tZ(t)):"function"==typeof e?this.styleTween(t,(a=t,l=tX(this,"style."+t,e),function(){var t=F(this,a),e=l(this),n=e+"";return null==e&&(this.style.removeProperty(a),n=e=F(this,a)),t===n?null:t===h&&n===u?c:(u=n,c=S(h=t,e))})).each((d=this._id,x="end."+(v="style."+(f=t)),function(){var t=tB(this,d),e=t.on,n=null==t.value[v]?y||(y=tZ(f)):void 0;(e!==p||m!==n)&&(g=(p=e).copy()).on(x,m=n),t.on=g})):this.styleTween(t,(_=t,k=e+"",function(){var t=F(this,_);return t===k?null:t===b?w:w=S(b=t,e)}),n).on("end.style."+t,null)},styleTween:function(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==e)return this.tween(i,null);if("function"!=typeof e)throw Error();return this.tween(i,function(t,e,n){var i,r;function o(){var o=e.apply(this,arguments);return o!==r&&(i=(r=o)&&function(e){this.style.setProperty(t,o.call(this,e),n)}),i}return o._value=e,o}(t,e,null==n?"":n))},text:function(t){var e,n;return this.tween("text","function"==typeof t?(e=tX(this,"text",t),function(){var t=e(this);this.textContent=null==t?"":t}):(n=null==t?"":t+"",function(){this.textContent=n}))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw Error();return this.tween(e,function(t){var e,n;function i(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&function(t){this.textContent=i.call(this,t)}),e}return i._value=t,i}(t))},remove:function(){var t;return this.on("end.remove",(t=this._id,function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}))},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i,r=tV(this.node(),n).tween,o=0,s=r.length;o<s;++o)if((i=r[o]).name===t)return i.value;return null}return this.each((null==e?function(t,e){var n,i;return function(){var r=tB(this,t),o=r.tween;if(o!==n){i=n=o;for(var s=0,a=i.length;s<a;++s)if(i[s].name===e){(i=i.slice()).splice(s,1);break}}r.tween=i}}:function(t,e,n){var i,r;if("function"!=typeof n)throw Error();return function(){var o=tB(this,t),s=o.tween;if(s!==i){r=(i=s).slice();for(var a={name:e,value:n},l=0,h=r.length;l<h;++l)if(r[l].name===e){r[l]=a;break}l===h&&r.push(a)}o.tween=r}})(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?function(t,e){return function(){tj(this,t).delay=+e.apply(this,arguments)}}:function(t,e){return e*=1,function(){tj(this,t).delay=e}})(e,t)):tV(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?function(t,e){return function(){tB(this,t).duration=+e.apply(this,arguments)}}:function(t,e){return e*=1,function(){tB(this,t).duration=e}})(e,t)):tV(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(function(t,e){if("function"!=typeof e)throw Error();return function(){tB(this,t).ease=e}}(e,t)):tV(this.node(),e).ease},easeVarying:function(t){var e;if("function"!=typeof t)throw Error();return this.each((e=this._id,function(){var n=t.apply(this,arguments);if("function"!=typeof n)throw Error();tB(this,e).ease=n}))},end:function(){var t,e,n=this,i=n._id,r=n.size();return new Promise(function(o,s){var a={value:s},l={value:function(){0==--r&&o()}};n.each(function(){var n=tB(this,i),r=n.on;r!==t&&((e=(t=r).copy())._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),n.on=e}),0===r&&o()})},[Symbol.iterator]:t2[Symbol.iterator]};var t5={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};tr.prototype.interrupt=function(t){return this.each(function(){tU(this,t)})},tr.prototype.transition=function(t){var e,n;t instanceof t1?(e=t._id,t=t._name):(e=++t0,(n=t5).time=tL(),t=null==t?null:t+"");for(var i=this._groups,r=i.length,o=0;o<r;++o)for(var s,a=i[o],l=a.length,h=0;h<l;++h)(s=a[h])&&tD(s,t,e,h,a,n||function(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw Error(`transition ${e} not found`);return n}(s,e));return new t1(i,this._parents,t,e)};const{abs:t3,max:t4,min:t8}=Math;function t6(t){return{type:t}}function t9(t){var e=0,n=t.children,i=n&&n.length;if(i)for(;--i>=0;)e+=n[i].value;else e=1;t.value=e}function t7(t,e){t instanceof Map?(t=[void 0,t],void 0===e&&(e=ee)):void 0===e&&(e=et);for(var n,i,r,o,s,a=new er(t),l=[a];n=l.pop();)if((r=e(n.data))&&(s=(r=Array.from(r)).length))for(n.children=r,o=s-1;o>=0;--o)l.push(i=r[o]=new er(r[o])),i.parent=n,i.depth=n.depth+1;return a.eachBefore(ei)}function et(t){return t.children}function ee(t){return Array.isArray(t)?t[1]:null}function en(t){void 0!==t.data.value&&(t.value=t.data.value),t.data=t.data.data}function ei(t){var e=0;do t.height=e;while((t=t.parent)&&t.height<++e)}function er(t){this.data=t,this.depth=this.height=0,this.parent=null}function eo(t,e){return t.parent===e.parent?1:2}function es(t){var e=t.children;return e?e[0]:t.t}function ea(t){var e=t.children;return e?e[e.length-1]:t.t}function el(t,e){this._=t,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=e}function eh(t,e,n){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+n)/6)}function eu(t){this._context=t}function ec(t){return new eu(t)}function ed(t,e){this._context=t,this._t=e}function ef(t){return new ed(t,.5)}["w","e"].map(t6),["n","s"].map(t6),["n","w","e","s","nw","ne","sw","se"].map(t6),er.prototype=t7.prototype={constructor:er,count:function(){return this.eachAfter(t9)},each:function(t,e){let n=-1;for(let i of this)t.call(e,i,++n,this);return this},eachAfter:function(t,e){for(var n,i,r,o=this,s=[o],a=[],l=-1;o=s.pop();)if(a.push(o),n=o.children)for(i=0,r=n.length;i<r;++i)s.push(n[i]);for(;o=a.pop();)t.call(e,o,++l,this);return this},eachBefore:function(t,e){for(var n,i,r=this,o=[r],s=-1;r=o.pop();)if(t.call(e,r,++s,this),n=r.children)for(i=n.length-1;i>=0;--i)o.push(n[i]);return this},find:function(t,e){let n=-1;for(let i of this)if(t.call(e,i,++n,this))return i},sum:function(t){return this.eachAfter(function(e){for(var n=+t(e.data)||0,i=e.children,r=i&&i.length;--r>=0;)n+=i[r].value;e.value=n})},sort:function(t){return this.eachBefore(function(e){e.children&&e.children.sort(t)})},path:function(t){for(var e=this,n=function(t,e){if(t===e)return t;var n=t.ancestors(),i=e.ancestors(),r=null;for(t=n.pop(),e=i.pop();t===e;)r=t,t=n.pop(),e=i.pop();return r}(e,t),i=[e];e!==n;)i.push(e=e.parent);for(var r=i.length;t!==n;)i.splice(r,0,t),t=t.parent;return i},ancestors:function(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e},descendants:function(){return Array.from(this)},leaves:function(){var t=[];return this.eachBefore(function(e){e.children||t.push(e)}),t},links:function(){var t=this,e=[];return t.each(function(n){n!==t&&e.push({source:n.parent,target:n})}),e},copy:function(){return t7(this).eachBefore(en)},[Symbol.iterator]:function*(){var t,e,n,i,r=this,o=[r];do for(t=o.reverse(),o=[];r=t.pop();)if(yield r,e=r.children)for(n=0,i=e.length;n<i;++n)o.push(e[n]);while(o.length)}},el.prototype=Object.create(er.prototype),eu.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:eh(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t*=1,e*=1,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:eh(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},ed.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t*=1,e*=1,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var n=this._x*(1-this._t)+t*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,e)}}this._x=t,this._y=e}};var ep=Array.prototype.slice;function eg(t){return function(){return t}}function em(t){this._context=t}function ey(t){return new em(t)}em.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t*=1,e*=1,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}};const ev=Math.PI,ex=2*ev,e_=ex-1e-6;function eb(t){this._+=t[0];for(let e=1,n=t.length;e<n;++e)this._+=arguments[e]+t[e]}class ew{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==t?eb:function(t){let e=Math.floor(t);if(!(e>=0))throw Error(`invalid digits: ${t}`);if(e>15)return eb;let n=10**e;return function(t){this._+=t[0];for(let e=1,i=t.length;e<i;++e)this._+=Math.round(arguments[e]*n)/n+t[e]}}(t)}moveTo(t,e){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,e){this._append`L${this._x1=+t},${this._y1=+e}`}quadraticCurveTo(t,e,n,i){this._append`Q${+t},${+e},${this._x1=+n},${this._y1=+i}`}bezierCurveTo(t,e,n,i,r,o){this._append`C${+t},${+e},${+n},${+i},${this._x1=+r},${this._y1=+o}`}arcTo(t,e,n,i,r){if(t*=1,e*=1,n*=1,i*=1,(r*=1)<0)throw Error(`negative radius: ${r}`);let o=this._x1,s=this._y1,a=n-t,l=i-e,h=o-t,u=s-e,c=h*h+u*u;if(null===this._x1)this._append`M${this._x1=t},${this._y1=e}`;else if(c>1e-6)if(Math.abs(u*a-l*h)>1e-6&&r){let d=n-o,f=i-s,p=a*a+l*l,g=Math.sqrt(p),m=Math.sqrt(c),y=r*Math.tan((ev-Math.acos((p+c-(d*d+f*f))/(2*g*m)))/2),v=y/m,x=y/g;Math.abs(v-1)>1e-6&&this._append`L${t+v*h},${e+v*u}`,this._append`A${r},${r},0,0,${+(u*d>h*f)},${this._x1=t+x*a},${this._y1=e+x*l}`}else this._append`L${this._x1=t},${this._y1=e}`}arc(t,e,n,i,r,o){if(t*=1,e*=1,n*=1,o=!!o,n<0)throw Error(`negative radius: ${n}`);let s=n*Math.cos(i),a=n*Math.sin(i),l=t+s,h=e+a,u=1^o,c=o?i-r:r-i;null===this._x1?this._append`M${l},${h}`:(Math.abs(this._x1-l)>1e-6||Math.abs(this._y1-h)>1e-6)&&this._append`L${l},${h}`,n&&(c<0&&(c=c%ex+ex),c>e_?this._append`A${n},${n},0,1,${u},${t-s},${e-a}A${n},${n},0,1,${u},${this._x1=l},${this._y1=h}`:c>1e-6&&this._append`A${n},${n},0,${+(c>=ev)},${u},${this._x1=t+n*Math.cos(r)},${this._y1=e+n*Math.sin(r)}`)}rect(t,e,n,i){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${n*=1}v${+i}h${-n}Z`}toString(){return this._}}function ek(t){let e=3;return t.digits=function(n){if(!arguments.length)return e;if(null==n)e=null;else{let t=Math.floor(n);if(!(t>=0))throw RangeError(`invalid digits: ${n}`);e=t}return t},()=>new ew(e)}function eS(t){return t[0]}function eE(t){return t[1]}function e$(t,e){var n=eg(!0),i=null,r=ey,o=null,s=ek(a);function a(a){var l,h,u,c,d=(a="object"==typeof(l=a)&&"length"in l?l:Array.from(l)).length,f=!1;for(null==i&&(o=r(c=s())),h=0;h<=d;++h)!(h<d&&n(u=a[h],h,a))===f&&((f=!f)?o.lineStart():o.lineEnd()),f&&o.point(+t(u,h,a),+e(u,h,a));if(c)return o=null,c+""||null}return t="function"==typeof t?t:void 0===t?eS:eg(t),e="function"==typeof e?e:void 0===e?eE:eg(e),a.x=function(e){return arguments.length?(t="function"==typeof e?e:eg(+e),a):t},a.y=function(t){return arguments.length?(e="function"==typeof t?t:eg(+t),a):e},a.defined=function(t){return arguments.length?(n="function"==typeof t?t:eg(!!t),a):n},a.curve=function(t){return arguments.length?(r=t,null!=i&&(o=r(i)),a):r},a.context=function(t){return arguments.length?(null==t?i=o=null:o=r(i=t),a):i},a}ew.prototype;class eC{constructor(t,e){this._context=t,this._x=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line}point(t,e){switch(t*=1,e*=1,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,e,t,e):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+e)/2,t,this._y0,t,e)}this._x0=t,this._y0=e}}function eO(t){return new eC(t,!0)}function eL(t){return new eC(t,!1)}function eR(t){return t.source}function eA(t){return t.target}function eT(t){let e=eR,n=eA,i=eS,r=eE,o=null,s=null,a=ek(l);function l(){let l,h=ep.call(arguments),u=e.apply(this,h),c=n.apply(this,h);if(null==o&&(s=t(l=a())),s.lineStart(),h[0]=u,s.point(+i.apply(this,h),+r.apply(this,h)),h[0]=c,s.point(+i.apply(this,h),+r.apply(this,h)),s.lineEnd(),l)return s=null,l+""||null}return l.source=function(t){return arguments.length?(e=t,l):e},l.target=function(t){return arguments.length?(n=t,l):n},l.x=function(t){return arguments.length?(i="function"==typeof t?t:eg(+t),l):i},l.y=function(t){return arguments.length?(r="function"==typeof t?t:eg(+t),l):r},l.context=function(e){return arguments.length?(null==e?o=s=null:s=t(o=e),l):o},l}function eP(t){return((t=Math.exp(t))+1/t)/2}var eN=function t(e,n,i){function r(t,r){var o,s,a=t[0],l=t[1],h=t[2],u=r[0],c=r[1],d=r[2],f=u-a,p=c-l,g=f*f+p*p;if(g<1e-12)s=Math.log(d/h)/e,o=function(t){return[a+t*f,l+t*p,h*Math.exp(e*t*s)]};else{var m=Math.sqrt(g),y=(d*d-h*h+i*g)/(2*h*n*m),v=(d*d-h*h-i*g)/(2*d*n*m),x=Math.log(Math.sqrt(y*y+1)-y);s=(Math.log(Math.sqrt(v*v+1)-v)-x)/e,o=function(t){var i,r,o=t*s,u=eP(x),c=h/(n*m)*(u*(((i=Math.exp(2*(i=e*o+x)))-1)/(i+1))-((r=Math.exp(r=x))-1/r)/2);return[a+c*f,l+c*p,h*u/eP(e*o+x)]}}return o.duration=1e3*s*e/Math.SQRT2,o}return r.rho=function(e){var n=Math.max(.001,+e),i=n*n;return t(n,i,i*i)},r}(Math.SQRT2,2,4),eM=t=>()=>t;function eI(t,{sourceEvent:e,target:n,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function ez(t,e,n){this.k=t,this.x=e,this.y=n}ez.prototype={constructor:ez,scale:function(t){return 1===t?this:new ez(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new ez(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var eF=new ez(1,0,0);function eD(t){t.stopImmediatePropagation()}function ej(t){t.preventDefault(),t.stopImmediatePropagation()}function eB(t){return(!t.ctrlKey||"wheel"===t.type)&&!t.button}function eV(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function eU(){return this.__zoom||eF}function eH(t){return-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function eq(){return navigator.maxTouchPoints||"ontouchstart"in this}function eG(t,e,n){var i=t.invertX(e[0][0])-n[0][0],r=t.invertX(e[1][0])-n[1][0],o=t.invertY(e[0][1])-n[0][1],s=t.invertY(e[1][1])-n[1][1];return t.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),s>o?(o+s)/2:Math.min(0,o)||Math.max(0,s))}function eK(){var t,e,n,i=eB,r=eV,o=eG,s=eH,a=eq,l=[0,1/0],h=[[-1/0,-1/0],[1/0,1/0]],u=250,c=eN,d=g("start","zoom","end"),f=0,p=10;function m(t){t.property("__zoom",eU).on("wheel.zoom",k,{passive:!1}).on("mousedown.zoom",S).on("dblclick.zoom",E).filter(a).on("touchstart.zoom",$).on("touchmove.zoom",C).on("touchend.zoom touchcancel.zoom",O).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function y(t,e){return(e=Math.max(l[0],Math.min(l[1],e)))===t.k?t:new ez(e,t.x,t.y)}function v(t,e,n){var i=e[0]-n[0]*t.k,r=e[1]-n[1]*t.k;return i===t.x&&r===t.y?t:new ez(t.k,i,r)}function x(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function _(t,e,n,i){t.on("start.zoom",function(){b(this,arguments).event(i).start()}).on("interrupt.zoom end.zoom",function(){b(this,arguments).event(i).end()}).tween("zoom",function(){var t=arguments,o=b(this,t).event(i),s=r.apply(this,t),a=null==n?x(s):"function"==typeof n?n.apply(this,t):n,l=Math.max(s[1][0]-s[0][0],s[1][1]-s[0][1]),h=this.__zoom,u="function"==typeof e?e.apply(this,t):e,d=c(h.invert(a).concat(l/h.k),u.invert(a).concat(l/u.k));return function(t){if(1===t)t=u;else{var e=d(t),n=l/e[2];t=new ez(n,a[0]-e[0]*n,a[1]-e[1]*n)}o.zoom(null,t)}})}function b(t,e,n){return!n&&t.__zooming||new w(t,e)}function w(t,e){this.that=t,this.args=e,this.active=0,this.sourceEvent=null,this.extent=r.apply(t,e),this.taps=0}function k(t,...e){if(i.apply(this,arguments)){var n=b(this,e).event(t),r=this.__zoom,a=Math.max(l[0],Math.min(l[1],r.k*Math.pow(2,s.apply(this,arguments)))),u=ty(t);if(n.wheel)(n.mouse[0][0]!==u[0]||n.mouse[0][1]!==u[1])&&(n.mouse[1]=r.invert(n.mouse[0]=u)),clearTimeout(n.wheel);else{if(r.k===a)return;n.mouse=[u,r.invert(u)],tU(this),n.start()}ej(t),n.wheel=setTimeout(function(){n.wheel=null,n.end()},150),n.zoom("mouse",o(v(y(r,a),n.mouse[0],n.mouse[1]),n.extent,h))}}function S(t,...e){if(!n&&i.apply(this,arguments)){var r,s,a,l=t.currentTarget,u=b(this,e,!0).event(t),c=to(t.view).on("mousemove.zoom",function(t){if(ej(t),!u.moved){var e=t.clientX-p,n=t.clientY-g;u.moved=e*e+n*n>f}u.event(t).zoom("mouse",o(v(u.that.__zoom,u.mouse[0]=ty(t,l),u.mouse[1]),u.extent,h))},!0).on("mouseup.zoom",function(t){var e,n,i,r;c.on("mousemove.zoom mouseup.zoom",null),e=t.view,n=u.moved,i=e.document.documentElement,r=to(e).on("dragstart.drag",null),n&&(r.on("click.drag",ta,ts),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in i?r.on("selectstart.drag",null):(i.style.MozUserSelect=i.__noselect,delete i.__noselect),ej(t),u.event(t).end()},!0),d=ty(t,l),p=t.clientX,g=t.clientY;s=(r=t.view).document.documentElement,a=to(r).on("dragstart.drag",ta,ts),"onselectstart"in s?a.on("selectstart.drag",ta,ts):(s.__noselect=s.style.MozUserSelect,s.style.MozUserSelect="none"),eD(t),u.mouse=[d,this.__zoom.invert(d)],tU(this),u.start()}}function E(t,...e){if(i.apply(this,arguments)){var n=this.__zoom,s=ty(t.changedTouches?t.changedTouches[0]:t,this),a=n.invert(s),l=n.k*(t.shiftKey?.5:2),c=o(v(y(n,l),s,a),r.apply(this,e),h);ej(t),u>0?to(this).transition().duration(u).call(_,c,s,t):to(this).call(m.transform,c,s,t)}}function $(n,...r){if(i.apply(this,arguments)){var o,s,a,l,h=n.touches,u=h.length,c=b(this,r,n.changedTouches.length===u).event(n);for(eD(n),s=0;s<u;++s)l=[l=ty(a=h[s],this),this.__zoom.invert(l),a.identifier],c.touch0?c.touch1||c.touch0[2]===l[2]||(c.touch1=l,c.taps=0):(c.touch0=l,o=!0,c.taps=1+!!t);t&&(t=clearTimeout(t)),o&&(c.taps<2&&(e=l[0],t=setTimeout(function(){t=null},500)),tU(this),c.start())}}function C(t,...e){if(this.__zooming){var n,i,r,s,a=b(this,e).event(t),l=t.changedTouches,u=l.length;for(ej(t),n=0;n<u;++n)r=ty(i=l[n],this),a.touch0&&a.touch0[2]===i.identifier?a.touch0[0]=r:a.touch1&&a.touch1[2]===i.identifier&&(a.touch1[0]=r);if(i=a.that.__zoom,a.touch1){var c=a.touch0[0],d=a.touch0[1],f=a.touch1[0],p=a.touch1[1],g=(g=f[0]-c[0])*g+(g=f[1]-c[1])*g,m=(m=p[0]-d[0])*m+(m=p[1]-d[1])*m;i=y(i,Math.sqrt(g/m)),r=[(c[0]+f[0])/2,(c[1]+f[1])/2],s=[(d[0]+p[0])/2,(d[1]+p[1])/2]}else{if(!a.touch0)return;r=a.touch0[0],s=a.touch0[1]}a.zoom("touch",o(v(i,r,s),a.extent,h))}}function O(t,...i){if(this.__zooming){var r,o,s=b(this,i).event(t),a=t.changedTouches,l=a.length;for(eD(t),n&&clearTimeout(n),n=setTimeout(function(){n=null},500),r=0;r<l;++r)o=a[r],s.touch0&&s.touch0[2]===o.identifier?delete s.touch0:s.touch1&&s.touch1[2]===o.identifier&&delete s.touch1;if(s.touch1&&!s.touch0&&(s.touch0=s.touch1,delete s.touch1),s.touch0)s.touch0[1]=this.__zoom.invert(s.touch0[0]);else if(s.end(),2===s.taps&&(o=ty(o,this),Math.hypot(e[0]-o[0],e[1]-o[1])<p)){var h=to(this).on("dblclick.zoom");h&&h.apply(this,arguments)}}}return m.transform=function(t,e,n,i){var r=t.selection?t.selection():t;r.property("__zoom",eU),t!==r?_(t,e,n,i):r.interrupt().each(function(){b(this,arguments).event(i).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()})},m.scaleBy=function(t,e,n,i){m.scaleTo(t,function(){var t=this.__zoom.k,n="function"==typeof e?e.apply(this,arguments):e;return t*n},n,i)},m.scaleTo=function(t,e,n,i){m.transform(t,function(){var t=r.apply(this,arguments),i=this.__zoom,s=null==n?x(t):"function"==typeof n?n.apply(this,arguments):n,a=i.invert(s),l="function"==typeof e?e.apply(this,arguments):e;return o(v(y(i,l),s,a),t,h)},n,i)},m.translateBy=function(t,e,n,i){m.transform(t,function(){return o(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof n?n.apply(this,arguments):n),r.apply(this,arguments),h)},null,i)},m.translateTo=function(t,e,n,i,s){m.transform(t,function(){var t=r.apply(this,arguments),s=this.__zoom,a=null==i?x(t):"function"==typeof i?i.apply(this,arguments):i;return o(eF.translate(a[0],a[1]).scale(s.k).translate("function"==typeof e?-e.apply(this,arguments):-e,"function"==typeof n?-n.apply(this,arguments):-n),t,h)},i,s)},w.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var e=to(this.that).datum();d.call(t,this.that,new eI(t,{sourceEvent:this.sourceEvent,target:m,type:t,transform:this.that.__zoom,dispatch:d}),e)}},m.wheelDelta=function(t){return arguments.length?(s="function"==typeof t?t:eM(+t),m):s},m.filter=function(t){return arguments.length?(i="function"==typeof t?t:eM(!!t),m):i},m.touchable=function(t){return arguments.length?(a="function"==typeof t?t:eM(!!t),m):a},m.extent=function(t){return arguments.length?(r="function"==typeof t?t:eM([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),m):r},m.scaleExtent=function(t){return arguments.length?(l[0]=+t[0],l[1]=+t[1],m):[l[0],l[1]]},m.translateExtent=function(t){return arguments.length?(h[0][0]=+t[0][0],h[1][0]=+t[1][0],h[0][1]=+t[0][1],h[1][1]=+t[1][1],m):[[h[0][0],h[0][1]],[h[1][0],h[1][1]]]},m.constrain=function(t){return arguments.length?(o=t,m):o},m.duration=function(t){return arguments.length?(u=+t,m):u},m.interpolate=function(t){return arguments.length?(c=t,m):c},m.on=function(){var t=d.on.apply(d,arguments);return t===d?m:t},m.clickDistance=function(t){return arguments.length?(f=(t*=1)*t,m):Math.sqrt(f)},m.tapDistance=function(t){return arguments.length?(p=+t,m):p},m}ez.prototype;const eW=t=>"string"==typeof t,eY=()=>{let t,e,n=new Promise((n,i)=>{t=n,e=i});return n.resolve=t,n.reject=e,n},eX=t=>null==t?"":""+t,eJ=(t,e,n)=>{t.forEach(t=>{e[t]&&(n[t]=e[t])})},eQ=/###/g,eZ=t=>t&&t.indexOf("###")>-1?t.replace(eQ,"."):t,e0=t=>!t||eW(t),e1=(t,e,n)=>{let i=eW(e)?e.split("."):e,r=0;for(;r<i.length-1;){if(e0(t))return{};let e=eZ(i[r]);!t[e]&&n&&(t[e]=new n),t=Object.prototype.hasOwnProperty.call(t,e)?t[e]:{},++r}return e0(t)?{}:{obj:t,k:eZ(i[r])}},e2=(t,e,n)=>{let{obj:i,k:r}=e1(t,e,Object);if(void 0!==i||1===e.length){i[r]=n;return}let o=e[e.length-1],s=e.slice(0,e.length-1),a=e1(t,s,Object);for(;void 0===a.obj&&s.length;)o=`${s[s.length-1]}.${o}`,a=e1(t,s=s.slice(0,s.length-1),Object),a?.obj&&void 0!==a.obj[`${a.k}.${o}`]&&(a.obj=void 0);a.obj[`${a.k}.${o}`]=n},e5=(t,e,n,i)=>{let{obj:r,k:o}=e1(t,e,Object);r[o]=r[o]||[],r[o].push(n)},e3=(t,e)=>{let{obj:n,k:i}=e1(t,e);if(n&&Object.prototype.hasOwnProperty.call(n,i))return n[i]},e4=(t,e,n)=>{let i=e3(t,n);return void 0!==i?i:e3(e,n)},e8=(t,e,n)=>{for(let i in e)"__proto__"!==i&&"constructor"!==i&&(i in t?eW(t[i])||t[i]instanceof String||eW(e[i])||e[i]instanceof String?n&&(t[i]=e[i]):e8(t[i],e[i],n):t[i]=e[i]);return t},e6=t=>t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var e9={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const e7=t=>eW(t)?t.replace(/[&<>"'\/]/g,t=>e9[t]):t,nt=[" ",",","?","!",";"],ne=new class{constructor(t){this.capacity=t,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(t){let e=this.regExpMap.get(t);if(void 0!==e)return e;let n=new RegExp(t);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(t,n),this.regExpQueue.push(t),n}}(20),nn=(t,e,n)=>{e=e||"",n=n||"";let i=nt.filter(t=>0>e.indexOf(t)&&0>n.indexOf(t));if(0===i.length)return!0;let r=ne.getRegExp(`(${i.map(t=>"?"===t?"\\?":t).join("|")})`),o=!r.test(t);if(!o){let e=t.indexOf(n);e>0&&!r.test(t.substring(0,e))&&(o=!0)}return o},ni=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";if(!t)return;if(t[e]){if(!Object.prototype.hasOwnProperty.call(t,e))return;return t[e]}let i=e.split(n),r=t;for(let t=0;t<i.length;){let e;if(!r||"object"!=typeof r)return;let o="";for(let s=t;s<i.length;++s)if(s!==t&&(o+=n),o+=i[s],void 0!==(e=r[o])){if(["string","number","boolean"].indexOf(typeof e)>-1&&s<i.length-1)continue;t+=s-t+1;break}r=e}return r},nr=t=>t?.replace("_","-"),no={type:"logger",log(t){this.output("log",t)},warn(t){this.output("warn",t)},error(t){this.output("error",t)},output(t,e){console?.[t]?.apply?.(console,e)}};class ns{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.init(t,e)}init(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=e.prefix||"i18next:",this.logger=t||no,this.options=e,this.debug=e.debug}log(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.forward(e,"log","",!0)}warn(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.forward(e,"warn","",!0)}error(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.forward(e,"error","")}deprecate(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.forward(e,"warn","WARNING DEPRECATED: ",!0)}forward(t,e,n,i){return i&&!this.debug?null:(eW(t[0])&&(t[0]=`${n}${this.prefix} ${t[0]}`),this.logger[e](t))}create(t){return new ns(this.logger,{prefix:`${this.prefix}:${t}:`,...this.options})}clone(t){return(t=t||this.options).prefix=t.prefix||this.prefix,new ns(this.logger,t)}}var na=new ns;class nl{constructor(){this.observers={}}on(t,e){return t.split(" ").forEach(t=>{this.observers[t]||(this.observers[t]=new Map);let n=this.observers[t].get(e)||0;this.observers[t].set(e,n+1)}),this}off(t,e){if(this.observers[t]){if(!e){delete this.observers[t];return}this.observers[t].delete(e)}}emit(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];this.observers[t]&&Array.from(this.observers[t].entries()).forEach(t=>{let[e,i]=t;for(let t=0;t<i;t++)e(...n)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(e=>{let[i,r]=e;for(let e=0;e<r;e++)i.apply(i,[t,...n])})}}class nh extends nl{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=t||{},this.options=e,void 0===this.options.keySeparator&&(this.options.keySeparator="."),void 0===this.options.ignoreJSONStructure&&(this.options.ignoreJSONStructure=!0)}addNamespaces(t){0>this.options.ns.indexOf(t)&&this.options.ns.push(t)}removeNamespaces(t){let e=this.options.ns.indexOf(t);e>-1&&this.options.ns.splice(e,1)}getResource(t,e,n){let i,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=void 0!==r.keySeparator?r.keySeparator:this.options.keySeparator,s=void 0!==r.ignoreJSONStructure?r.ignoreJSONStructure:this.options.ignoreJSONStructure;t.indexOf(".")>-1?i=t.split("."):(i=[t,e],n&&(Array.isArray(n)?i.push(...n):eW(n)&&o?i.push(...n.split(o)):i.push(n)));let a=e3(this.data,i);return(!a&&!e&&!n&&t.indexOf(".")>-1&&(t=i[0],e=i[1],n=i.slice(2).join(".")),!a&&s&&eW(n))?ni(this.data?.[t]?.[e],n,o):a}addResource(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1},o=void 0!==r.keySeparator?r.keySeparator:this.options.keySeparator,s=[t,e];n&&(s=s.concat(o?n.split(o):n)),t.indexOf(".")>-1&&(s=t.split("."),i=e,e=s[1]),this.addNamespaces(e),e2(this.data,s,i),r.silent||this.emit("added",t,e,n,i)}addResources(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(let i in n)(eW(n[i])||Array.isArray(n[i]))&&this.addResource(t,e,i,n[i],{silent:!0});i.silent||this.emit("added",t,e,n)}addResourceBundle(t,e,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1,skipCopy:!1},s=[t,e];t.indexOf(".")>-1&&(s=t.split("."),i=n,n=e,e=s[1]),this.addNamespaces(e);let a=e3(this.data,s)||{};o.skipCopy||(n=JSON.parse(JSON.stringify(n))),i?e8(a,n,r):a={...a,...n},e2(this.data,s,a),o.silent||this.emit("added",t,e,n)}removeResourceBundle(t,e){this.hasResourceBundle(t,e)&&delete this.data[t][e],this.removeNamespaces(e),this.emit("removed",t,e)}hasResourceBundle(t,e){return void 0!==this.getResource(t,e)}getResourceBundle(t,e){return e||(e=this.options.defaultNS),this.getResource(t,e)}getDataByLanguage(t){return this.data[t]}hasLanguageSomeTranslations(t){let e=this.getDataByLanguage(t);return!!(e&&Object.keys(e)||[]).find(t=>e[t]&&Object.keys(e[t]).length>0)}toJSON(){return this.data}}var nu={processors:{},addPostProcessor(t){this.processors[t.name]=t},handle(t,e,n,i,r){return t.forEach(t=>{e=this.processors[t]?.process(e,n,i,r)??e}),e}};const nc={},nd=t=>!eW(t)&&"boolean"!=typeof t&&"number"!=typeof t;class nf extends nl{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),eJ(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],t,this),this.options=e,void 0===this.options.keySeparator&&(this.options.keySeparator="."),this.logger=na.create("translator")}changeLanguage(t){t&&(this.language=t)}exists(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};if(null==t)return!1;let n=this.resolve(t,e);return n?.res!==void 0}extractFromKey(t,e){let n=void 0!==e.nsSeparator?e.nsSeparator:this.options.nsSeparator;void 0===n&&(n=":");let i=void 0!==e.keySeparator?e.keySeparator:this.options.keySeparator,r=e.ns||this.options.defaultNS||[],o=n&&t.indexOf(n)>-1,s=!this.options.userDefinedKeySeparator&&!e.keySeparator&&!this.options.userDefinedNsSeparator&&!e.nsSeparator&&!nn(t,n,i);if(o&&!s){let e=t.match(this.interpolator.nestingRegexp);if(e&&e.length>0)return{key:t,namespaces:eW(r)?[r]:r};let o=t.split(n);(n!==i||n===i&&this.options.ns.indexOf(o[0])>-1)&&(r=o.shift()),t=o.join(i)}return{key:t,namespaces:eW(r)?[r]:r}}translate(t,e,n){if("object"!=typeof e&&this.options.overloadTranslationOptionHandler&&(e=this.options.overloadTranslationOptionHandler(arguments)),"object"==typeof e&&(e={...e}),e||(e={}),null==t)return"";Array.isArray(t)||(t=[String(t)]);let i=void 0!==e.returnDetails?e.returnDetails:this.options.returnDetails,r=void 0!==e.keySeparator?e.keySeparator:this.options.keySeparator,{key:o,namespaces:s}=this.extractFromKey(t[t.length-1],e),a=s[s.length-1],l=e.lng||this.language,h=e.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(l?.toLowerCase()==="cimode"){if(h){let t=e.nsSeparator||this.options.nsSeparator;return i?{res:`${a}${t}${o}`,usedKey:o,exactUsedKey:o,usedLng:l,usedNS:a,usedParams:this.getUsedParamsDetails(e)}:`${a}${t}${o}`}return i?{res:o,usedKey:o,exactUsedKey:o,usedLng:l,usedNS:a,usedParams:this.getUsedParamsDetails(e)}:o}let u=this.resolve(t,e),c=u?.res,d=u?.usedKey||o,f=u?.exactUsedKey||o,p=void 0!==e.joinArrays?e.joinArrays:this.options.joinArrays,g=!this.i18nFormat||this.i18nFormat.handleAsObject,m=void 0!==e.count&&!eW(e.count),y=nf.hasDefaultValue(e),v=m?this.pluralResolver.getSuffix(l,e.count,e):"",x=e.ordinal&&m?this.pluralResolver.getSuffix(l,e.count,{ordinal:!1}):"",_=m&&!e.ordinal&&0===e.count,b=_&&e[`defaultValue${this.options.pluralSeparator}zero`]||e[`defaultValue${v}`]||e[`defaultValue${x}`]||e.defaultValue,w=c;g&&!c&&y&&(w=b);let k=nd(w),S=Object.prototype.toString.apply(w);if(g&&w&&k&&0>["[object Number]","[object Function]","[object RegExp]"].indexOf(S)&&!(eW(p)&&Array.isArray(w))){if(!e.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");let t=this.options.returnedObjectHandler?this.options.returnedObjectHandler(d,w,{...e,ns:s}):`key '${o} (${this.language})' returned an object instead of string.`;return i?(u.res=t,u.usedParams=this.getUsedParamsDetails(e),u):t}if(r){let t=Array.isArray(w),n=t?[]:{},i=t?f:d;for(let t in w)if(Object.prototype.hasOwnProperty.call(w,t)){let o=`${i}${r}${t}`;y&&!c?n[t]=this.translate(o,{...e,defaultValue:nd(b)?b[t]:void 0,joinArrays:!1,ns:s}):n[t]=this.translate(o,{...e,joinArrays:!1,ns:s}),n[t]===o&&(n[t]=w[t])}c=n}}else if(g&&eW(p)&&Array.isArray(c))(c=c.join(p))&&(c=this.extendTranslation(c,t,e,n));else{let i=!1,s=!1;!this.isValidLookup(c)&&y&&(i=!0,c=b),this.isValidLookup(c)||(s=!0,c=o);let h=(e.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&s?void 0:c,d=y&&b!==c&&this.options.updateMissing;if(s||i||d){if(this.logger.log(d?"updateKey":"missingKey",l,a,o,d?b:c),r){let t=this.resolve(o,{...e,keySeparator:!1});t&&t.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let t=[],n=this.languageUtils.getFallbackCodes(this.options.fallbackLng,e.lng||this.language);if("fallback"===this.options.saveMissingTo&&n&&n[0])for(let e=0;e<n.length;e++)t.push(n[e]);else"all"===this.options.saveMissingTo?t=this.languageUtils.toResolveHierarchy(e.lng||this.language):t.push(e.lng||this.language);let i=(t,n,i)=>{let r=y&&i!==c?i:h;this.options.missingKeyHandler?this.options.missingKeyHandler(t,a,n,r,d,e):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(t,a,n,r,d,e),this.emit("missingKey",t,a,n,c)};this.options.saveMissing&&(this.options.saveMissingPlurals&&m?t.forEach(t=>{let n=this.pluralResolver.getSuffixes(t,e);_&&e[`defaultValue${this.options.pluralSeparator}zero`]&&0>n.indexOf(`${this.options.pluralSeparator}zero`)&&n.push(`${this.options.pluralSeparator}zero`),n.forEach(n=>{i([t],o+n,e[`defaultValue${n}`]||b)})}):i(t,o,b))}c=this.extendTranslation(c,t,e,u,n),s&&c===o&&this.options.appendNamespaceToMissingKey&&(c=`${a}:${o}`),(s||i)&&this.options.parseMissingKeyHandler&&(c=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${a}:${o}`:o,i?c:void 0))}return i?(u.res=c,u.usedParams=this.getUsedParamsDetails(e),u):c}extendTranslation(t,e,n,i,r){var o=this;if(this.i18nFormat?.parse)t=this.i18nFormat.parse(t,{...this.options.interpolation.defaultVariables,...n},n.lng||this.language||i.usedLng,i.usedNS,i.usedKey,{resolved:i});else if(!n.skipInterpolation){let s;n.interpolation&&this.interpolator.init({...n,interpolation:{...this.options.interpolation,...n.interpolation}});let a=eW(t)&&(n?.interpolation?.skipOnVariables!==void 0?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);if(a){let e=t.match(this.interpolator.nestingRegexp);s=e&&e.length}let l=n.replace&&!eW(n.replace)?n.replace:n;if(this.options.interpolation.defaultVariables&&(l={...this.options.interpolation.defaultVariables,...l}),t=this.interpolator.interpolate(t,l,n.lng||this.language||i.usedLng,n),a){let e=t.match(this.interpolator.nestingRegexp);s<(e&&e.length)&&(n.nest=!1)}!n.lng&&i&&i.res&&(n.lng=this.language||i.usedLng),!1!==n.nest&&(t=this.interpolator.nest(t,function(){for(var t=arguments.length,i=Array(t),s=0;s<t;s++)i[s]=arguments[s];return r?.[0]!==i[0]||n.context?o.translate(...i,e):(o.logger.warn(`It seems you are nesting recursively key: ${i[0]} in key: ${e[0]}`),null)},n)),n.interpolation&&this.interpolator.reset()}let s=n.postProcess||this.options.postProcess,a=eW(s)?[s]:s;return null!=t&&a?.length&&!1!==n.applyPostProcessor&&(t=nu.handle(a,t,e,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...i,usedParams:this.getUsedParamsDetails(n)},...n}:n,this)),t}resolve(t){let e,n,i,r,o,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return eW(t)&&(t=[t]),t.forEach(t=>{if(this.isValidLookup(e))return;let a=this.extractFromKey(t,s),l=a.key;n=l;let h=a.namespaces;this.options.fallbackNS&&(h=h.concat(this.options.fallbackNS));let u=void 0!==s.count&&!eW(s.count),c=u&&!s.ordinal&&0===s.count,d=void 0!==s.context&&(eW(s.context)||"number"==typeof s.context)&&""!==s.context,f=s.lngs?s.lngs:this.languageUtils.toResolveHierarchy(s.lng||this.language,s.fallbackLng);h.forEach(t=>{this.isValidLookup(e)||(o=t,!nc[`${f[0]}-${t}`]&&this.utils?.hasLoadedNamespace&&!this.utils?.hasLoadedNamespace(o)&&(nc[`${f[0]}-${t}`]=!0,this.logger.warn(`key "${n}" for languages "${f.join(", ")}" won't get resolved as namespace "${o}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),f.forEach(n=>{let o;if(this.isValidLookup(e))return;r=n;let a=[l];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(a,l,n,t,s);else{let t;u&&(t=this.pluralResolver.getSuffix(n,s.count,s));let e=`${this.options.pluralSeparator}zero`,i=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(u&&(a.push(l+t),s.ordinal&&0===t.indexOf(i)&&a.push(l+t.replace(i,this.options.pluralSeparator)),c&&a.push(l+e)),d){let n=`${l}${this.options.contextSeparator}${s.context}`;a.push(n),u&&(a.push(n+t),s.ordinal&&0===t.indexOf(i)&&a.push(n+t.replace(i,this.options.pluralSeparator)),c&&a.push(n+e))}}for(;o=a.pop();)this.isValidLookup(e)||(i=o,e=this.getResource(n,t,o,s))}))})}),{res:e,usedKey:n,exactUsedKey:i,usedLng:r,usedNS:o}}isValidLookup(t){return void 0!==t&&!(!this.options.returnNull&&null===t)&&!(!this.options.returnEmptyString&&""===t)}getResource(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.i18nFormat?.getResource?this.i18nFormat.getResource(t,e,n,i):this.resourceStore.getResource(t,e,n,i)}getUsedParamsDetails(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.replace&&!eW(t.replace),n=e?t.replace:t;if(e&&void 0!==t.count&&(n.count=t.count),this.options.interpolation.defaultVariables&&(n={...this.options.interpolation.defaultVariables,...n}),!e)for(let t of(n={...n},["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"]))delete n[t];return n}static hasDefaultValue(t){let e="defaultValue";for(let n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&e===n.substring(0,e.length)&&void 0!==t[n])return!0;return!1}}class np{constructor(t){this.options=t,this.supportedLngs=this.options.supportedLngs||!1,this.logger=na.create("languageUtils")}getScriptPartFromCode(t){if(!(t=nr(t))||0>t.indexOf("-"))return null;let e=t.split("-");return 2===e.length?null:(e.pop(),"x"===e[e.length-1].toLowerCase())?null:this.formatLanguageCode(e.join("-"))}getLanguagePartFromCode(t){if(!(t=nr(t))||0>t.indexOf("-"))return t;let e=t.split("-");return this.formatLanguageCode(e[0])}formatLanguageCode(t){if(eW(t)&&t.indexOf("-")>-1){let e;try{e=Intl.getCanonicalLocales(t)[0]}catch(t){}return(e&&this.options.lowerCaseLng&&(e=e.toLowerCase()),e)?e:this.options.lowerCaseLng?t.toLowerCase():t}return this.options.cleanCode||this.options.lowerCaseLng?t.toLowerCase():t}isSupportedCode(t){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(t=this.getLanguagePartFromCode(t)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(t)>-1}getBestMatchFromCodes(t){let e;return t?(t.forEach(t=>{if(e)return;let n=this.formatLanguageCode(t);(!this.options.supportedLngs||this.isSupportedCode(n))&&(e=n)}),!e&&this.options.supportedLngs&&t.forEach(t=>{if(e)return;let n=this.getLanguagePartFromCode(t);if(this.isSupportedCode(n))return e=n;e=this.options.supportedLngs.find(t=>{if(t===n||!(0>t.indexOf("-")&&0>n.indexOf("-"))&&(t.indexOf("-")>0&&0>n.indexOf("-")&&t.substring(0,t.indexOf("-"))===n||0===t.indexOf(n)&&n.length>1))return t})}),e||(e=this.getFallbackCodes(this.options.fallbackLng)[0]),e):null}getFallbackCodes(t,e){if(!t)return[];if("function"==typeof t&&(t=t(e)),eW(t)&&(t=[t]),Array.isArray(t))return t;if(!e)return t.default||[];let n=t[e];return n||(n=t[this.getScriptPartFromCode(e)]),n||(n=t[this.formatLanguageCode(e)]),n||(n=t[this.getLanguagePartFromCode(e)]),n||(n=t.default),n||[]}toResolveHierarchy(t,e){let n=this.getFallbackCodes(e||this.options.fallbackLng||[],t),i=[],r=t=>{t&&(this.isSupportedCode(t)?i.push(t):this.logger.warn(`rejecting language code not found in supportedLngs: ${t}`))};return eW(t)&&(t.indexOf("-")>-1||t.indexOf("_")>-1)?("languageOnly"!==this.options.load&&r(this.formatLanguageCode(t)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&r(this.getScriptPartFromCode(t)),"currentOnly"!==this.options.load&&r(this.getLanguagePartFromCode(t))):eW(t)&&r(this.formatLanguageCode(t)),n.forEach(t=>{0>i.indexOf(t)&&r(this.formatLanguageCode(t))}),i}}const ng={zero:0,one:1,two:2,few:3,many:4,other:5},nm={select:t=>1===t?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class ny{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.languageUtils=t,this.options=e,this.logger=na.create("pluralResolver"),this.pluralRulesCache={}}addRule(t,e){this.rules[t]=e}clearCache(){this.pluralRulesCache={}}getRule(t){let e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=nr("dev"===t?"en":t),r=n.ordinal?"ordinal":"cardinal",o=JSON.stringify({cleanedCode:i,type:r});if(o in this.pluralRulesCache)return this.pluralRulesCache[o];try{e=new Intl.PluralRules(i,{type:r})}catch(r){if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),nm;if(!t.match(/-|_/))return nm;let i=this.languageUtils.getLanguagePartFromCode(t);e=this.getRule(i,n)}return this.pluralRulesCache[o]=e,e}needsPlural(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getRule(t,e);return n||(n=this.getRule("dev",e)),n?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.getSuffixes(t,n).map(t=>`${e}${t}`)}getSuffixes(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getRule(t,e);return(n||(n=this.getRule("dev",e)),n)?n.resolvedOptions().pluralCategories.sort((t,e)=>ng[t]-ng[e]).map(t=>`${this.options.prepend}${e.ordinal?`ordinal${this.options.prepend}`:""}${t}`):[]}getSuffix(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=this.getRule(t,n);return i?`${this.options.prepend}${n.ordinal?`ordinal${this.options.prepend}`:""}${i.select(e)}`:(this.logger.warn(`no plural rule found for: ${t}`),this.getSuffix("dev",e,n))}}const nv=function(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:".",r=!(arguments.length>4)||void 0===arguments[4]||arguments[4],o=e4(t,e,n);return!o&&r&&eW(n)&&void 0===(o=ni(t,n,i))&&(o=ni(e,n,i)),o},nx=t=>t.replace(/\$/g,"$$$$");class n_{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=na.create("interpolator"),this.options=t,this.format=t?.interpolation?.format||(t=>t),this.init(t)}init(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.interpolation||(t.interpolation={escapeValue:!0});let{escape:e,escapeValue:n,useRawValueToEscape:i,prefix:r,prefixEscaped:o,suffix:s,suffixEscaped:a,formatSeparator:l,unescapeSuffix:h,unescapePrefix:u,nestingPrefix:c,nestingPrefixEscaped:d,nestingSuffix:f,nestingSuffixEscaped:p,nestingOptionsSeparator:g,maxReplaces:m,alwaysFormat:y}=t.interpolation;this.escape=void 0!==e?e:e7,this.escapeValue=void 0===n||n,this.useRawValueToEscape=void 0!==i&&i,this.prefix=r?e6(r):o||"{{",this.suffix=s?e6(s):a||"}}",this.formatSeparator=l||",",this.unescapePrefix=h?"":u||"-",this.unescapeSuffix=this.unescapePrefix?"":h||"",this.nestingPrefix=c?e6(c):d||e6("$t("),this.nestingSuffix=f?e6(f):p||e6(")"),this.nestingOptionsSeparator=g||",",this.maxReplaces=m||1e3,this.alwaysFormat=void 0!==y&&y,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){let t=(t,e)=>t?.source===e?(t.lastIndex=0,t):RegExp(e,"g");this.regexp=t(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=t(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=t(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(t,e,n,i){let r,o,s,a=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},l=t=>{if(0>t.indexOf(this.formatSeparator)){let r=nv(e,a,t,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(r,void 0,n,{...i,...e,interpolationkey:t}):r}let r=t.split(this.formatSeparator),o=r.shift().trim(),s=r.join(this.formatSeparator).trim();return this.format(nv(e,a,o,this.options.keySeparator,this.options.ignoreJSONStructure),s,n,{...i,...e,interpolationkey:o})};this.resetRegExp();let h=i?.missingInterpolationHandler||this.options.missingInterpolationHandler,u=i?.interpolation?.skipOnVariables!==void 0?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:t=>nx(t)},{regex:this.regexp,safeValue:t=>this.escapeValue?nx(this.escape(t)):nx(t)}].forEach(e=>{for(s=0;r=e.regex.exec(t);){let n=r[1].trim();if(void 0===(o=l(n)))if("function"==typeof h){let e=h(t,r,i);o=eW(e)?e:""}else if(i&&Object.prototype.hasOwnProperty.call(i,n))o="";else if(u){o=r[0];continue}else this.logger.warn(`missed to pass in variable ${n} for interpolating ${t}`),o="";else eW(o)||this.useRawValueToEscape||(o=eX(o));let a=e.safeValue(o);if(t=t.replace(r[0],a),u?(e.regex.lastIndex+=o.length,e.regex.lastIndex-=r[0].length):e.regex.lastIndex=0,++s>=this.maxReplaces)break}}),t}nest(t,e){let n,i,r,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=(t,e)=>{let n=this.nestingOptionsSeparator;if(0>t.indexOf(n))return t;let i=t.split(RegExp(`${n}[ ]*{`)),o=`{${i[1]}`;t=i[0];let s=(o=this.interpolate(o,r)).match(/'/g),a=o.match(/"/g);((s?.length??0)%2!=0||a)&&a.length%2==0||(o=o.replace(/'/g,'"'));try{r=JSON.parse(o),e&&(r={...e,...r})}catch(e){return this.logger.warn(`failed parsing options string in nesting for key ${t}`,e),`${t}${n}${o}`}return r.defaultValue&&r.defaultValue.indexOf(this.prefix)>-1&&delete r.defaultValue,t};for(;n=this.nestingRegexp.exec(t);){let a=[];(r=(r={...o}).replace&&!eW(r.replace)?r.replace:r).applyPostProcessor=!1,delete r.defaultValue;let l=!1;if(-1!==n[0].indexOf(this.formatSeparator)&&!/{.*}/.test(n[1])){let t=n[1].split(this.formatSeparator).map(t=>t.trim());n[1]=t.shift(),a=t,l=!0}if((i=e(s.call(this,n[1].trim(),r),r))&&n[0]===t&&!eW(i))return i;eW(i)||(i=eX(i)),i||(this.logger.warn(`missed to resolve ${n[1]} for nesting ${t}`),i=""),l&&(i=a.reduce((t,e)=>this.format(t,e,o.lng,{...o,interpolationkey:n[1].trim()}),i.trim())),t=t.replace(n[0],i),this.regexp.lastIndex=0}return t}}const nb=t=>{let e=t.toLowerCase().trim(),n={};if(t.indexOf("(")>-1){let i=t.split("(");e=i[0].toLowerCase().trim();let r=i[1].substring(0,i[1].length-1);"currency"===e&&0>r.indexOf(":")?n.currency||(n.currency=r.trim()):"relativetime"===e&&0>r.indexOf(":")?n.range||(n.range=r.trim()):r.split(";").forEach(t=>{if(t){let[e,...i]=t.split(":"),r=i.join(":").trim().replace(/^'+|'+$/g,""),o=e.trim();n[o]||(n[o]=r),"false"===r&&(n[o]=!1),"true"===r&&(n[o]=!0),isNaN(r)||(n[o]=parseInt(r,10))}})}return{formatName:e,formatOptions:n}},nw=t=>{let e={};return(n,i,r)=>{let o=r;r&&r.interpolationkey&&r.formatParams&&r.formatParams[r.interpolationkey]&&r[r.interpolationkey]&&(o={...o,[r.interpolationkey]:void 0});let s=i+JSON.stringify(o),a=e[s];return a||(a=t(nr(i),r),e[s]=a),a(n)}};class nk{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=na.create("formatter"),this.options=t,this.formats={number:nw((t,e)=>{let n=new Intl.NumberFormat(t,{...e});return t=>n.format(t)}),currency:nw((t,e)=>{let n=new Intl.NumberFormat(t,{...e,style:"currency"});return t=>n.format(t)}),datetime:nw((t,e)=>{let n=new Intl.DateTimeFormat(t,{...e});return t=>n.format(t)}),relativetime:nw((t,e)=>{let n=new Intl.RelativeTimeFormat(t,{...e});return t=>n.format(t,e.range||"day")}),list:nw((t,e)=>{let n=new Intl.ListFormat(t,{...e});return t=>n.format(t)})},this.init(t)}init(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};this.formatSeparator=e.interpolation.formatSeparator||","}add(t,e){this.formats[t.toLowerCase().trim()]=e}addCached(t,e){this.formats[t.toLowerCase().trim()]=nw(e)}format(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=e.split(this.formatSeparator);if(r.length>1&&r[0].indexOf("(")>1&&0>r[0].indexOf(")")&&r.find(t=>t.indexOf(")")>-1)){let t=r.findIndex(t=>t.indexOf(")")>-1);r[0]=[r[0],...r.splice(1,t)].join(this.formatSeparator)}return r.reduce((t,e)=>{let{formatName:r,formatOptions:o}=nb(e);if(this.formats[r]){let e=t;try{let s=i?.formatParams?.[i.interpolationkey]||{},a=s.locale||s.lng||i.locale||i.lng||n;e=this.formats[r](t,a,{...o,...i,...s})}catch(t){this.logger.warn(t)}return e}return this.logger.warn(`there was no format function for ${r}`),t},t)}}const nS=(t,e)=>{void 0!==t.pending[e]&&(delete t.pending[e],t.pendingCount--)};class nE extends nl{constructor(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(),this.backend=t,this.store=e,this.services=n,this.languageUtils=n.languageUtils,this.options=i,this.logger=na.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=i.maxParallelReads||10,this.readingCalls=0,this.maxRetries=i.maxRetries>=0?i.maxRetries:5,this.retryTimeout=i.retryTimeout>=1?i.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(n,i.backend,i)}queueLoad(t,e,n,i){let r={},o={},s={},a={};return t.forEach(t=>{let i=!0;e.forEach(e=>{let s=`${t}|${e}`;!n.reload&&this.store.hasResourceBundle(t,e)?this.state[s]=2:this.state[s]<0||(1===this.state[s]?void 0===o[s]&&(o[s]=!0):(this.state[s]=1,i=!1,void 0===o[s]&&(o[s]=!0),void 0===r[s]&&(r[s]=!0),void 0===a[e]&&(a[e]=!0)))}),i||(s[t]=!0)}),(Object.keys(r).length||Object.keys(o).length)&&this.queue.push({pending:o,pendingCount:Object.keys(o).length,loaded:{},errors:[],callback:i}),{toLoad:Object.keys(r),pending:Object.keys(o),toLoadLanguages:Object.keys(s),toLoadNamespaces:Object.keys(a)}}loaded(t,e,n){let i=t.split("|"),r=i[0],o=i[1];e&&this.emit("failedLoading",r,o,e),!e&&n&&this.store.addResourceBundle(r,o,n,void 0,void 0,{skipCopy:!0}),this.state[t]=e?-1:2,e&&n&&(this.state[t]=0);let s={};this.queue.forEach(n=>{e5(n.loaded,[r],o),nS(n,t),e&&n.errors.push(e),0!==n.pendingCount||n.done||(Object.keys(n.loaded).forEach(t=>{s[t]||(s[t]={});let e=n.loaded[t];e.length&&e.forEach(e=>{void 0===s[t][e]&&(s[t][e]=!0)})}),n.done=!0,n.errors.length?n.callback(n.errors):n.callback())}),this.emit("loaded",s),this.queue=this.queue.filter(t=>!t.done)}read(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.retryTimeout,o=arguments.length>5?arguments[5]:void 0;if(!t.length)return o(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:t,ns:e,fcName:n,tried:i,wait:r,callback:o});return}this.readingCalls++;let s=(s,a)=>{if(this.readingCalls--,this.waitingReads.length>0){let t=this.waitingReads.shift();this.read(t.lng,t.ns,t.fcName,t.tried,t.wait,t.callback)}if(s&&a&&i<this.maxRetries){setTimeout(()=>{this.read.call(this,t,e,n,i+1,2*r,o)},r);return}o(s,a)},a=this.backend[n].bind(this.backend);if(2===a.length){try{let n=a(t,e);n&&"function"==typeof n.then?n.then(t=>s(null,t)).catch(s):s(null,n)}catch(t){s(t)}return}return a(t,e,s)}prepareLoading(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),i&&i();eW(t)&&(t=this.languageUtils.toResolveHierarchy(t)),eW(e)&&(e=[e]);let r=this.queueLoad(t,e,n,i);if(!r.toLoad.length)return r.pending.length||i(),null;r.toLoad.forEach(t=>{this.loadOne(t)})}load(t,e,n){this.prepareLoading(t,e,{},n)}reload(t,e,n){this.prepareLoading(t,e,{reload:!0},n)}loadOne(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=t.split("|"),i=n[0],r=n[1];this.read(i,r,"read",void 0,void 0,(n,o)=>{n&&this.logger.warn(`${e}loading namespace ${r} for language ${i} failed`,n),!n&&o&&this.logger.log(`${e}loaded namespace ${r} for language ${i}`,o),this.loaded(t,n,o)})}saveMissing(t,e,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:()=>{};if(this.services?.utils?.hasLoadedNamespace&&!this.services?.utils?.hasLoadedNamespace(e)){this.logger.warn(`did not save key "${n}" as the namespace "${e}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(null!=n&&""!==n){if(this.backend?.create){let a={...o,isUpdate:r},l=this.backend.create.bind(this.backend);if(l.length<6)try{let r;(r=5===l.length?l(t,e,n,i,a):l(t,e,n,i))&&"function"==typeof r.then?r.then(t=>s(null,t)).catch(s):s(null,r)}catch(t){s(t)}else l(t,e,n,i,s,a)}t&&t[0]&&this.store.addResource(t[0],e,n,i)}}}const n$=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:t=>{let e={};if("object"==typeof t[1]&&(e=t[1]),eW(t[1])&&(e.defaultValue=t[1]),eW(t[2])&&(e.tDescription=t[2]),"object"==typeof t[2]||"object"==typeof t[3]){let n=t[3]||t[2];Object.keys(n).forEach(t=>{e[t]=n[t]})}return e},interpolation:{escapeValue:!0,format:t=>t,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),nC=t=>(eW(t.ns)&&(t.ns=[t.ns]),eW(t.fallbackLng)&&(t.fallbackLng=[t.fallbackLng]),eW(t.fallbackNS)&&(t.fallbackNS=[t.fallbackNS]),t.supportedLngs?.indexOf?.("cimode")<0&&(t.supportedLngs=t.supportedLngs.concat(["cimode"])),"boolean"==typeof t.initImmediate&&(t.initAsync=t.initImmediate),t),nO=()=>{},nL=t=>{Object.getOwnPropertyNames(Object.getPrototypeOf(t)).forEach(e=>{"function"==typeof t[e]&&(t[e]=t[e].bind(t))})};class nR extends nl{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;if(super(),this.options=nC(t),this.services={},this.logger=na,this.modules={external:[]},nL(this),e&&!this.isInitialized&&!t.isClone){if(!this.options.initAsync)return this.init(t,e),this;setTimeout(()=>{this.init(t,e)},0)}}init(){var t=this;let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,"function"==typeof e&&(n=e,e={}),null==e.defaultNS&&e.ns&&(eW(e.ns)?e.defaultNS=e.ns:0>e.ns.indexOf("translation")&&(e.defaultNS=e.ns[0]));let i=n$();this.options={...i,...this.options,...nC(e)},this.options.interpolation={...i.interpolation,...this.options.interpolation},void 0!==e.keySeparator&&(this.options.userDefinedKeySeparator=e.keySeparator),void 0!==e.nsSeparator&&(this.options.userDefinedNsSeparator=e.nsSeparator);let r=t=>t?"function"==typeof t?new t:t:null;if(!this.options.isClone){let e;this.modules.logger?na.init(r(this.modules.logger),this.options):na.init(null,this.options),e=this.modules.formatter?this.modules.formatter:nk;let n=new np(this.options);this.store=new nh(this.options.resources,this.options);let o=this.services;o.logger=na,o.resourceStore=this.store,o.languageUtils=n,o.pluralResolver=new ny(n,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),e&&(!this.options.interpolation.format||this.options.interpolation.format===i.interpolation.format)&&(o.formatter=r(e),o.formatter.init(o,this.options),this.options.interpolation.format=o.formatter.format.bind(o.formatter)),o.interpolator=new n_(this.options),o.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},o.backendConnector=new nE(r(this.modules.backend),o.resourceStore,o,this.options),o.backendConnector.on("*",function(e){for(var n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];t.emit(e,...i)}),this.modules.languageDetector&&(o.languageDetector=r(this.modules.languageDetector),o.languageDetector.init&&o.languageDetector.init(o,this.options.detection,this.options)),this.modules.i18nFormat&&(o.i18nFormat=r(this.modules.i18nFormat),o.i18nFormat.init&&o.i18nFormat.init(this)),this.translator=new nf(this.services,this.options),this.translator.on("*",function(e){for(var n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];t.emit(e,...i)}),this.modules.external.forEach(t=>{t.init&&t.init(this)})}if(this.format=this.options.interpolation.format,n||(n=nO),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){let t=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);t.length>0&&"dev"!==t[0]&&(this.options.lng=t[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(e=>{this[e]=function(){return t.store[e](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(e=>{this[e]=function(){return t.store[e](...arguments),t}});let o=eY(),s=()=>{let t=(t,e)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),o.resolve(e),n(t,e)};if(this.languages&&!this.isInitialized)return t(null,this.t.bind(this));this.changeLanguage(this.options.lng,t)};return this.options.resources||!this.options.initAsync?s():setTimeout(s,0),o}loadResources(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nO,n=e,i=eW(t)?t:this.language;if("function"==typeof t&&(n=t),!this.options.resources||this.options.partialBundledLanguages){if(i?.toLowerCase()==="cimode"&&(!this.options.preload||0===this.options.preload.length))return n();let t=[],e=e=>{e&&"cimode"!==e&&this.services.languageUtils.toResolveHierarchy(e).forEach(e=>{"cimode"!==e&&0>t.indexOf(e)&&t.push(e)})};i?e(i):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(t=>e(t)),this.options.preload?.forEach?.(t=>e(t)),this.services.backendConnector.load(t,this.options.ns,t=>{t||this.resolvedLanguage||!this.language||this.setResolvedLanguage(this.language),n(t)})}else n(null)}reloadResources(t,e,n){let i=eY();return"function"==typeof t&&(n=t,t=void 0),"function"==typeof e&&(n=e,e=void 0),t||(t=this.languages),e||(e=this.options.ns),n||(n=nO),this.services.backendConnector.reload(t,e,t=>{i.resolve(),n(t)}),i}use(t){if(!t)throw Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!t.type)throw Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===t.type&&(this.modules.backend=t),("logger"===t.type||t.log&&t.warn&&t.error)&&(this.modules.logger=t),"languageDetector"===t.type&&(this.modules.languageDetector=t),"i18nFormat"===t.type&&(this.modules.i18nFormat=t),"postProcessor"===t.type&&nu.addPostProcessor(t),"formatter"===t.type&&(this.modules.formatter=t),"3rdParty"===t.type&&this.modules.external.push(t),this}setResolvedLanguage(t){if(t&&this.languages&&!(["cimode","dev"].indexOf(t)>-1))for(let t=0;t<this.languages.length;t++){let e=this.languages[t];if(!(["cimode","dev"].indexOf(e)>-1)&&this.store.hasLanguageSomeTranslations(e)){this.resolvedLanguage=e;break}}}changeLanguage(t,e){var n=this;this.isLanguageChangingTo=t;let i=eY();this.emit("languageChanging",t);let r=t=>{this.language=t,this.languages=this.services.languageUtils.toResolveHierarchy(t),this.resolvedLanguage=void 0,this.setResolvedLanguage(t)},o=(t,o)=>{o?(r(o),this.translator.changeLanguage(o),this.isLanguageChangingTo=void 0,this.emit("languageChanged",o),this.logger.log("languageChanged",o)):this.isLanguageChangingTo=void 0,i.resolve(function(){return n.t(...arguments)}),e&&e(t,function(){return n.t(...arguments)})},s=e=>{t||e||!this.services.languageDetector||(e=[]);let n=eW(e)?e:this.services.languageUtils.getBestMatchFromCodes(e);n&&(this.language||r(n),this.translator.language||this.translator.changeLanguage(n),this.services.languageDetector?.cacheUserLanguage?.(n)),this.loadResources(n,t=>{o(t,n)})};return t||!this.services.languageDetector||this.services.languageDetector.async?!t&&this.services.languageDetector&&this.services.languageDetector.async?0===this.services.languageDetector.detect.length?this.services.languageDetector.detect().then(s):this.services.languageDetector.detect(s):s(t):s(this.services.languageDetector.detect()),i}getFixedT(t,e,n){var i=this;let r=function(t,e){let o,s;if("object"!=typeof e){for(var a=arguments.length,l=Array(a>2?a-2:0),h=2;h<a;h++)l[h-2]=arguments[h];o=i.options.overloadTranslationOptionHandler([t,e].concat(l))}else o={...e};o.lng=o.lng||r.lng,o.lngs=o.lngs||r.lngs,o.ns=o.ns||r.ns,""!==o.keyPrefix&&(o.keyPrefix=o.keyPrefix||n||r.keyPrefix);let u=i.options.keySeparator||".";return s=o.keyPrefix&&Array.isArray(t)?t.map(t=>`${o.keyPrefix}${u}${t}`):o.keyPrefix?`${o.keyPrefix}${u}${t}`:t,i.t(s,o)};return eW(t)?r.lng=t:r.lngs=t,r.ns=e,r.keyPrefix=n,r}t(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.translator?.translate(...e)}exists(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.translator?.exists(...e)}setDefaultNamespace(t){this.options.defaultNS=t}hasLoadedNamespace(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;let n=e.lng||this.resolvedLanguage||this.languages[0],i=!!this.options&&this.options.fallbackLng,r=this.languages[this.languages.length-1];if("cimode"===n.toLowerCase())return!0;let o=(t,e)=>{let n=this.services.backendConnector.state[`${t}|${e}`];return -1===n||0===n||2===n};if(e.precheck){let t=e.precheck(this,o);if(void 0!==t)return t}return!!(this.hasResourceBundle(n,t)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||o(n,t)&&(!i||o(r,t)))}loadNamespaces(t,e){let n=eY();return this.options.ns?(eW(t)&&(t=[t]),t.forEach(t=>{0>this.options.ns.indexOf(t)&&this.options.ns.push(t)}),this.loadResources(t=>{n.resolve(),e&&e(t)}),n):(e&&e(),Promise.resolve())}loadLanguages(t,e){let n=eY();eW(t)&&(t=[t]);let i=this.options.preload||[],r=t.filter(t=>0>i.indexOf(t)&&this.services.languageUtils.isSupportedCode(t));return r.length?(this.options.preload=i.concat(r),this.loadResources(t=>{n.resolve(),e&&e(t)}),n):(e&&e(),Promise.resolve())}dir(t){return(t||(t=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),t)?["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf((this.services?.languageUtils||new np(n$())).getLanguagePartFromCode(t))>-1||t.toLowerCase().indexOf("-arab")>1?"rtl":"ltr":"rtl"}static createInstance(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;return new nR(t,e)}cloneInstance(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nO,n=t.forkResourceStore;n&&delete t.forkResourceStore;let i={...this.options,...t,isClone:!0},r=new nR(i);return(void 0!==t.debug||void 0!==t.prefix)&&(r.logger=r.logger.clone(t)),["store","services","language"].forEach(t=>{r[t]=this[t]}),r.services={...this.services},r.services.utils={hasLoadedNamespace:r.hasLoadedNamespace.bind(r)},n&&(r.store=new nh(Object.keys(this.store.data).reduce((t,e)=>(t[e]={...this.store.data[e]},Object.keys(t[e]).reduce((n,i)=>(n[i]={...t[e][i]},n),{})),{}),i),r.services.resourceStore=r.store),r.translator=new nf(r.services,i),r.translator.on("*",function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];r.emit(t,...n)}),r.init(i,e),r.translator.options=i,r.translator.backendConnector.services.utils={hasLoadedNamespace:r.hasLoadedNamespace.bind(r)},r}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const nA=nR.createInstance();nA.createInstance=nR.createInstance,nA.createInstance,nA.dir,nA.init,nA.loadResources,nA.reloadResources,nA.use,nA.changeLanguage,nA.getFixedT,nA.t,nA.exists,nA.setDefaultNamespace,nA.hasLoadedNamespace,nA.loadNamespaces,nA.loadLanguages;const{slice:nT,forEach:nP}=[],nN=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,nM=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{path:"/"},i=encodeURIComponent(e),r=`${t}=${i}`;if(n.maxAge>0){let t=n.maxAge-0;if(Number.isNaN(t))throw Error("maxAge should be a Number");r+=`; Max-Age=${Math.floor(t)}`}if(n.domain){if(!nN.test(n.domain))throw TypeError("option domain is invalid");r+=`; Domain=${n.domain}`}if(n.path){if(!nN.test(n.path))throw TypeError("option path is invalid");r+=`; Path=${n.path}`}if(n.expires){if("function"!=typeof n.expires.toUTCString)throw TypeError("option expires is invalid");r+=`; Expires=${n.expires.toUTCString()}`}if(n.httpOnly&&(r+="; HttpOnly"),n.secure&&(r+="; Secure"),n.sameSite)switch("string"==typeof n.sameSite?n.sameSite.toLowerCase():n.sameSite){case!0:case"strict":r+="; SameSite=Strict";break;case"lax":r+="; SameSite=Lax";break;case"none":r+="; SameSite=None";break;default:throw TypeError("option sameSite is invalid")}return r},nI={create(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{path:"/",sameSite:"strict"};n&&(r.expires=new Date,r.expires.setTime(r.expires.getTime()+6e4*n)),i&&(r.domain=i),document.cookie=nM(t,encodeURIComponent(e),r)},read(t){let e=`${t}=`,n=document.cookie.split(";");for(let t=0;t<n.length;t++){let i=n[t];for(;" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(e))return i.substring(e.length,i.length)}return null},remove(t){this.create(t,"",-1)}};let nz=null;const nF=()=>{if(null!==nz)return nz;try{if(!(nz="undefined"!=typeof window&&null!==window.localStorage))return!1;let t="i18next.translate.boo";window.localStorage.setItem(t,"foo"),window.localStorage.removeItem(t)}catch(t){nz=!1}return nz};let nD=null;const nj=()=>{if(null!==nD)return nD;try{if(!(nD="undefined"!=typeof window&&null!==window.sessionStorage))return!1;let t="i18next.translate.boo";window.sessionStorage.setItem(t,"foo"),window.sessionStorage.removeItem(t)}catch(t){nD=!1}return nD};let nB=!1;try{document.cookie,nB=!0}catch(t){}const nV=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];nB||nV.splice(1,1);function nU(t,e={}){try{return nA.t(t,e)}catch(e){return!function(t,e=null){console.log(`[i18n] ${t}`),e&&console.log(e)}(`Error translating key: ${t}`,e),t}}function nH(t,e=null){console.log(`[NodeRenderer] ${t}`),e&&console.log(e)}class nq{constructor(t){this.config=t,this.nodeWidth=220,this.nodeHeight=140,nH("Initialized NodeRenderer with config",t)}createNodes(t,e,n){nH("Creating nodes",{nodeCount:e.length}),t.selectAll(".node").data(e).enter().append("g").attr("class","node").attr("transform",t=>n?`translate(${t.y},${t.x})`:`translate(${t.x},${t.y})`).each((t,e,n)=>{let i=to(n[e]),r=t.data;"family-root"!==r.id&&this.createFamilyBox(i,r,t)})}createFamilyBox(t,e,n){let i,r;nH(`Creating family box for unit ${e.id}`);let o=e.person,s=e.spouse;if(!o){nH(`No person found for family unit ${e.id}`);return}"male"===o.gender?(i=o,r=s):(i=s,r=o);let a="";a=n.parent&&"family-root"!==n.parent.data.id?this.determineRelationClass(n,e):i&&!r?"male-node":!i&&r?"female-node":"couple-node";let l=this.nodeWidth,h=this.nodeHeight;t.append("rect").attr("x",-l/2).attr("y",-h/2).attr("width",l).attr("height",h).attr("class",`node-box ${a}`);let u=l/4,c=3*l/4,d=t.append("g").attr("class","photo-section").attr("transform",`translate(${-l/2+u/2}, 0)`);i&&r?d.append("g").attr("class","couple-silhouette").attr("transform","scale(0.5)").append("path").attr("d","M-25,-20 C-25,-30 -15,-40 -5,-40 C5,-40 15,-30 15,-20 C15,-10 5,0 -5,0 L-5,20 M15,-20 C15,-30 25,-40 35,-40 C45,-40 55,-30 55,-20 C55,-10 45,0 35,0 L35,20"):i?d.append("g").attr("class","male-silhouette").attr("transform","scale(2) translate(-15, -5)").append("path").attr("d","M15,-5 C17.761,-5 20,-2.761 20,0 C20,2.761 17.761,5 15,5 C12.239,5 10,2.761 10,0 C10,-2.761 12.239,-5 15,-5 Z M15,7 C10.029,7 6,11.029 6,16 L24,16 C24,11.029 19.971,7 15,7 Z"):r&&d.append("g").attr("class","female-silhouette").attr("transform","scale(2) translate(-15, -5)").append("path").attr("d","M15,-5 C17.761,-5 20,-2.761 20,0 C20,2.761 17.761,5 15,5 C12.239,5 10,2.761 10,0 C10,-2.761 12.239,-5 15,-5 Z M15,7 C10.029,7 6,11.029 6,16 L24,16 C24,11.029 19.971,7 15,7 Z");let f=t.append("g").attr("class","text-content").attr("transform",`translate(0, ${-h/2+16})`),p=0;if(i){let t=f.append("text").attr("class","name").attr("y",p).attr("text-anchor","middle").text(i.name||nU("unknown",{lng:this.config.language}));p+=16+(this.wrapText(t,c-20)-1)*16;let e="";if(i.birth_date&&"undefined"!==i.birth_date&&(e=i.birth_date,i.death_date&&"undefined"!==i.death_date&&(e+=` - ${i.death_date}`)),e){let t=f.append("text").attr("class","lifespan").attr("y",p).attr("text-anchor","middle").text(e);p+=14+(this.wrapText(t,c-20)-1)*14}else p+=6}if(r){i&&(f.append("line").attr("class","spouse-divider").attr("x1",-c/2+10).attr("y1",p-2).attr("x2",c/2-10).attr("y2",p-2),p+=12);let t=f.append("text").attr("class","spouse-name").attr("y",p).attr("text-anchor","middle").text(r.name||nU("unknown",{lng:this.config.language}));p+=16+(this.wrapText(t,c-20)-1)*16;let e="";if(r.birth_date&&"undefined"!==r.birth_date&&(e=r.birth_date,r.death_date&&"undefined"!==r.death_date&&(e+=` - ${r.death_date}`)),e){let t=f.append("text").attr("class","spouse-lifespan").attr("y",p).attr("text-anchor","middle").text(e);p+=14+(this.wrapText(t,c-20)-1)*14}else p+=6}}determineRelationClass(t,e){if(!t.parent||!t.parent.data||!t.parent.data.coupleInfo)return"couple-node";let n=t.parent.data,i=e.person;if(!i)return"couple-node";let r=n.coupleInfo.fatherId,o=n.coupleInfo.motherId,s=i.parents.includes(r),a=i.parents.includes(o);return s&&!a||a&&!s||s&&a?"male"===i.gender?"boy-child-node":"girl-child-node":"couple-node"}calculateAge(t){if(!t)return null;try{if(/^\d{4}$/.test(t)){let e=parseInt(t,10);return new Date().getFullYear()-e}let e=new Date(t);if(isNaN(e.getTime()))return null;let n=new Date,i=n.getFullYear()-e.getFullYear(),r=n.getMonth()-e.getMonth();return(r<0||0===r&&n.getDate()<e.getDate())&&i--,i}catch(e){return nH("Error calculating age",{birthDateString:t,error:e}),null}}wrapText(t,e){let n=1;return t.each(function(){let t=to(this),i=t.text().split(/\s+/).reverse(),r=t.attr("y"),o=parseFloat(t.attr("dy")||0),s=t.attr("text-anchor")||"start",a=t.attr("x")||0,l=[],h=0,u=i.pop(),c=t.text(null).append("tspan").attr("x",a).attr("y",r).attr("dy",o+"em").attr("text-anchor",s);for(;u;)l.push(u),c.text(l.join(" ")),c.node().getComputedTextLength()>e&&(l.pop(),c.text(l.join(" ")),l=[u],c=t.append("tspan").attr("x",a).attr("y",r).attr("dy",1.3*++h+o+"em").attr("text-anchor",s).text(u),n++),u=i.pop()}),n}getPersonColor(t){if(!t)return"#757575";if("gender"===this.config.colorScheme){let e=t.gender?t.gender.toLowerCase():"";return"male"===e?"var(--tree-male-color)":"female"===e?"var(--tree-female-color)":"#757575"}if("generation"===this.config.colorScheme){let e=["#1976d2","#388e3c","#f57c00","#d32f2f","#7b1fa2","#00796b"],n=t.generation%e.length;return e[n]}return"tree"===this.config.colorScheme?"var(--tree-node-stroke)":"#2196f3"}}function nG(t,e=null){console.log(`[LinkRenderer] ${t}`),e&&console.log(e)}class nK{constructor(t){this.config=t,this.nodeWidth=220,this.nodeHeight=140,nG("Initialized LinkRenderer with config",t)}createLinks(t,e){nG("Creating parent-child links");let n=e.links().filter(t=>"family-root"!==t.source.data.id),i=this.getLinkGenerator();t.selectAll(".link").data(n).enter().append("path").attr("class","link").attr("d",i)}createMarriageLinks(t,e,n){let i=e.filter(t=>"family-root"!==t.data.id&&t.data.spouse);nG(`Creating marriage links for ${i.length} nodes with spouses`),i.forEach(e=>{try{nG(`Creating marriage link for node ${e.data.id}`);let i=e$().x(t=>t.x).y(t=>t.y),r=[];r=n?[{x:e.y-this.nodeWidth/4,y:e.x},{x:e.y+this.nodeWidth/4,y:e.x}]:[{x:e.x-this.nodeWidth/4,y:e.y},{x:e.x+this.nodeWidth/4,y:e.y}],t.append("path").attr("class","link-marriage").attr("d",i(r))}catch(t){nG(`Error creating marriage link for node ${e.data.id}`,t)}})}getLinkGenerator(){let t;this.config.orientation;let e=this.config.lineStyle,n=this.isHorizontalOrientation();return(t=n?eT(eO).x(t=>t.y).y(t=>t.x):eT(eL).x(t=>t.x).y(t=>t.y),"curved"===e)?t=>{let e,i={x:t.source.x,y:t.source.y},r={x:t.target.x,y:t.target.y};if(n){let t=(i.y+r.y)/2;e=e$().x(t=>t.y).y(t=>t.x).curve(ec)([{x:i.x,y:i.y},{x:i.x,y:t},{x:r.x,y:t},{x:r.x,y:r.y}])}else{let t=(i.x+r.x)/2;e=e$().curve(ec)([{x:i.x,y:i.y},{x:t,y:i.y},{x:t,y:r.y},{x:r.x,y:r.y}])}return e}:"orthogonal"===e||"angled"===e?t=>{let e,i={x:t.source.x,y:t.source.y},r={x:t.target.x,y:t.target.y};return n?e$().x(t=>t.y).y(t=>t.x).curve(ef)([i,r]):e$().curve(ef)([i,r])}:t}isHorizontalOrientation(){return"left-right"===this.config.orientation||"right-left"===this.config.orientation}}function nW(t,e=null){console.log(`[TreeBuilder] ${t}`),e&&console.log(e)}class nY{constructor(t,e){this.familyTree=t,this.config=e,this.rootPersonId=this.config.rootPersonId||this.familyTree.rootPersonId,this.processedCouples=new Set,this.coupleGenerations=new Map,nW(`Initialized TreeBuilder with ${t.individuals.length} individuals`)}buildHierarchy(){nW("Converting family tree to hierarchy with root person ID:",this.rootPersonId),this.processedCouples.clear(),this.coupleGenerations.clear();let t=this.familyTree.individuals.find(t=>t.id===this.rootPersonId);t||(nW("Root person not found, using first person in data"),t=this.familyTree.individuals[0]);let e={id:"family-root",name:"Family Root",children:[]};if(t.spouses&&t.spouses.length>0&&t.spouses.forEach(n=>{let i=this.familyTree.individuals.find(t=>t.id===n);if(i){let n=[t.id,i.id].sort(),r=`couple-${n[0]}-${n[1]}`;this.coupleGenerations.set(r,0);let o=this.createFamilyUnit(t,i);e.children.push(o),this.config.showOnlyDirectFamily?this.processDirectChildrenForMarriage(o,t,i,1):this.processDescendantsForMarriage(o,t,i,new Set([t.id,i.id]),1)}}),0===e.children.length){let n=`single-${t.id}`;this.coupleGenerations.set(n,0);let i=this.createFamilyUnit(t,null);e.children.push(i),this.config.showOnlyDirectFamily?this.processDirectChildren(i,t,1):this.processDescendants(i,t,new Set([t.id]),1)}return nW("Hierarchy built with structure",{rootId:e.id,childrenCount:e.children.length}),t7(e)}processDirectChildrenForMarriage(t,e,n,i){nW(`Processing direct children for marriage of ${e.id} and ${n?n.id:"null"} at generation ${i}`);let r=t.coupleInfo.fatherId,o=t.coupleInfo.motherId;[...this.familyTree.individuals.filter(t=>{let i=!r||t.parents.includes(r),s=!o||t.parents.includes(o);return i&&s&&t.id!==e.id&&t.id!==(n?n.id:null)})].sort((t,e)=>t.birthOrder&&e.birthOrder?t.birthOrder-e.birthOrder:0).forEach(e=>{if(nW(`Processing child ${e.id} of marriage ${t.id}`),e.spouses&&e.spouses.length>0)e.spouses.forEach(n=>{let r=this.familyTree.individuals.find(t=>t.id===n);if(r){let n=[e.id,r.id].sort(),o=`couple-${n[0]}-${n[1]}`;this.coupleGenerations.set(o,i);let s=this.createFamilyUnit(e,r);t.children.push(s),this.processDirectChildrenForMarriage(s,e,r,i+1)}});else{let n=`single-${e.id}`;this.coupleGenerations.set(n,i);let r=this.createFamilyUnit(e,null);t.children.push(r),this.processDirectChildren(r,e,i+1)}})}processDirectChildren(t,e,n){nW(`Processing direct children for single person ${e.id} at generation ${n}`),[...this.familyTree.individuals.filter(t=>t.parents.includes(e.id)&&t.id!==e.id)].sort((t,e)=>t.birthOrder&&e.birthOrder?t.birthOrder-e.birthOrder:0).forEach(i=>{if(nW(`Processing child ${i.id} of single parent ${e.id}`),i.spouses&&i.spouses.length>0)i.spouses.forEach(e=>{let r=this.familyTree.individuals.find(t=>t.id===e);if(r){let e=[i.id,r.id].sort(),o=`couple-${e[0]}-${e[1]}`;this.coupleGenerations.set(o,n);let s=this.createFamilyUnit(i,r);t.children.push(s),this.processDirectChildrenForMarriage(s,i,r,n+1)}});else{let e=`single-${i.id}`;this.coupleGenerations.set(e,n);let r=this.createFamilyUnit(i,null);t.children.push(r),this.processDirectChildren(r,i,n+1)}})}processDescendantsForMarriage(t,e,n,i,r){nW(`Processing descendants for marriage of ${e.id} and ${n?n.id:"null"} at generation ${r}`);let o=t.coupleInfo.fatherId,s=t.coupleInfo.motherId;[...this.familyTree.individuals.filter(t=>{if(i.has(t.id))return!1;let r=!o||t.parents.includes(o),a=!s||t.parents.includes(s);return r&&a&&t.id!==e.id&&t.id!==(n?n.id:null)})].sort((t,e)=>t.birthOrder&&e.birthOrder?t.birthOrder-e.birthOrder:0).forEach(e=>{if(i.add(e.id),e.spouses&&e.spouses.length>0)e.spouses.forEach(n=>{let o=this.familyTree.individuals.find(t=>t.id===n);if(o){let n=[e.id,o.id].sort(),s=`couple-${n[0]}-${n[1]}`;this.coupleGenerations.set(s,r);let a=this.createFamilyUnit(e,o);t.children.push(a);let l=new Set(i);l.add(o.id),this.processDescendantsForMarriage(a,e,o,l,r+1)}});else{let n=`single-${e.id}`;this.coupleGenerations.set(n,r);let o=this.createFamilyUnit(e,null);t.children.push(o),this.processDescendants(o,e,new Set(i),r+1)}})}processDescendants(t,e,n,i){nW(`Processing all descendants for person ${e.id} at generation ${i}`),[...this.familyTree.individuals.filter(t=>!n.has(t.id)&&t.parents.includes(e.id)&&t.id!==e.id)].sort((t,e)=>t.birthOrder&&e.birthOrder?t.birthOrder-e.birthOrder:0).forEach(e=>{if(n.add(e.id),e.spouses&&e.spouses.length>0)e.spouses.forEach(r=>{let o=this.familyTree.individuals.find(t=>t.id===r);if(o){let r=[e.id,o.id].sort(),s=`couple-${r[0]}-${r[1]}`;this.coupleGenerations.set(s,i);let a=this.createFamilyUnit(e,o);t.children.push(a);let l=new Set(n);l.add(o.id),this.processDescendantsForMarriage(a,e,o,l,i+1)}});else{let r=`single-${e.id}`;this.coupleGenerations.set(r,i);let o=this.createFamilyUnit(e,null);t.children.push(o),this.processDescendants(o,e,new Set(n),i+1)}})}createFamilyUnit(t,e){let n,i=e?` with ${e.name}`:" (single)";if(nW(`Creating family unit for person ${t.id}${i}`),e){let i=[t.id,e.id].sort();n=`couple-${i[0]}-${i[1]}`}else n=`single-${t.id}`;return{id:n,name:e?`${t.name} & ${e.name}`:t.name,person:t,spouse:e,children:[],coupleInfo:{fatherId:"male"===t.gender?t.id:e?e.id:null,motherId:"female"===t.gender?t.id:e?e.id:null}}}}function nX(t,e=null){console.log(`[TreeLayout] ${t}`),e&&console.log(e)}class nJ{constructor(t){this.config=t,this.nodeWidth=220,this.nodeHeight=140,this.transform=null,this.treeLayout=null,this.setupTreeLayout(),nX("Initialized TreeLayout with config",t)}setupTreeLayout(){nX("Setting up tree layout");let t=[this.nodeWidth*this.config.nodeSize,this.nodeHeight*this.config.nodeSize],e=[t[0]*this.config.nodeSpacing,t[1]*this.config.nodeSpacing];this.treeLayout=(function(){var t=eo,e=1,n=1,i=null;function r(r){var l=function(t){for(var e,n,i,r,o,s=new el(t,0),a=[s];e=a.pop();)if(i=e._.children)for(e.children=Array(o=i.length),r=o-1;r>=0;--r)a.push(n=e.children[r]=new el(i[r],r)),n.parent=e;return(s.parent=new el(null,0)).children=[s],s}(r);if(l.eachAfter(o),l.parent.m=-l.z,l.eachBefore(s),i)r.eachBefore(a);else{var h=r,u=r,c=r;r.eachBefore(function(t){t.x<h.x&&(h=t),t.x>u.x&&(u=t),t.depth>c.depth&&(c=t)});var d=h===u?1:t(h,u)/2,f=d-h.x,p=e/(u.x+d+f),g=n/(c.depth||1);r.eachBefore(function(t){t.x=(t.x+f)*p,t.y=t.depth*g})}return r}function o(e){var n=e.children,i=e.parent.children,r=e.i?i[e.i-1]:null;if(n){!function(t){for(var e,n=0,i=0,r=t.children,o=r.length;--o>=0;)e=r[o],e.z+=n,e.m+=n,n+=e.s+(i+=e.c)}(e);var o=(n[0].z+n[n.length-1].z)/2;r?(e.z=r.z+t(e._,r._),e.m=e.z-o):e.z=o}else r&&(e.z=r.z+t(e._,r._));e.parent.A=function(e,n,i){if(n){for(var r,o,s,a=e,l=e,h=n,u=a.parent.children[0],c=a.m,d=l.m,f=h.m,p=u.m;h=ea(h),a=es(a),h&&a;)u=es(u),(l=ea(l)).a=e,(s=h.z+f-a.z-c+t(h._,a._))>0&&(function(t,e,n){var i=n/(e.i-t.i);e.c-=i,e.s+=n,t.c+=i,e.z+=n,e.m+=n}((r=h,o=i,r.a.parent===e.parent?r.a:o),e,s),c+=s,d+=s),f+=h.m,c+=a.m,p+=u.m,d+=l.m;h&&!ea(l)&&(l.t=h,l.m+=f-d),a&&!es(u)&&(u.t=a,u.m+=c-p,i=e)}return i}(e,r,e.parent.A||i[0])}function s(t){t._.x=t.z+t.parent.m,t.m+=t.parent.m}function a(t){t.x*=e,t.y=t.depth*n}return r.separation=function(e){return arguments.length?(t=e,r):t},r.size=function(t){return arguments.length?(i=!1,e=+t[0],n=+t[1],r):i?null:[e,n]},r.nodeSize=function(t){return arguments.length?(i=!0,e=+t[0],n=+t[1],r):i?[e,n]:null},r})().nodeSize(e).separation((t,e)=>t.parent===e.parent?1.2:1.5),this.setupOrientation(),nX("Tree layout configured",{nodeSize:e,orientation:this.config.orientation})}setupOrientation(){switch(this.config.orientation){case"top-down":default:this.transform=t=>t;break;case"bottom-up":this.transform=t=>(t.y=-t.y,t);break;case"left-right":this.transform=t=>{let e=t.x;return t.x=t.y,t.y=e,t};break;case"right-left":this.transform=t=>{let e=t.x;return t.x=-t.y,t.y=e,t}}}applyLayout(t){nX("Applying tree layout to hierarchy data"),t.sort((t,e)=>{let n=t.depth-e.depth;return 0!==n?n:0});let e=this.treeLayout(t);return e.each(t=>{this.transform&&this.transform(t)}),e}isHorizontalOrientation(){return"left-right"===this.config.orientation||"right-left"===this.config.orientation}setupZoom(t,e){nX("Setting up zoom behavior");let n=eK().scaleExtent([.1,3]).on("zoom",t=>{e.attr("transform",t.transform)});t.call(n)}resetView(t,e,n){nX("Resetting view to fit tree");let i=n.descendants().filter(t=>"family-root"!==t.data.id);if(0===i.length)return;let r=1/0,o=-1/0,s=1/0,a=-1/0;i.forEach(t=>{let e=this.isHorizontalOrientation()?t.y:t.x,n=this.isHorizontalOrientation()?t.x:t.y;r=Math.min(r,e-this.nodeWidth/2),o=Math.max(o,e+this.nodeWidth/2),s=Math.min(s,n-this.nodeHeight/2),a=Math.max(a,n+this.nodeHeight/2)}),r-=50,o+=50,s-=50,a+=50;let l=o-r,h=a-s,u=Math.min(this.config.svgWidth/l,this.config.svgHeight/h,1),c=this.config.svgWidth/2-(r+l/2)*u,d=this.config.svgHeight/2-(s+h/2)*u,f=eF.translate(c,d).scale(u);t.transition().duration(750).call(eK().transform,f)}}function nQ(t,e=null){console.log(`[ExportUtils] ${t}`),e&&console.log(e)}function nZ(t,e,n,i=!1,r=!1){if(nQ("Exporting SVG"),!t||t.empty()){console.error("No SVG to export");return}try{let o=t.node().cloneNode(!0),a=to(o).select(".tree-group");if(a.empty()){console.error("No tree group found in SVG");return}a.attr("transform");let l=to(o).selectAll(".node");if(l.empty()){console.error("No nodes found in SVG");return}let h=1/0,u=1/0,c=-1/0,d=-1/0;l.each(function(){let t,i,r=to(this).attr("transform");if(r.startsWith("translate("))try{let e=r.substring(10,r.length-1).split(",");t=parseFloat(e[0]),i=parseFloat(e[1])}catch(t){nQ("Error parsing transform",{transform:r,error:t});return}else try{let e=this.getScreenCTM();if(!e)return;t=e.e,i=e.f}catch(t){nQ("Error getting CTM",{error:t});return}let o=e/2,s=n/2;h=Math.min(h,t-o),u=Math.min(u,i-s),c=Math.max(c,t+o),d=Math.max(d,i+s)}),h-=80,u-=80,c+=80,d+=80;let f=c-h,p=d-u;nQ("SVG bounds calculated",{minX:h,minY:u,maxX:c,maxY:d,width:f,height:p}),a.attr("transform",`translate(${-h}, ${-u})`),o.setAttribute("viewBox",`0 0 ${f} ${p}`),o.setAttribute("width",f),o.setAttribute("height",p);let g=document.createElement("style");g.textContent=`
            /* Node styling */
            .node-box {
                stroke: #5d4037;
                stroke-width: 2px;
                fill: #8bc34a;
                rx: 5px;
                ry: 5px;
            }
            
            /* Gender-specific styling */
            .male-node {
                fill: #8BC34A;
            }
            
            .female-node {
                fill: #F8BBD0;
            }
            
            /* Couple node */
            .couple-node {
                fill: #8BC34A;
            }
            
            /* Relationship-based styling */
            .boy-child-node {
                fill: #8BC34A;
            }
            
            .girl-child-node {
                fill: #F8BBD0;
            }
            
            /* Text styling */
            .name {
                font-weight: bold;
                font-size: 14px;
                fill: #212121;
            }
            
            .spouse-name {
                font-size: 14px;
                fill: #212121;
            }
            
            .lifespan, .spouse-lifespan, .native-place, .birth-order {
                font-size: 12px;
                fill: #757575;
            }
            
            /* Links styling */
            .link {
                fill: none;
                stroke: #795548;
                stroke-width: 4px;
                stroke-linecap: round;
            }
            
            .link-marriage {
                fill: none;
                stroke: #795548;
                stroke-width: 3px;
                stroke-dasharray: 5, 5;
            }
            
            /* Silhouette styling */
            .male-silhouette path,
            .female-silhouette path,
            .couple-silhouette path {
                fill: #444;
                stroke: #212121;
                stroke-width: 0.5px;
            }
            
            /* Spouse divider */
            .spouse-divider {
                stroke: #757575;
                stroke-width: 1px;
                stroke-dasharray: 2, 2;
            }
            
            /* Text positioning */
            .text-content {
                text-anchor: middle;
            }
            .node text, .node tspan {
                text-anchor: middle;
            }
            
            /* Page grid styling */
            .page-grid {
                stroke: #aaa;
                stroke-width: 1px;
                stroke-dasharray: 5, 5;
                fill: none;
            }
            
            .page-number {
                font-size: 12px;
                fill: #666;
                text-anchor: middle;
                dominant-baseline: middle;
            }
        `,o.insertBefore(g,o.firstChild);let m=document.createElement("link");if(m.setAttribute("href","https://fonts.googleapis.com/css2?family=Noto+Sans+Tamil&display=swap"),m.setAttribute("rel","stylesheet"),o.insertBefore(m,o.firstChild),i){let t=Math.ceil(f/744),e=Math.ceil(p/1073);nQ("Page calculation",{pagesX:t,pagesY:e,totalPages:t*e});let n=document.createElementNS("http://www.w3.org/2000/svg","g");n.setAttribute("class","page-grid-group");let i=[],a=0;for(let r=0;r<e;r++)for(let s=0;s<t;s++){let l=744*s,h=1073*r,u=document.createElementNS("http://www.w3.org/2000/svg","rect");u.setAttribute("class","page-grid"),u.setAttribute("x",l),u.setAttribute("y",h),u.setAttribute("width",794),u.setAttribute("height",1123),n.appendChild(u);let c=document.createElementNS("http://www.w3.org/2000/svg","text");c.setAttribute("class","page-number"),c.setAttribute("x",l+397),c.setAttribute("y",h+1123-15),c.textContent=`Page ${++a} (${s+1},${r+1}) of ${t*e}`,n.appendChild(c);let d=o.cloneNode(!0);d.setAttribute("viewBox",`${l} ${h} 794 1123`),d.setAttribute("width",794),d.setAttribute("height",1123);let f=document.createElementNS("http://www.w3.org/2000/svg","text");if(f.setAttribute("x",397),f.setAttribute("y",1108),f.setAttribute("class","page-number"),f.textContent=`Page ${a} (${s+1},${r+1}) of ${t*e}`,d.appendChild(f),s>0){let t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("x",l),t.setAttribute("y",h),t.setAttribute("width",50),t.setAttribute("height",1123),t.setAttribute("fill","rgba(255, 255, 0, 0.1)"),t.setAttribute("stroke","none"),d.appendChild(t)}if(r>0){let t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("x",l),t.setAttribute("y",h),t.setAttribute("width",794),t.setAttribute("height",50),t.setAttribute("fill","rgba(255, 255, 0, 0.1)"),t.setAttribute("stroke","none"),d.appendChild(t)}i.push({svg:d,x:s+1,y:r+1,index:a})}if(o.appendChild(n),r)n0(i,t,e);else{let t=new XMLSerializer,e=t.serializeToString(o);e='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n'+e;let n=new Blob([e],{type:"image/svg+xml"}),r=URL.createObjectURL(n),a=document.createElement("a");a.href=r,a.download="family-tree-with-grid.svg",document.body.appendChild(a),a.click(),s("hkR60").then(e=>{let n=new e.default;i.forEach(e=>{let i='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n'+t.serializeToString(e.svg);n.file(`family-tree-page-${e.index}-(${e.x},${e.y}).svg`,i)});let r=`Family Tree - Printable Pages
                    
This zip file contains ${i.length} SVG files that can be printed on A4 paper.
Each file has a grid position (X,Y) in its filename to help with assembly.

Printing Instructions:
1. Print each SVG file on A4 paper.
2. Trim the overlapping margins (shown with light yellow background) on the right/bottom edges.
3. Align the pages according to their (X,Y) grid positions.
4. Tape or glue the pages together to form the complete family tree.

The overlay yellow areas show overlap between pages to help with alignment.`;n.file("README.txt",r),n.generateAsync({type:"blob"}).then(t=>{let e=URL.createObjectURL(t),n=document.createElement("a");n.href=e,n.download="family-tree-printable-pages.zip",document.body.appendChild(n),n.click(),setTimeout(()=>{document.body.removeChild(n),URL.revokeObjectURL(e)},100)})}).catch(e=>{console.error("Error creating zip file:",e),i.forEach(e=>{let n='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n'+t.serializeToString(e.svg),i=new Blob([n],{type:"image/svg+xml"}),r=URL.createObjectURL(i),o=document.createElement("a");o.href=r,o.download=`family-tree-page-${e.index}-(${e.x},${e.y}).svg`,document.body.appendChild(o),o.click(),setTimeout(()=>{document.body.removeChild(o),URL.revokeObjectURL(r)},100)})}),nQ("SVG export with pagination complete")}}else{let t=new XMLSerializer().serializeToString(o);t='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n'+t;let e=new Blob([t],{type:"image/svg+xml"}),n=URL.createObjectURL(e),i=document.createElement("a");i.href=n,i.download="family-tree.svg",document.body.appendChild(i),i.click(),setTimeout(()=>{document.body.removeChild(i),URL.revokeObjectURL(n),nQ("SVG export complete")},100)}}catch(t){console.error("Error exporting SVG:",t)}}async function n0(t,e,n){nQ("Starting PDF export");try{let i=document.createElement("div");i.style.position="fixed",i.style.top="0",i.style.left="0",i.style.width="100%",i.style.height="100%",i.style.backgroundColor="rgba(0,0,0,0.7)",i.style.color="white",i.style.display="flex",i.style.flexDirection="column",i.style.alignItems="center",i.style.justifyContent="center",i.style.zIndex="9999",i.innerHTML=`
            <h2>Generating PDF...</h2>
            <p>This may take a few moments, please wait.</p>
            <p id="pdf-progress">Preparing...</p>
        `,document.body.appendChild(i);let r=(await s("2C5f3")).default,o=await s("663DU"),a=new r({orientation:"portrait",unit:"mm",format:"a4"}),l=t.length;a.setFontSize(20),a.text("Family Tree - Complete Layout",105,20,{align:"center"}),a.setFontSize(12),a.text(`This PDF contains ${l} pages that form the complete family tree.`,105,30,{align:"center"}),a.text(`Pages are arranged in a ${e}\xd7${n} grid.`,105,40,{align:"center"});let h=150/e,u=1.4142857142857144*h,c=60+u*n;if(c<267){a.setDrawColor(150,150,150),a.setFillColor(240,240,240);let t=1;for(let i=0;i<n;i++)for(let n=0;n<e;n++){let e=30+n*h,r=60+i*u;a.setFillColor(240,240,240),a.rect(e,r,h,u,"FD"),a.setFontSize(8),a.text(`Page ${t}`,e+h/2,r+u/2,{align:"center"}),t++}a.setFontSize(12),a.text("Assembly Instructions:",105,c+20,{align:"center"}),a.setFontSize(10),a.text("1. Print all pages at 100% scale (no scaling).",105,c+30,{align:"center"}),a.text("2. Arrange pages according to the grid layout shown above.",105,c+38,{align:"center"}),a.text("3. Trim the overlapping regions and tape pages together.",105,c+46,{align:"center"})}a.addPage();let d=document.createElement("div");d.style.position="absolute",d.style.top="0",d.style.left="0",d.style.width="794px",d.style.height="1123px",d.style.overflow="hidden",d.style.backgroundColor="white",d.style.zIndex="-9999",document.body.appendChild(d);for(let e=0;e<t.length;e++){let n=t[e];document.getElementById("pdf-progress").textContent=`Processing page ${e+1} of ${t.length}`;try{d.innerHTML="",d.innerHTML=new XMLSerializer().serializeToString(n.svg);let t=d.querySelector("svg");if(t){t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.style.display="block";let e=document.createElement("style");e.textContent=`
                        * { visibility: visible !important; }
                        svg { background-color: white; }
                    `,t.appendChild(e)}await new Promise(t=>setTimeout(t,250));let i=await o(d,{useCORS:!0,scale:2,allowTaint:!0,backgroundColor:"white",logging:!1,width:794,height:1123});e>0&&a.addPage();let r=i.toDataURL("image/jpeg",.95);a.addImage(r,"JPEG",0,0,210,297,"","FAST"),a.setTextColor(100,100,100),a.setFontSize(8),a.text(`Page ${e+1} (${n.x},${n.y})`,190,292,{align:"right"}),await new Promise(t=>setTimeout(t,0))}catch(t){console.error(`Error processing page ${e+1}:`,t),nQ(`Error on page ${e+1}`,t),e>0&&a.addPage(),a.setFillColor(255,240,240),a.rect(0,0,210,297,"F"),a.setTextColor(200,0,0),a.setFontSize(16),a.text(`Error rendering page ${e+1}`,105,50,{align:"center"}),a.setFontSize(12),a.text(t.message||"Unknown error",105,70,{align:"center"})}}document.body.removeChild(d),a.save("family-tree-complete.pdf"),document.body.removeChild(i),nQ("PDF export complete")}catch(n){console.error("Error creating PDF:",n),alert("Error generating PDF: "+n.message);let t=document.querySelector('div[style*="position: fixed"]');t&&document.body.removeChild(t);let e=document.querySelector('div[style*="z-index: -9999"]');e&&document.body.removeChild(e)}}function n1(t,e=null){console.log(`[TreeRenderer] ${t}`),e&&console.log(e)}class n2{constructor(t,e,n){this.familyTree=t,this.container=e,this.config=n,this.svg=null,this.treeGroup=null,this.nodesGroup=null,this.linksGroup=null,this.treeBuilder=new nY(t,n),this.treeLayout=new nJ(n),this.nodeRenderer=new nq(n),this.linkRenderer=new nK(n),this.nodeWidth=220,this.nodeHeight=140,this.hierarchyData=null,this.root=null,n1(`Initialized renderer with ${t.individuals.length} individuals`)}render(){n1("Starting rendering"),this.createSvg(),this.hierarchyData=this.treeBuilder.buildHierarchy(),n1("Created hierarchy data",{nodes:this.hierarchyData.descendants().length}),this.root=this.treeLayout.applyLayout(this.hierarchyData),this.linkRenderer.createLinks(this.linksGroup,this.root),this.nodeRenderer.createNodes(this.nodesGroup,this.root.descendants(),this.treeLayout.isHorizontalOrientation()),this.linkRenderer.createMarriageLinks(this.linksGroup,this.root.descendants(),this.treeLayout.isHorizontalOrientation()),this.treeLayout.setupZoom(this.svg,this.treeGroup),this.resetView(),n1("Rendering complete")}createSvg(){to(this.container).selectAll("svg").remove(),this.svg=to(this.container).append("svg").attr("width",this.config.svgWidth).attr("height",this.config.svgHeight).attr("viewBox",`0 0 ${this.config.svgWidth} ${this.config.svgHeight}`).attr("class","family-tree-svg"),this.svg.append("defs").append("marker").attr("id","arrow").attr("viewBox","0 -5 10 10").attr("refX",8).attr("refY",0).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5").attr("class","arrow-head"),this.treeGroup=this.svg.append("g").attr("class","tree-group").attr("transform",`translate(${this.config.svgWidth/2}, 60)`),this.linksGroup=this.treeGroup.append("g").attr("class","links-group"),this.nodesGroup=this.treeGroup.append("g").attr("class","nodes-group")}resetView(){this.treeLayout.resetView(this.svg,this.treeGroup,this.root)}updateLanguage(t){this.config.language=t,this.render()}exportSVG(t=!1,e=!1){nZ(this.svg,this.nodeWidth,this.nodeHeight,t,e)}}function n5(t,e=null){console.log(`[Family Tree Vis] ${t}`),e&&console.log(e)}let n3=[],n4=null,n8={};function n6(t){let e=t.target.files[0];if(!e)return;n5("File selected for upload",{name:e.name,size:e.size});let n=new FileReader;n.onload=function(t){try{let e=t.target.result;n5("CSV file loaded, parsing content"),n3=u(e),n5("CSV parsed successfully",{records:n3.length}),n7()}catch(t){n5("Error parsing CSV",t),io("Error parsing CSV file. Please check the format.","error")}},n.onerror=function(){n5("Error reading file"),io("Error reading file.","error")},n.readAsText(e)}function n9(){n5("Loading sample data"),fetch("data/sample-family-tree.csv").then(t=>{if(!t.ok)throw Error("Network response was not ok");return t.text()}).then(t=>{n5("Sample data loaded, parsing content"),n5("Sample data parsed successfully",{records:(n3=u(t)).length}),n7()}).catch(t=>{n5("Error loading sample data",t),io("Error loading sample data.","error")})}function n7(){if(n5("Populating person selection dropdown"),!n3||0===n3.length){n5("No family data available");return}try{n8.rootPersonSelect.innerHTML="";let t=document.createElement("option");t.value="",t.textContent="-- Select a person --",n8.rootPersonSelect.appendChild(t),n3.forEach(t=>{let e=document.createElement("option");e.value=t.id;let n=t.name;(t.birth_year||t.death_year)&&(n+=" (",t.birth_year&&(n+=t.birth_year),n+="-",t.death_year&&(n+=t.death_year),n+=")"),e.textContent=n,n8.rootPersonSelect.appendChild(e)}),n8.personSelection.style.display="block",n8.rootPersonSelect.options.length>1&&(n8.rootPersonSelect.selectedIndex=1,ie({target:{value:n8.rootPersonSelect.value}})),n5("Person selection dropdown populated")}catch(t){n5("Error populating person selection",t),io("Error populating person selection.","error")}}function it(){if(n5("Generate family tree requested"),!n3||0===n3.length){n5("No family data available"),io("Please upload a CSV file or load sample data first.","error");return}if(!n8.rootPersonSelect.value){n5("No root person selected"),io("Please select a person to view their family tree.","error");return}try{n8.visualizationContainer.innerHTML="",n5("Visualization container cleared"),n8.visualizationContainer.style.display="block",n8.visualizationContainer.style.minHeight="500px",n8.visualizationContainer.style.border="1px solid #ccc";let t={orientation:n8.orientationSelect.value,nodeSize:parseFloat(n8.nodeSizeInput.value),nodeSpacing:parseFloat(n8.nodeSpacingInput.value),colorScheme:n8.colorSchemeSelect.value,fontSize:parseInt(n8.fontSizeInput.value),lineStyle:n8.lineStyleSelect.value,svgWidth:parseInt(n8.svgWidthInput.value),svgHeight:parseInt(n8.svgHeightInput.value),language:"en",rootPersonId:n8.rootPersonSelect.value,showOnlyDirectFamily:!1};n5("Configuration options",t),n5("Building family tree");let e=function(t,e=null){if(f("Starting family tree construction",{rootPersonId:e}),!t||0===t.length)throw Error("No data provided for building family tree");f("Creating individuals map");let n=new Map;if(t.forEach(t=>{let e=JSON.parse(JSON.stringify(t));e.parents=[],e.children=[],e.spouses=[],e.gender=function(t){if(!t)return"unknown";let e=t.toString().trim().toLowerCase();return"m"===e||"male"===e||""===e||""===e?"male":"f"===e||"female"===e||""===e||""===e?"female":"unknown"}(e.gender),n.set(e.id,e)}),f(`Created individuals map with ${n.size} individuals`),f("Building relationships"),t.forEach(t=>{if(!n.has(t.id))return;let e=n.get(t.id);if(t.father_id&&n.has(t.father_id)){e.parents.push(t.father_id);let i=n.get(t.father_id);i.children.includes(t.id)||i.children.push(t.id)}if(t.mother_id&&n.has(t.mother_id)){e.parents.push(t.mother_id);let i=n.get(t.mother_id);i.children.includes(t.id)||i.children.push(t.id)}if(t.spouse_id&&n.has(t.spouse_id)){e.spouses.includes(t.spouse_id)||e.spouses.push(t.spouse_id);let i=n.get(t.spouse_id);i.spouses.includes(t.id)||i.spouses.push(t.id)}}),!e||!n.has(e)){f("No valid root person ID provided, using default selection");let i=Array.from(n.values()).filter(t=>0===t.parents.length);i.length>0?(e=i[0].id,f(`Selected person without parents as root: ${e}`)):(e=t[0].id,f(`Selected first person as root: ${e}`))}if(e){if(f(`Filtering family tree for root person: ${e}`),!n.get(e))throw Error(`Root person with ID ${e} not found in data`);let t=new Map,i=new Set;!function e(r){if(i.has(r))return;i.add(r);let o=n.get(r);o&&(t.set(r,o),o.spouses.forEach(e=>{n.has(e)&&!i.has(e)&&(t.set(e,n.get(e)),i.add(e))}),o.children.forEach(t=>{e(t)}))}(e),n=t,f(`Filtered family tree to ${n.size} individuals`)}f("Calculating generations using new rules"),n.forEach(t=>{t.generation=null}),f("First pass: assigning gen 0 to people with no parents and no spouses"),n.forEach(t=>{0===t.parents.length&&0===t.spouses.length&&(t.generation=0,f(`Assigned gen 0 to person ${t.id} (no parents, no spouse)`))});let i=!0,r=0;for(;i&&r<10;)i=!1,r++,f(`Generation calculation pass #${r}`),n.forEach(t=>{if(null===t.generation&&t.parents.length>0){let e=null;for(let r of t.parents){let o=n.get(r);if(o&&"male"===o.gender&&null!==o.generation){t.generation=o.generation+1,i=!0,f(`Assigned gen ${t.generation} to person ${t.id} (father's gen + 1)`);break}o&&"female"===o.gender&&null!==o.generation&&!e&&(e=o)}null===t.generation&&e&&(t.generation=e.generation+1,i=!0,f(`Assigned gen ${t.generation} to person ${t.id} (mother's gen + 1)`))}}),n.forEach(t=>{if(null===t.generation&&0===t.parents.length&&t.spouses.length>0)for(let e of t.spouses){let r=n.get(e);if(r&&null!==r.generation){t.generation=r.generation,i=!0,f(`Assigned gen ${t.generation} to person ${t.id} (same as spouse)`);break}}}),9===r&&(f("Maximum iteration count reached, assigning default generation 0 to remaining individuals"),n.forEach(t=>{null===t.generation&&(t.generation=0,f(`Assigned default gen 0 to person ${t.id} (couldn't determine otherwise)`))}));f(`Generation calculation completed in ${r} iterations`),f("Calculating child orders");let o=new Map,s=new Map;t.forEach((t,e)=>{s.set(t.id,e)}),n.forEach(t=>{if(0===t.parents.length)return;let e=[...t.parents].sort().join(":");o.has(e)||o.set(e,[]),o.get(e).push(t)}),o.forEach(t=>{t.sort((t,e)=>{if(!t.birth_date&&!e.birth_date)return s.get(t.id)-s.get(e.id);if(!t.birth_date)return -1;if(!e.birth_date)return 1;let n=new Date(t.birth_date),i=new Date(e.birth_date);return n.getTime()===i.getTime()?s.get(t.id)-s.get(e.id):n-i}),t.forEach((e,n)=>{e.birthOrder=n+1,e.totalSiblings=t.length})});let a=0,l=0,h=0;n.forEach(t=>{t.parents.length>0&&a++,t.children.length>0&&l++,t.spouses.length>0&&h++}),f("Family tree statistics",{individuals:n.size,withParents:a,withChildren:l,withSpouses:h});let u=1/0,c=-1/0;n.forEach(t=>{void 0!==t.generation&&(u=Math.min(u,t.generation),c=Math.max(c,t.generation))});let d=c-u+1;return f(`Found ${d} generations (min: ${u}, max: ${c})`),{individuals:Array.from(n.values()),rootPersonId:e,generations:d,minGeneration:u,maxGeneration:c}}(n3,n8.rootPersonSelect.value);n5("Rendering family tree"),n4=function(t,e,n){if(n1("Starting tree rendering"),!t||!t.individuals||0===t.individuals.length)throw Error("Invalid family tree data provided");if(!e)throw Error("No container element provided for rendering");let i={orientation:"top-down",nodeSize:1.5,nodeSpacing:3.5,colorScheme:"gender",fontSize:14,lineStyle:"straight",svgWidth:2e3,svgHeight:1500,language:"en",rootPersonId:null,showOnlyDirectFamily:!0,...n};n1("Rendering with config",i);let r=new n2(t,e,i);try{r.render(),n1("Tree rendering complete")}catch(t){throw n1("Error during tree rendering",t),t}return r}(e,n8.visualizationContainer,t),n5("Family tree rendered successfully"),n8.visualizationContainer.scrollIntoView({behavior:"smooth"})}catch(t){console.error("Error generating family tree:",t),io("Error generating family tree.","error")}}function ie(t){n5("Root person selection changed",{value:t.target.value}),t.target.value&&it()}function ii(){n4&&n4.resetView()}function ir(t=!1,e=!1){if(!n4){alert("Please generate a family tree first.");return}try{console.log("Exporting SVG..."),nZ(n4.svg,n4.nodeWidth,n4.nodeHeight,t,e)}catch(t){console.error("Error exporting SVG:",t),alert("Error exporting SVG: "+t.message)}}function io(t,e="info"){n5(`Showing ${e} message: ${t}`);let n=document.getElementById("status-container");n||((n=document.createElement("div")).id="status-container",n.style.margin="10px 0",n.style.padding="10px",n.style.borderRadius="4px",document.querySelector(".container").insertBefore(n,n8.visualizationContainer)),n.style.backgroundColor="error"===e?"#ffebee":"#e8f5e9",n.style.color="error"===e?"#c62828":"#2e7d32",n.style.border=`1px solid ${"error"===e?"#ffcdd2":"#c8e6c9"}`,n.textContent=t,n.scrollIntoView({behavior:"smooth"})}document.addEventListener("DOMContentLoaded",function(){let t=Object.entries(n8={csvFileInput:document.getElementById("csv-file"),loadSampleBtn:document.getElementById("load-sample"),rootPersonSelect:document.getElementById("root-person"),generateTreeBtn:document.getElementById("generate-tree"),exportSvgSingleBtn:document.getElementById("export-svg-single"),exportSvgPagesBtn:document.getElementById("export-svg-pages"),exportPdfBtn:document.getElementById("export-pdf"),resetViewBtn:document.getElementById("reset-view"),orientationSelect:document.getElementById("orientation"),nodeSizeInput:document.getElementById("node-size"),nodeSpacingInput:document.getElementById("node-spacing"),colorSchemeSelect:document.getElementById("color-scheme"),fontSizeInput:document.getElementById("font-size"),lineStyleSelect:document.getElementById("line-style"),svgWidthInput:document.getElementById("svg-width"),svgHeightInput:document.getElementById("svg-height"),visualizationContainer:document.getElementById("visualization-container"),personSelection:document.getElementById("person-selection")}).filter(([t,e])=>!e).map(([t])=>t);t.length>0?console.error("Missing elements:",t):(n5("Initializing application"),n8.csvFileInput.addEventListener("change",n6),n8.loadSampleBtn.addEventListener("click",n9),n8.generateTreeBtn.addEventListener("click",it),n8.exportSvgSingleBtn.addEventListener("click",()=>ir(!1,!1)),n8.exportSvgPagesBtn.addEventListener("click",()=>ir(!0,!1)),n8.exportPdfBtn.addEventListener("click",()=>ir(!0,!0)),n8.resetViewBtn.addEventListener("click",ii),n8.rootPersonSelect.addEventListener("change",ie),n5("App initialized with elements",Object.keys(n8)),console.log("Component check:",[{id:"csv-file",name:"CSV File Input"},{id:"load-sample",name:"Load Sample Button"},{id:"generate-tree",name:"Generate Tree Button"},{id:"export-svg-single",name:"Export SVG Single Button"},{id:"export-svg-pages",name:"Export SVG Pages Button"},{id:"export-pdf",name:"Export PDF Button"},{id:"reset-view",name:"Reset View Button"},{id:"visualization-container",name:"Visualization Container"}].map(t=>({...t,found:!!document.getElementById(t.id)}))))});
//# sourceMappingURL=family-tree.45e79e50.js.map
